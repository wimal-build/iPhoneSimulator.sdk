// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);for(var n,i,p,o,s,l,g,u,m,d={},c=[],h=a.getSpan().next(t.passengerNamePrefix).parentTag("table9").allInnerTags("tr9"),v=0;h.length>v;v++)passengerData=h[v].allInnerTags("td9"),0!=passengerData.length&&(name=""+passengerData[0].tagContents(),ticketNumber=null,3==passengerData.length&&(ticketNumber=""+passengerData[2].tagContents()),d[name]={name:name,seats:{},seatingType:{},ticketNumber:ticketNumber,totalPrice:null,priceCurrency:null});var C=""+a.getSpan().next(t.confirmationNumber).innerCapture(t.confirmationNumber,1).trim(),f=a.getSpan().next(t.pricePrefix).nextTag("td9").tagContents(),N=f.innerCapture(/([0-9,\.]+)/,1).trim(),T=f.innerCapture(/[0-9,\.,\,]+\s(\D+)/,1).trim();T||(T=f.innerCapture(/(\D+)\s[0-9,\.,\,]+/,1).trim());var b,A=a.getSpan().next(t.tripSummaryHeader);do{b=b?b.next(t.flightLeg):A.next(t.flightLeg),n=b.nextDate(),i=n.nextDate(),p=n.parentTag("td9").innerCapture(t.airport),o=""+p.$airportAddress,s=""+p.$airportCode,p=i.parentTag("td9").innerCapture(t.airport),l=""+p.$airportAddress,g=""+p.$airportCode;var y=b.previousTag("td9").tagContents().innerCapture(t.flightNumber);u=""+y.$airlineCode,m=""+y.$flightNumber,ASSERT(C,u,m,s,n,g,i,l)&&c.push({reservationId:C,airlineName:null,airlineCode:u,flightNumber:m,departureAirport:o,departureAirportCode:s,departureTime:n,arrivalAirport:l,arrivalAirportCode:g,arrivalTime:i,passengers:d})}while(0!==(""+b.next(t.flightLeg)).length);for(var x=[],v=0;c.length>v;v++)for(var S=c[v],k=Object.keys(S.passengers),D=0;k.length>D;D++){var z=S.passengers[k[D]],F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:null,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureAirportCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalAirportCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},reservationId:S.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:N,priceCurrency:T,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:null,seatingType:null}}};x.push(F)}return x}}).call();
