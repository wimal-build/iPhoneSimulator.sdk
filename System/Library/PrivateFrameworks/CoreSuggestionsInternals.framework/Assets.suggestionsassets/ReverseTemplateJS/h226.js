// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){if(int(e.epoch)<1388534400)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,p,l,o,s,u,m,g,c,d,h,T,C,v,b,f,y,N,A,$,x=[],S={};i=a.getSpan().nextText(t.reservationId).nextAnyTag("td").tagContents(),l=a.getSpan().nextText(t.flightDetails).nextText(t.passengers).parentTag("table5").allInnerTags("table6").map(function(e){return e.allInnerTagsFiltered("td6").filter(function(e,r){return 0===r})}),g=a.getSpan().nextText(t.pricing).nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+) ($<priceCurrency>[A-Z]{3})/),c=g?g.$totalPrice:null,d=g?g.$priceCurrency:null;for(var F=0;l.length>F;F++)o=l[F][0].next(t.seat).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/,t.seat),1),S[""+l[F][0]]={name:l[F][0],seats:o,seatingType:{},totalPrice:c,priceCurrency:d};u=a.getSpan().nextText(t.flightDetails).parentTag("table4").allInnerTags("table5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return 6===e.length});for(var D=0;u.length>D;D++)s=u[D],h=s[0].innerCapture(/\(($<code>[A-Z]+)\s*($<flightNumber>\d+)\)$/),T=h?h.$code.trim():null,m=h?h.$flightNumber:null,C=s[1].innerCapture(/\(($<code>[A-Z]{3})\)\s+($<airport>.*)/),f=C?C.$code:null,b=C?C.$airport:null,y=s[2].innerCapture(/\(($<code>[A-Z]{3})\)\s+($<airport>.*)/),$=y?y.$code:null,A=y?y.$airport:null,v=combineDateAndTime(s[3].innerDate(),a.getDetachedSpan(""+s[3].innerCapture(/\d{2}:\d{2}/))),N=combineDateAndTime(s[4].innerDate(),a.getDetachedSpan(""+s[4].innerCapture(/\d{2}:\d{2}/))),ASSERT(T,m,f,v,$,N)&&x.push({airlineCode:T,flightNumber:m,departureCode:f,departureAirport:b,departureTime:v,arrivalCode:$,arrivalAirport:A,arrivalTime:N,passengers:S});for(var I=[],D=0;x.length>D;D++)for(var P=x[D],k=Object.keys(P.passengers),z=0;k.length>z;z++){var Z=P.passengers[k[z]],E={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:P.airlineName,airlineCode:P.airlineCode,flightNumber:P.flightNumber,departureAirportFuzzy:P.departureAirport,departureAirportCode:P.departureCode,departureTime:P.departureTime,arrivalAirportFuzzy:P.arrivalAirport,arrivalAirportCode:P.arrivalCode,arrivalTime:P.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Z.name},checkinUrl:p,reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:Z.totalPrice,priceCurrency:Z.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Z.seats,seatingType:Z.seatingType[P.flightNumber]}}};valid(Z.membershipNumber,Z.programName)&&(E.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Z.membershipNumber,programName:Z.programName}),I.push(E)}return I.length?I:void 0}}).call();
