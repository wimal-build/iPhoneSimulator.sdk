// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var n=Scanner.fromMessage(e);if(n.setLocale(t),n.getSpan().nextText(r.flightSummary).exists()){var a,i,p,g,o,s,m,l,u,d,T,c,C,h,y,x=[],A={};p=n.getSpan().nextText(r.names).nextAnyTag("table");var v=""+p.innerCapture(/\[tr(\d+)\]/,1);for(p=p.allInnerTags("tr"+v).map(function(e){return e.allInnerTagsFiltered("td"+v)}),g=n.getSpan().nextText(r.price).nextText(r.totalPrice).parentAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),o=n.getSpan().nextText(r.priceCurrency).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1 (.*)\./,r.priceCurrency),1),s=n.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/,r.reservationId),1),h=0;p.length>h;h++)p[h].length>=3&&(i=p[h][0].innerCapture(/(.*)\s/,1).trim(),T=p[h][1].innerCapture(regExpFormatted(/^(\1)/,r.frequentFlyer),1).exists()?null:p[h][1],A[""+i]={name:i,programName:r.programName,membershipNumber:T,ticketNumber:p[h][2].innerCapture(regExpFormatted(/\1 #\s+(\d+)/,r.ticketNumber),1),totalPrice:g,priceCurrency:o,seats:{},seatingType:{}});for(d=n.getSpan().nextText(r.travelerInfo).parentAnyTag("table").allInnerTags("table"+v).map(function(e){return e.allInnerTags("td"+v).map(function(e){return e.tagContents()})}),d=n.getSpan().next(r.travelerInfo).parentAnyTag("table").allInnerTags("table"+v),c=1;d.length>c;c++)for(u=d[c].previousAnyTag("td").previousAnyTag("td").innerDate(),l=d[c].allInnerTags("tr"+v),C=1;l.length>C;C++)if(l[C].nextAnyTag("td").tagContents().innerCapture(/^([A-Z]{3}\s+\d+)/)){var b={};for(a=l[C].nextAnyTag("td").tagContents(),b.departureAirport=a.previousAnyTag("tr").nextAnyTag("td").nextAnyTag("td").tagContents(),b.arrivalAirport=b.departureAirport.nextAnyTag("td").tagContents(),b.departureCode=a.innerCapture(/([A-Z]{3})/,1),b.departureTime=combineDateAndTime(u,a.innerDate()),a=a.nextAnyTag("td").tagContents(),b.arrivalCode=a.innerCapture(/([A-Z]{3})/,1),b.arrivalTime=combineDateAndTime(u,a.innerDate()),a=a.nextAnyTag("tr").nextAnyTag("td").tagContents(),h=0;!a.innerCapture(/^(.+?)\s+\d+/)&&5>h;)a=a.nextAnyTag("tr").nextAnyTag("td").tagContents(),h++;if(b.airlineName=a.innerCapture(/^(.+?)\s+\d+/,1),b.flightNumber=a.innerCapture(/(\d+)/,1),y=a.nextAnyTag("td").tagContents().innerCapture(/(.*)\s+\|/,1),b.passengers=A,valid(b.flightNumber))for(p=Object.keys(A),h=0;p.length>h;h++)A[p[h]].seatingType[""+b.flightNumber]=y;not(b.airlineName)||(b.reservationId=n.getSpan().nextText(r.importantInfo).nextText(""+b.airlineName).nextAnyTag("td").tagContents()),ASSERT(b.departureTime,b.arrivalTime,b.departureCode,b.arrivalCode,b.flightNumber,b.airlineName)&&x.push(b)}m=r.cancelled.test(e.plain)?"Cancelled":"Confirmed";var f,N=[];for(c=0;x.length>c;c++){var S=x[c],I=Object.keys(S.passengers);for(C=0;I.length>C;C++){var F=S.passengers[I[C]];f={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:F.name},checkinUrl:S.checkinUrl,reservationId:s,reservationStatus:"http://schema.org/Reservation"+(m||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:F.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:F.seats[S.flightNumber],seatingType:F.seatingType[S.flightNumber]}},totalPrice:F.totalPrice,priceCurrency:F.priceCurrency},not(F.membershipNumber)||(f.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:F.membershipNumber,programName:F.programName}),N.push(f)}}if(N.length)return N}}}).call();