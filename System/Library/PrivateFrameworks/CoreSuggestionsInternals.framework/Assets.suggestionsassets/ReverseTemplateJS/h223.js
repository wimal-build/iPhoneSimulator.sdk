// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var i,n,o,p,l=a.getSpan(),s="Confirmed",m=[],g=[];i=/- (.*)/.exec(e.subject)[1],p=l.next(/To check in online/).nextLink();var u=l.allInnerTags("table3").filter(function(e,r){var t=""+e;return t.indexOf("Cabin Class")>-1});return u.forEach(function(e,r){var t,i,n,o,p,s,g,u,c,d="Singapore Airlines",h="SQ",T=/\((.*)\).*to.*\((.*)\).*\n/.exec(""+e);p=T[1],u=T[2];var v=e.nextAnyTag("table").nextAnyTag("table");t=/SQ([0-9]*)/.exec(""+v)[1];var A=(""+v.nextAnyTag("table").nextAnyTag("td").tagContents()).split("\n");o=A[0],n=A[1].replace(/[\(\)]/g," "),n=getFuzzyDate(a.getDetachedSpan(n).firstDate());var b=(""+v.nextAnyTag("table").nextAnyTag("table").nextAnyTag("td").tagContents()).split("\n");g=b[0],s=b[1].replace(/[\(\)]/g," "),s=getFuzzyDate(a.getDetachedSpan(s).firstDate()),c=l.next("Passengers").parentTag("table4").allInnerTags("tr4"),c.shift(),c.forEach(function(e,r){var a;a=e.nextAnyTag("td").nextAnyTag("td").tagContents(),m.push({airlineName:d,airlineCode:h,flightNumber:t,departureDateTime:n,departureAirport:o,departureAirportCode:p,arrivalDateTime:s,arrivalAirport:g,arrivalAirportCode:u,ticketNumber:i,underPersonName:a})})}),m.forEach(function(e,r){ASSERT(e.departureDateTime,e.arrivalDateTime,e.departureAirportCode,e.arrivalAirportCode),g.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:e.airlineName,airlineCode:e.airlineCode,flightNumber:e.flightNumber,departureAirportFuzzy:e.departureAirport,departureAirportCode:e.departureAirportCode,departureTime:e.departureDateTime,arrivalAirportFuzzy:e.arrivalAirport,arrivalAirportCode:e.arrivalAirportCode,arrivalTime:e.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:e.underPersonName},checkinUrl:p,reservationId:i,reservationStatus:"http://schema.org/Reservation"+s,totalPrice:n,priceCurrency:o,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:e.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:e.seatNumber,seatingType:e.seatType}},programMembershipUsed:{"@type":"http://schema.org/ProgramMembership",membershipNumber:e.membershipNumber,programName:e.programName}})}),g.length>=1?g:CONTINUE}}).call();
