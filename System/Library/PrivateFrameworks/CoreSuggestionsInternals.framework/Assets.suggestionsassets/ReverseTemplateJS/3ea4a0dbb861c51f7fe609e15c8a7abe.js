// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline-car-confirmation-en",function(e){return/^Your priceline itinerary/.test(e.subject)},function(e){if(/Vacation Package Confirmation/.test(e.plain))return CONTINUE;if(/^Your priceline itinerary/.test(e.subject)&&(/Thanks for booking your rental car/.test(e.plain)||/Rental Car Confirmation/.test(e.plain))){var t=loadHelper("priceline-schemaorg-parser.js"),n=t(e);if(n)return n;var r="en_US",a={};a.pickUpDateTime_prefix=/Pick-up/,a.dropOffDateTime_prefix=/Drop-off/,a.address_prefix=/Rental Location/,a.reservationId_prefix=/Confirmation Number:/,a.providerName_prefix=/Rental Partner:/,a.underPersonName_prefix=/Driver Name:/;var i=loadHelper("priceline-car-confirmation-skeleton.js");return i(e,r,a)}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1172/1173","SG5ccaa7b0"),new ReverseTemplate("priceline-package-confirmation-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var n=e.innerAddress();if(n.getLength()>0)for(var r=n.split(" ")[0],a=1;t.length>a;a++)if((""+t[a]).split(" ")[0]===""+r){e=n;break}return""+e}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var r,a,i,o,s,p,g,l,m,c,u,d,x,h,f,T,C,v,S,b,y,N,k,R,A,P,D,I,U,$,F,E,L,O,j,w,Z,z,_,H,Y,G,M,B=[],V=[],q=[],J={},K=[],Q=[];if(n.getSpan().nextText("time to pack your bags").exists())N=!0,a=n.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1),J[""+a]={name:""+a,totalPrice:null,currency:null,seats:{},seatingType:{}},d=n.getSpan().nextText("Departing").parentTag("table5").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{if(o=n.getSpan().nextText("Amount Charged to Card").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1),c=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1),V=n.getSpan().nextText("Passenger and Ticket Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),V.length)for(var W=0,X=V.length;X>W;W+=4)a=V[W][1],not(a)||(J[""+a]={name:""+a,totalPrice:s,currency:c,seats:{},seatingType:{}});d=n.getSpan().nextText("Flight Details").nextTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(d.length)for(var ee,W=0;ee=d[W];W++)if(""+ee[0]=="Departing")i=ee[0].withStart(ee[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,y=i?i.$arrivalCode:null,C=ee[1],T=ee[2].innerDate();else if(""+ee[0]=="Arriving")b=ee[1],S=ee[2].innerDate();else if(""+ee[0]=="Flight / Class"||""+ee[0]=="Airline / Flight"){if(h=ee[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),f=h?h.$name:null,x=h?h.$flightNumber:null,N?(u=null,g=ee[2]&&ee[2].innerCapture(/Conf Number: (.*)/,1)):(u=ee[2],g=ee[3]&&ee[3].innerCapture(/Conf Number: (.*)/,1)),valid(x)){V=Object.keys(J);for(var a,te=0;a=V[te];te++)J[a].seatingType[""+x]=u}ASSERT(f,x,C,T,v,b,S,y)&&(q.push({airlineName:f,flightNumber:x,departureAirport:C,departureCode:v,departureTime:T,arrivalAirport:b,arrivalTime:S,arrivalCode:y,reservationId:g,passengers:J}),h=f=x=C=T=v=b=S=y=g=null)}if(!n.getSpan().nextText("Hotel Reservation").exists()&&!n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(n.getSpan().nextText("Hotel Reservation").exists()?(a=n.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),g=n.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=n.getSpan().nextText("Hotel Reservation"),D=i.nextTag("td9").tagContents(),A=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),I=A.innerPhoneNumber(),U=A.tagContents(),I.exists()&&(U=U.withEnd(I.getStart()).trim()),A.innerAddress().getLength()>=U.getLength()&&(U=A.innerAddress()),k=i.nextText("Check-In").nextTag("td11").innerDate(),R=i.nextText("Check-Out").nextTag("td11").innerDate(),s=n.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(a=n.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),g=n.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),D=n.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),A=D.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),U=A?A.$address:null,I=A?A.$phone:null,k=n.getSpan().nextText("Check-In").nextDate(),R=n.getSpan().nextText("Check-Out").nextDate()),ASSERT(k,R,U)&&K.push({name:a,reservationId:g,totalPrice:s,priceCurrency:p,checkInDateTime:k,checkOutDateTime:R,hotelName:D,hotelUrl:P,hotelPhone:I,hotelAddress:U})),n.getSpan().nextText("Your Rental Car Confirmation").exists()){M=n.getSpan().next(/Pick-up: \n/).nextDate(),Y=n.getSpan().nextText("Rental Location").nextAddress(),z=n.getSpan().next(/Drop-off: \n/).nextDate(),w=Y,a=n.getSpan().next(/Driver Name: \n+(.*?)\s\s/).innerCapture(/Driver Name: \n+(.*?)\s\s/,1).trim(),g=n.getSpan().next(/Confirmation Number: \n+(.*?)\s/).innerCapture(/Confirmation Number: \n+(.*?)\s/,1),$=n.getSpan().next(/Modify Reservation/).nextLink(),F=n.getSpan().next(/Cancel Reservation/).nextLink(),L=n.getSpan().next(/Rental Car Contact Information/).nextTag("td6").tagContents().trim(),g.exists()&&(E=n.getSpan().next(/Car Type: \n+(.*)\n/).innerCapture(/Car Type: \n+(.*)\n/,1).trim()),Z=n.getSpan().next(/Phone Number \n+(.*?)\s\s/).innerCapture(/Phone Number \n+(.*?)\s\s/,1).trim(),G=Z;var ne=n.getSpan().next("Estimated Total").nextAnyTag("td");s=ne.tagContents().innerCapture(/.*?([\d,.]+)/,1).trim(),p=ne.tagContents().innerCapture(/(\w+)\s.*?[\d,.]+/,1).trim(),ASSERT(M,L,g,OR(Y,H))&&Q.push({name:a,brand:E,pickupTime:M,pickupName:H,pickupAddress:Y,pickupTelephone:G,dropoffTime:z,dropoffName:j,dropoffAddress:w,dropoffTelephone:Z,provider:L,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:$,cancelReservationUrl:F})}else if(n.getSpan().nextText("Rental Car Confirmation").exists()){if(_=n.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),_.length>=3&&(M=_[0].innerDate(),H=_[1].tagContents(),Y=n.getDetachedSpan(_.slice(2).join(" ")),Y=t(Y,_)),O=n.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),O.length>=3&&(z=O[0].innerDate(),j=O[1].tagContents(),w=n.getDetachedSpan(O.slice(2).join(" ")),w=t(w,O)),a=n.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),g=n.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),!g.exists()){var re=n.getSpan().next(/Rental Car Confirmation Number.*\n(.*?)\:\s+(\w+)/).innerCapture(/Rental Car Confirmation Number.*\n($<provider>.*?)\:\s+($<reservationId>\w+)/);L=re.$provider,g=re.$reservationId}if($=n.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),F=n.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),g.exists()&&(L&&L.exists()||(L=n.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+g),1)),L.exists())){var ae=n.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();E=ae.innerCapture(regExpFormatted(/\1 (.*)$/,""+L),1),E.exists()||(""+ae).match(/\n/)&&(E=ae.withStart(ae.next("\n").getEnd()))}Z=(""+n.getSpan().nextText("Phone Number").nextTag("td10").tagContents()).trim(),G=Z,s=n.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)\(?/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(M,L,g,OR(Y,H))&&Q.push({name:a,brand:E,pickupTime:M,pickupName:H,pickupAddress:Y,pickupTelephone:G,dropoffTime:z,dropoffName:j,dropoffAddress:w,dropoffTelephone:Z,provider:L,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:$,cancelReservationUrl:F})}for(var W=0;q.length>W;W++)for(var ie=q[W],oe=Object.keys(ie.passengers),se=0;oe.length>se;se++){var pe=ie.passengers[oe[se]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:ie.airlineName,flightNumber:ie.flightNumber,departureAirportFuzzy:ie.departureAirport,departureAirportCode:ie.departureCode,departureTime:ie.departureTime,arrivalAirportFuzzy:ie.arrivalAirport,arrivalAirportCode:ie.arrivalCode,arrivalTime:ie.arrivalTime},underName:{"@type":"http://schema.org/Person",name:pe.name},checkinUrl:m,reservationId:ie.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:pe.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:pe.seats[ie.flightNumber],seatingType:pe.seatingType[ie.flightNumber]}},totalPrice:pe.totalPrice,priceCurrency:pe.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(pe.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:pe.membershipNumber,programName:pe.programName}),B.push(r)}for(var ge,W=0;Q.length>W;W++)ge=Q[W],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:ge.totalPrice,priceCurrency:ge.priceCurrency,reservationId:ge.reservationId,reservationStatus:"http://schema.org/Reservation"+(ge.reservationStatus||"Confirmed"),checkinUrl:ge.checkinUrl,modifyReservationUrl:ge.modifyReservationUrl,cancelReservationUrl:ge.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:ge.name,email:ge.email},provider:{"@type":"http://schema.org/Organization",name:ge.provider},pickupTime:ge.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:ge.pickupName,telephone:ge.pickupTelephone,address:ge.pickupAddress},dropoffTime:ge.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:ge.dropoffName,telephone:ge.dropoffTelephone,address:ge.dropoffAddress}},ge.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:ge.brand},license:ge.license,color:ge.color}),B.push(r);for(var A,W=0;K.length>W;W++)A=K[W],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:A.name,email:A.email},totalPrice:A.totalPrice,priceCurrency:A.priceCurrency,checkinTime:A.checkInDateTime,checkoutTime:A.checkOutDateTime,modifyReservationUrl:A.modifyReservationUrl,cancelReservationUrl:A.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(A.reservationStatus||"Confirmed"),reservationId:A.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:A.hotelName,url:A.hotelUrl,telephone:A.hotelPhone,address:A.hotelAddress}},B.push(r);if(B.length)return B}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1172/1176","SGd546163e")]);
