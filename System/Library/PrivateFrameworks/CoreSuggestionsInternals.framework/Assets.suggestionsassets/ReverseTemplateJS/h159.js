// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r,a){var n=Scanner.fromMessage(e);n.setLocale(t);var i,p,g,x,o,u,l,m=[],d=[],h=[],s=1,c="Confirmed",v="NH";x=n.getSpan().nextText(r.price).nextText("\n"),x=n.getSpan().withInterval(x.getEnd(),x.nextText("\n").getStart()),o=x.innerCapture(regExpFormatted(/([\d\., ]+)/),1).trim(),u=x.innerCapture(regExpFormatted(/([^\d\., ]+)/),1),i=n.getSpan().nextText(r.passenger).nextText("\n"),i=n.getSpan().withInterval(i.getEnd(),i.nextText(r.passengerSuffix).getStart()),g=n.getSpan().innerCapture(regExpFormatted(/\1\s*(\w*)\s/,r.reservationId),1);do ASSERT(i)&&d.push({name:i}),i=i.nextText("\n"),i=n.getSpan().withInterval(i.getEnd(),i.nextText("\n").getStart());while(i.getLength());for(p=n.getSpan().nextText(r.flight).nextText("[1]"),n.getSpan().nextText(r.limit).exists()?c="Pending":n.getSpan().nextText(r.cancel).exists()?c="Cancelled":n.getSpan().nextText(r.refund).exists()&&(c="Cancelled");p.exists();){var T,S,z,f={},y=p.nextDate();f.flightNumber=p.nextRegExp(regExpFormatted(/\d{3,4}/)),S=f.flightNumber.nextDate(),T=f.flightNumber.nextDate().nextDate(),f.departureAirportFuzzy=n.getSpan().withInterval(f.flightNumber.getEnd(),S.previousText("(").getStart()).trim(),f.arrivalAirportFuzzy=n.getSpan().withInterval(f.flightNumber.nextText("-").getEnd(),T.previousText("(").getStart()).trim(),f.departureTime=getFuzzyDate(n.getDetachedSpan(y+" "+S)),f.arrivalTime=getFuzzyDate(n.getDetachedSpan(y+" "+T)),z=p.nextText(r.ticket),f.ticketNumber=n.getSpan().withInterval(z.getEnd(),z.nextText("\n").getStart()).trim(),ASSERT(f.arrivalAirportFuzzy,f.departureAirportFuzzy,f.flightNumber,f.departureTime,f.arrivalTime)&&m.push(f),s++,p=p.nextText("["+s+"]")}for(var F=0;m.length>F;F++)for(var N=m[F],A=0;d.length>A;A++){var b=d[A],E={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"All Nippon Airways",airlineCode:v,flightNumber:N.flightNumber,departureAirportFuzzy:N.departureAirportFuzzy,departureAirportCode:N.departureAirportCode,departureTime:N.departureTime,arrivalAirportFuzzy:N.arrivalAirportFuzzy,arrivalAirportCode:N.arrivalAirportCode,arrivalTime:N.arrivalTime},underName:{"@type":"http://schema.org/Person",name:b.name},checkinUrl:l,reservationId:g,reservationStatus:"http://schema.org/Reservation"+c,totalPrice:o,priceCurrency:u,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:N.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:N.seatNumber,seatingType:""}}};h.push(E)}return h.length?h:void 0}}).call();
