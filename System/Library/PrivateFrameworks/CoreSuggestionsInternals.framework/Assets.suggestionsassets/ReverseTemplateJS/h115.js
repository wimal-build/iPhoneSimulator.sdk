// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,o,m,u,d,s,l,T=[];for(n=a.getSpan().nextText(r.passenger).nextTag("tr4").nextTag("tr4").nextTag("tr4").innerTag("td4").nextTag("td4").tagContents().innerCapture(regExpFormatted(/\.(.*)/),1).trim(),m=a.getDetachedSpan(e.subject).innerCapture(regExpFormatted(/(\w+)$/),1),u=a.getSpan().nextText(r.totalPayment).previousText(r.total).nextTag("td4").tagContents(),i=u.innerCapture(regExpFormatted(/([\d\.,\s]+)/),1).trim(),p=u.innerCapture(regExpFormatted(/([^\d\.,\s]+)/),1).trim(),g=m,d=a.getSpan().nextText(r.flightData).parentTag("table4").allInnerTagsFiltered("tr4"),s=1;d.length>s;s+=2){l={};var h=d[s],c=d[s+1];l.flightNumber=h.innerCapture(regExpFormatted(/\1.*\s+(\d{2,}):/,r.number),1),l.departureAirport=c.nextTag("tr5").innerTag("td5").tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),l.departureTime=getFuzzyDate(a.getDetachedSpan(h.innerDate()+" "+c.firstDate())),l.arrivalAirport=c.nextTag("tr5").innerTag("td5").nextTag("td5").tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),l.arrivalTime=a.getDetachedSpan(h.innerDate()+" "+c.firstDate().nextDate()),l.seatingNumber=c.innerCapture(regExpFormatted(/\1: (.+)/,r.seat),1),ASSERT(l.departureTime,l.arrivalTime,l.departureAirport,l.arrivalAirport,l.flightNumber)&&T.push(l)}var x=[];for(s=0;T.length>s;s++){l=T[s];var v={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Germanwings",airlineCode:"4U",flightNumber:l.flightNumber,departureAirportFuzzy:l.departureAirport,departureAirportCode:l.departureIata,departureTime:l.departureTime,arrivalAirportFuzzy:l.arrivalAirport,arrivalAirportCode:l.arrivalIata,arrivalTime:l.arrivalTime},underName:{"@type":"http://schema.org/Person",name:n},checkinUrl:o,reservationId:m,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:i,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:g,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:l.seatingType,seatNumber:l.seatingNumber}}};x.push(v)}return x.length?x:CONTINUE}}).call();