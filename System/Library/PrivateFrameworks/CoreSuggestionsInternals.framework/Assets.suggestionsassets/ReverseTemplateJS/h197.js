// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,l={},o=[],g={};n=a.getSpan().innerCapture(regExpFormatted(/\1: (.*?) /,r.bookingCode),1);var s=a.getSpan().next(r.passengersHeader).nextTag("table9").allInnerTags("tr9");if(s){nbPassengers=s.length-1;for(var p=1;p<nbPassengers+1;p++){var d=s[p].allInnerTags("td9"),u=(""+d[0].tagContents()).trim(),m=regExpFormatted(/\1/,r.child.toLowerCase()).test(u.toLowerCase())?"child":"adult";u=u.replace(/\(.*\)/,"").trim();var h=""+d[1].tagContents();h==r.withoutCard&&(h="");var v="";d[2]&&(v=""+d[2].tagContents()),l[u]={ticketNumber:v,membershipNumber:h,ageCategory:m}}}var c=a.getSpan().firstText(r.reservationDetails).nextText(r.flightDetails).nextTag("table8").allInnerTags("table9");if(c){for(var C={},p=0,T=c.length;T>p;p++)regExpFormatted(/\1.*\2/,r.departure,r.arrival).test(""+c[p])&&(C[p]=1);for(var p in C)for(var f=c[p].allInnerTags("tr9"),b=0,T=f.length;T>b;b+=2){var x=f[b].nextTag("td9").nextTag("td9").tagContents(),y=f[b+1].allInnerTags("td9"),N="Iberia",F="IB",A=x.innerCapture(r.flightNumber);F=""+A.$airlineCode,x=""+A.$flightNumber;var S=getFuzzyDate(y[1]),z=y[1].tagContents().innerCapture(/\n($<name>.*) \(($<code>[A-Z]{3})\)/),I=z?z.$name:null,$=z?z.$code:null,k=getFuzzyDate(y[2]),E=y[2].tagContents().innerCapture(/\n($<name>.*) \(($<code>[A-Z]{3})\)/),P=E?E.$name:null,D=E?E.$code:null;y[4]?""+y[4].tagContents():"";ASSERT(N,x,$,S,D,k)&&o.push({airlineName:N,airlineCode:F,flightNumber:x,departureAirport:I,departureCode:$,departureTime:S,arrivalAirport:P,arrivalCode:D,arrivalTime:k})}}var w=a.getSpan().firstText(r.priceHeader).nextTag("table8").nextTag("table9").allInnerTags("tr9");if(w){i=""+a.getSpan().firstText(r.totalPrice).nextTag("td9").tagContents().trim(),i=i.charAt(i.length-1);for(var L=w.length-1,p=1;L+1>p;p++){var R,d=w[p].allInnerTags("td9"),R=regExpFormatted(/\1/,r.adult).test(""+d[0])?"adult":regExpFormatted(/\1/,r.child).test(""+d[0])?"child":null;valid(R)&&(g[R]=""+d[5].tagContents())}}var H=[];for(p=0;o.length>p;p++)for(var Z=o[p],j=Object.keys(l),b=0;j.length>b;b++){var B=l[j[b]],M=g[B.ageCategory],O={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:Z.airlineName,airlineCode:Z.airlineCode,flightNumber:Z.flightNumber,departureAirportFuzzy:Z.departureAirport,departureAirportCode:Z.departureCode,departureTime:Z.departureTime,arrivalAirportFuzzy:Z.arrivalAirport,arrivalAirportCode:Z.arrivalCode,arrivalTime:Z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j[b],email:""},checkinUrl:"",reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:M,priceCurrency:i,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:B.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};H.push(O)}return H.length?H:void 0}}).call();
