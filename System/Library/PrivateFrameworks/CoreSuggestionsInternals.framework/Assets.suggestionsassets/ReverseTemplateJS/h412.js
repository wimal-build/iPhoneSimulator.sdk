// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e),i=a.getSpan();a.setLocale(t);var n,o,g,l,p,T,x,m,d,s,u,c,v;n=i.nextText(r.reservationIdPrefix).nextTag("td3").tagContents(),l=i.nextText(r.totalCostPrefix).parentTag("td3").tagContents().innerCapture(regExpFormatted(/\1(.+)/,r.totalCostPrefix),1);var C,h=(l.innerCapture(/([\d,.-]+)/,1),l.innerCapture(/([^\d,.-\w]+)/,1).trim(),!0);C=i.nextText(r.singleTripPrefix),C.exists()||(h=!1,C=i.nextText(r.roundTripPrefix),C.exists()||(C=i.nextText(r.conjectionPrefix))),C=C.nextTag("table3").allInnerTagsFiltered("tr3");for(var b,f=[],A=0;C.length>A;A++){b={};var N,P=/\u7968\u53f7\uff1a/;N=C[A].innerCapture(P.test(C[A])?/($<name>.+?)\[.*\u7968\u53f7\uff1a($<ticketNumber>.+)/:/($<name>.+?)\[/),b.name=N.$name.trim(),b.ticketNumber=N.$ticketNumber,f.push(b)}var y=[];if(h)b={},[,u,v,s]=i.nextText(r.singleTripPrefix).nextTag("table3").nextTag("tr2").nextTag("td2").nextTag("td2").tagContents().innerCapture(/(.+)\u2192(.+)\s(.+)/),b.departureAirport=u.trim(),b.arrivalAirport=v.trim(),s=s,[,x,m,g]=i.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table3").nextTag("td3").tagContents().innerCapture(/(.+?)\s([A-Z0-9]{2})([\d]+)/),b.airlineName=x,b.airlineCode=m,b.flightNumber=g,d=i.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table4").nextTag("td4").tagContents(),c=i.nextText(r.singleTripPrefix).nextTag("table3").nextTag("table4").nextTag("td4").nextTag("td4").nextTag("td4").tagContents(),b.departureTime=combineDateAndTime(s,d),b.arrivalTime=combineDateAndTime(s,c),ASSERT(b.departureAirport,b.arrivalAirport,b.departureTime,b.arrivalTime,b.airlineCode,b.flightNumber)&&y.push(b);else{b={};for(var S=1,k=a.getSpan().nextText(r.legPrefix+""+S);k.exists();)b={},[,u,v,s]=k.nextTag("td2").tagContents().innerCapture(/(.+)\u2192(.+)\s(.+)/),b.departureAirport=u.trim(),b.arrivalAirport=v.trim(),s=s,[,x,m,g]=k.nextTag("table3").nextTag("td3").tagContents().innerCapture(/(.+?)\s([A-Z0-9]{2})([\d]+)/),b.airlineName=x,b.airlineCode=m,b.flightNumber=g,d=k.nextTag("table4").nextTag("td4").tagContents(),c=k.nextTag("table4").nextTag("td4").nextTag("td4").nextTag("td4").tagContents(),b.departureTime=combineDateAndTime(s,d),b.arrivalTime=combineDateAndTime(s,c),ASSERT(b.departureAirport,b.arrivalAirport,b.departureTime,b.arrivalTime,b.airlineCode,b.flightNumber)&&y.push(b),S++,k=i.nextText(r.legPrefix+""+S)}var F,z=[];for(A=0;y.length>A;A++)for(var $=y[A],D=0;f.length>D;D++){var R=f[D];F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:$.airlineName,airlineCode:$.airlineCode,flightNumber:$.flightNumber,departureAirportFuzzy:$.departureAirport,departureAirportCode:$.departureCode,departureTime:$.departureTime,arrivalAirportFuzzy:$.arrivalAirport,arrivalAirportCode:$.arrivalCode,arrivalTime:$.arrivalTime},underName:{"@type":"http://schema.org/Person",name:R.name},checkinUrl:o,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:R.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}},totalPrice:p,priceCurrency:T,reservationStatus:"http://schema.org/ReservationConfirmed"},z.push(F)}return z.length?z:void 0}}).call();
