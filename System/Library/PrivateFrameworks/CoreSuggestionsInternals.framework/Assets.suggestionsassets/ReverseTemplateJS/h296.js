// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,n){var a=Scanner.fromMessage(e);a.setLocale(t);var r,i,g,o,s,p,c,C,d,m,x,u,T,S,l,h,A,y,f,D;if(!n.emailTitelConfirmation.test(e.subject)&&!n.emailTitelCancelConfirmation.test(e.subject))return CONTINUE;if(n.ca.test(a.getSpan().tagContents())&&a.setLocale("en_CA"),n.au.test(a.getSpan().tagContents())&&a.setLocale("en_AU"),n.ie.test(a.getSpan().tagContents())&&a.setLocale("en_IE"),n.emailTitelConfirmation.test(e.subject)&&(n.ca.test(a.getSpan().tagContents())||n.au.test(a.getSpan().tagContents())||n.ie.test(a.getSpan().tagContents()))){s=a.getSpan().nextText(n.reservationId).nextAnyTag("td").tagContents(),r=a.getSpan().nextText(n.guestName).nextAnyTag("td").tagContents();var N=a.getSpan().nextText(n.dateText).parentTag("td1").tagContents().innerDate();m=N.innerCapture(/(.+)\-(.+)/,1),d=a.getSpan().nextText(n.checkinTime).nextAnyTag("td").tagContents(),x=getFuzzyDate(a.getDetachedSpan(m+" "+d).innerDate()),T=N.innerCapture(/(.+)\-(.+)/,2),u=a.getSpan().nextText(n.checkoutTime).nextAnyTag("td").tagContents(),S=getFuzzyDate(a.getDetachedSpan(T+" "+u).innerDate()),c=a.getSpan().nextText(n.price).nextAnyTag("td").tagContents(),g=c.innerCapture(/([\d,.]+)/,1),o=c.innerCapture(/([^\d,.]+)/,1).trim(),D=f=a.getSpan().nextText(n.modifyUrl).parentAnyTag("td").tagContents().innerLink(),C=a.getSpan().nextText(n.dateText).nextTag("td2").tagContents(),h=C.innerCapture(regExpFormatted(/(.+)</),1),l=C.innerLink();var C=a.getSpan().nextText(n.dateText).parentTag("td1").tagContents();if(y=C.innerAddress(),A=C.lastInnerPhoneNumber(),A.exists()&&!y.exists()&&(y=A.previousRegExp(/\n/).previousRegExp(/.+/).innerCapture(/(.+)/,1).trim()),!ASSERT(r,s,x,S,y))return CONTINUE;p="Confirmed"}else if(n.emailTitelConfirmation.test(e.subject)){if(n.com2016.test(a.getSpan().tagContents())?(s=a.getSpan().innerCapture(n.com2016ReservationId,1),r=a.getSpan().innerCapture(n.com2016GuestName,1),[,m,d]=a.getSpan().innerCapture(n.com2016CheckinDateTime),[,T,u]=a.getSpan().innerCapture(n.com2016CheckoutDateTime),x=a.getDetachedSpan(m+" "+d),S=a.getDetachedSpan(T+" "+u),C=a.getSpan().nextRegExp(n.com2016HotelInfo).parentAnyTag("td").tagContents(),h=C.innerCapture(/(.+)/,1),l=C.innerLink(),A=C.innerPhoneNumber(),y=C.innerAddress(),A.exists()&&!y.exists()&&(y=(""+C.innerCapture(/(.+)\n((?:.|\n)+)\n(.+)/,2)).replace(/\n/," ").replace(/\s+/," ").trim()),c=a.getSpan().nextText(n.price).nextAnyTag("td").tagContents(),g=c.innerCapture(/([\d,.]+)\n.+$/,1),o=c.innerCapture(/([^\d,.]+)\s*[\d,.]+\n.+$/,1).trim()):(s=a.getSpan().nextText(n.comReservationId).nextAnyTag("td").tagContents(),r=a.getSpan().nextText(n.guestName).nextAnyTag("td").tagContents(),m=a.getSpan().nextText(n.comCheckinDate).nextAnyTag("td").tagContents(),T=a.getSpan().nextText(n.comCheckoutDate).nextAnyTag("td").tagContents(),u=a.getSpan().nextText(n.comCheckoutTime).nextAnyTag("td").tagContents(),d=a.getSpan().nextText(n.comCheckinTime).nextAnyTag("td").tagContents(),x=combineDateAndTime(m,d),S=combineDateAndTime(T,u),C=a.getSpan().nextText(n.comHotelInfo).parentAnyTag("table").tagContents(),h=C.innerCapture(regExpFormatted(/(.+)</),1),l=C.innerLink(),A=C.innerPhoneNumber(),y=C.innerAddress(),c=a.getSpan().nextText(n.price).nextAnyTag("td").tagContents(),g=c.innerCapture(/([\d,.]+)/,1),o=c.innerCapture(/([^\d,.]+)\s\(/,1).trim()),D=f=a.getSpan().nextText(n.comModifyUrl).parentAnyTag("td").tagContents().innerLink(),!ASSERT(r,s,x,S,y))return CONTINUE;p="Confirmed"}if(n.emailTitelCancelConfirmation.test(e.subject)&&(n.ca.test(a.getSpan().tagContents())||n.au.test(a.getSpan().tagContents())||n.ie.test(a.getSpan().tagContents()))){if(s=a.getSpan().innerCapture(n.cancelReservationId,1),r=a.getSpan().innerCapture(n.cancelGuestName,1),C=a.getSpan().nextRegExp(n.cancelReservationId).nextTag("td2").tagContents(),h=C.innerCapture(regExpFormatted(/(.+)</),1),l=C.innerLink(),C=a.getSpan().nextRegExp(n.cancelReservationId).parentTag("td1").tagContents(),y=C.innerAddress(),A=C.allInnerPhoneNumbers()[1],x=a.getSpan().innerCapture(n.cancelDates,1),x=C.innerDate(),S=a.getSpan().innerCapture(n.cancelDates,2),S=getFuzzyDate(a.getDetachedSpan(S+" 12:00")),!ASSERT(r,s,x,S,y))return CONTINUE;p="Cancelled"}else if(n.emailTitelCancelConfirmation.test(e.subject)){if(s=a.getSpan().innerCapture(n.cancelComReservationId,1),r=a.getSpan().innerCapture(n.cancelComGuestName,1),C=a.getSpan().nextTag("table8").tagContents(),h=C.innerCapture(regExpFormatted(/(.+)</),1),l=C.innerLink(),A=C.innerPhoneNumber(),y=C.innerAddress(),x=a.getSpan().innerCapture(n.cancelComDates,1),x=getFuzzyDate(a.getDetachedSpan(x+" 12:00")),S=a.getSpan().innerCapture(n.cancelComDates,2),S=getFuzzyDate(a.getDetachedSpan(S+" 12:00")),!ASSERT(r,s,x,S))return CONTINUE;p="Cancelled"}return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:i},totalPrice:g,priceCurrency:o,checkinTime:x,checkoutTime:S,modifyReservationUrl:f,cancelReservationUrl:D,reservationStatus:"http://schema.org/Reservation"+(p||"Confirmed"),reservationId:s,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:h,url:l,telephone:A,address:y}}]}}).call();
