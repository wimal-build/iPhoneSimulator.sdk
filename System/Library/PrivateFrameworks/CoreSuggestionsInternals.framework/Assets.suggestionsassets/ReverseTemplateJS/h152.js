// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,s,g,p,l,o,m,u,d,h,f,c,T,v,b,x=[],C={},y=loadHelper("united.com-common.js");n=a.getSpan().nextText(r.confirmationNumber).nextTag("td4").nextTag("td4").tagContents(),m=a.getSpan().nextText(r.seatAssignments).parentTag("td3"),g=m.allInnerCapture(regExpFormatted(/\1/,r.dateOfBirth)).filter(function(e){return e.length>0});for(var F={},N=0;g.length>N;N++)s=a.getSpan().innerCapture(regExpFormatted(/\]\s+(.*)\s+\1/,""+g[N][0].parentTag("table4")),1),m=s.nextTag("table4").withEnd(s.nextTag("table4").nextTag("table4").getEnd()),F[""+s]=m;if(a.getSpan().nextText(r.travelerInfo).exists()){g=a.getSpan().nextText(r.travelerInfo).parentTag("td4").allInnerTags("table5");for(var N=0;g.length>N;N++)s=g[N].nextTag("td5").tagContents(),C[s]={name:s,seats:{},seatingType:{}},C[s].seatMap=y.getSeatMap(g[N].nextText(r.seatAssignments).nextTag("td5").tagContents())}else{g=Object.keys(F);for(var N=0;g.length>N;N++){s=g[N],C[s]={name:s,seats:{},seatingType:{}},m=F[s].allInnerTags("table5");for(var S,E,A=0;m.length>A;A++)S=m[A].innerTag("th5").tagContents(),E=m[A].innerTag("td5").tagContents(),S.innerCapture(regExpFormatted(/^\1/,r.knownTravelerNumber))?C[s].ticketNumber=E:S.innerCapture(regExpFormatted(/^\1/,r.frequentFlyer))?(C[s].programName=r.frequentFlyer,C[s].membershipNumber=E):S.innerCapture(regExpFormatted(/^\1/,r.seatAssignments))&&(C[s].seatMap=y.getSeatMap(E))}}l=a.getSpan().nextText(r.flightDetails).nextTag("table4").allInnerTags("table5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return e.length>0});for(var k=0;l.length>k;k++){p=l[k];for(var z=0;p.length>z;z++)if(m=p[z],m.innerCapture(regExpFormatted(/^\1/,r.depart)))f=getFuzzyDate(m),c=m.innerCapture(/\(([A-Z]{3})/,1);else if(m.innerCapture(regExpFormatted(/^\1/,r.arrive)))T=getFuzzyDate(m),v=m.innerCapture(/\(([A-Z]{3})/,1);else if(m.innerCapture(regExpFormatted(/^\1/,r.flight))){if(u=m.innerCapture(regExpFormatted(/^\1\s*($<code>\w{2})($<flightNumber>\d+)/,r.flight)),d=u?u.$code:null,o=u?u.$flightNumber:null,b=m.innerCapture(regExpFormatted(/\1\s*(.*)\s+/,r.fareClass),1),valid(o)){g=Object.keys(C);for(var N=0;g.length>N;N++)if(valid(b)&&(C[g[N]].seatingType[""+o]=b.trim()),valid(c,v)){var I=""+c+" - "+v;C[g[N]].seats[""+o]=C[g[N]].seatMap[I]}}ASSERT(f,c,T,v,d,o)&&x.push({airlineCode:d,flightNumber:o,departureTime:f,departureCode:c,arrivalTime:T,arrivalCode:v,passengers:C}),f=c=T=v=u=d=o=b=null}}for(var M=[],k=0;x.length>k;k++)for(var j=x[k],O=Object.keys(j.passengers),$=0;O.length>$;$++){var q=j.passengers[O[$]];h={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:j.airlineCode,flightNumber:j.flightNumber,departureAirportFuzzy:j.departureAirport,departureAirportCode:j.departureCode,departureTime:j.departureTime,arrivalAirportFuzzy:j.arrivalAirport,arrivalAirportCode:j.arrivalCode,arrivalTime:j.arrivalTime},underName:{"@type":"http://schema.org/Person",name:q.name},checkinUrl:i,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:q.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:q.seats[j.flightNumber],seatingType:q.seatingType[j.flightNumber]}},totalPrice:q.price,priceCurrency:q.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},q.membershipNumber&&(h.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:q.membershipNumber,programName:"Frequent Flyer"}),M.push(h)}return M.length?M:void 0}}).call();