// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var i,n,p,o,u,g,l,m,d,s=[],h=[],c=[];p=a.getSpan().innerCapture(regExpFormatted(/\1\s*: (.*)/,t.reference),1).trim(),l=a.getSpan().nextText(t.number).parentTag("td1").tagContents().innerCapture(regExpFormatted(/\1(.*)/,t.number),1).trim(),o=a.getSpan().nextText(t.total).nextAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<totalPrice>[\d\.,]+)\s+($<priceCurrency>\w{3})/)),o&&(u=o.$totalPrice,g=o.$priceCurrency),i=a.getSpan().nextText(t.passenger).nextTag("tr1").nextTag("tr1").innerTag("td1").nextTag("td1").tagContents().innerCapture(regExpFormatted(/(.*)\s.*$/,t.passenger),1).trim(),h.push({name:i}),n=a.getSpan().firstTag("table1").allInnerTagsFiltered("tr1");for(var v=4;n.length>v;v+=4){d={};var T,C,x=n[v];C=x.innerDate(),C.exists()&&/^\d+/.test(x)&&(C=C.split("-"),T=x.previousText(t.return),T.exists()||(T=x.previousText(t.airfare)),T=T.nextDate(),m=n[v+1].withEnd(n[v+1].nextClosingTag("td1").getStart()).innerCapture(/($<airlineCode>\D+)($<flightNumber>\d+)/),d.flightNumber=m.$flightNumber,d.airlineCode=m.$airlineCode,d.departureTime=getFuzzyDate(a.getDetachedSpan(T+" "+C[0])),d.arrivalTime=getFuzzyDate(a.getDetachedSpan(T+" "+C[1])),d.departureAirportFuzzy=x.innerCapture(/\[td1\](.*)\-/,1).trim(),d.arrivalAirportFuzzy=x.innerCapture(/\[td1\].*\-(.*)/,1).trim(),d.airlineName=n[v+1].innerCapture(regExpFormatted(/\1\s*:(.*)\|/,t.operate),1).trim(),ASSERT(d.flightNumber,d.departureTime,d.arrivalTime,d.departureAirportFuzzy,d.arrivalAirportFuzzy)&&s.push(d))}for(var z=0;s.length>z;z++){d=s[z];for(var y=0;h.length>y;y++){var F=h[y],f={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:d.airlineName,airlineCode:d.airlineCode,flightNumber:d.flightNumber,departureAirportFuzzy:d.departureAirportFuzzy,departureAirportCode:d.departureAirportCode,departureTime:d.departureTime,arrivalAirportFuzzy:d.arrivalAirportFuzzy,arrivalAirportCode:d.arrivalAirportCode,arrivalTime:d.arrivalTime},underName:{"@type":"http://schema.org/Person",name:F.name},checkinUrl:"",reservationId:p,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:u,priceCurrency:g,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};c.push(f)}}return c.length?c:void 0}}).call();
