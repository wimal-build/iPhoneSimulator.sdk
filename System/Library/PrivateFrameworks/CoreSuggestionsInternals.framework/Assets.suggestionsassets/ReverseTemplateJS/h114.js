// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,o,m,d,u,s,l,h=[];for(n=a.getSpan().nextText(r.passenger).nextTag("td3").tagContents().innerCapture(regExpFormatted(/:(.*)/),1).trim(),m=a.getDetachedSpan(e.subject).innerCapture(regExpFormatted(/(\w+)$/),1),d=a.getSpan().nextText(r.total).nextTag("td3").tagContents(),i=d.innerCapture(regExpFormatted(/([\d\.,\s]+)/),1).trim(),p=d.innerCapture(regExpFormatted(/([^\d\.,\s]+)/),1).trim(),g=m,u=a.getSpan().nextText(r.flightData).nextTag("table3").allInnerTagsFiltered("tr3"),s=0;u.length>s;s+=2){l={};var c=u[s],T=u[s+1];l.flightNumber=c.innerCapture(regExpFormatted(/\1\s*:.*?(\d{2,})\s+/,r.number),1),l.departureAirport=T.withEnd(T.nextAnyTag("td").getStart()).tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),l.departureTime=getFuzzyDate(a.getDetachedSpan(c.innerDate()+" "+T.firstDate())),l.arrivalAirport=T.nextAnyTag("td").nextAnyTag("td").tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),l.arrivalTime=a.getDetachedSpan(c.innerDate()+" "+T.firstDate().nextDate()),ASSERT(l.departureTime,l.arrivalTime,l.departureAirport,l.arrivalAirport,l.flightNumber)&&h.push(l)}var v=[];for(s=0;h.length>s;s++){l=h[s];var x={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Germanwings",airlineCode:"4U",flightNumber:l.flightNumber,departureAirportFuzzy:l.departureAirport,departureAirportCode:l.departureIata,departureTime:l.departureTime,arrivalAirportFuzzy:l.arrivalAirport,arrivalAirportCode:l.arrivalIata,arrivalTime:l.arrivalTime},underName:{"@type":"http://schema.org/Person",name:n},checkinUrl:o,reservationId:m,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:i,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:g,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:l.seatingType,seatNumber:l.seatingNumber}}};v.push(x)}return v.length?v:CONTINUE}}).call();