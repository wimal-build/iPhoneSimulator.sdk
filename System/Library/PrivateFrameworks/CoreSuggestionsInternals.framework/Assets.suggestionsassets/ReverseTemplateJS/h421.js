// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e),i=a.getSpan();a.setLocale(r);var n,o;n=i.nextText(t.reservationIdPrefix).parentTag("td1").tagContents().innerCapture(regExpFormatted(/\1(.+)/,t.reservationIdPrefix),1);var l,p,d,s,u,g,h,m,v={},c=[],T=i.nextText(t.itineraryHeader).nextTag("table1").allInnerTagsFiltered("tr1");T.shift(),T.shift();for(var C=0;T.length>C;C++){v={};""+T[C].allInnerTagsFiltered("td1");[,s,p,g,m,u,h]=(""+T[C].allInnerTagsFiltered("td1")).match(/([0-9A-Z]{2})(\d+),(.+?),(.+?),(.+?),(.+?),/),v.airlineCode=s,v.flightNumber=p,v.departureAirport=g,v.arrivalAirport=m,v.departureTime=getFuzzyDate(a.getDetachedSpan(""+u)),v.arrivalTime=getFuzzyDate(a.getDetachedSpan(""+h)),ASSERT(v.departureAirport,v.arrivalAirport,v.departureTime,v.arrivalTime,v.airlineCode,v.flightNumber)&&c.push(v)}var f=[],x=i.nextText(t.itineraryHeader).nextTag("table1").nextTag("table1").allInnerTagsFiltered("tr1");for(x.shift(),C=0;x.length>C;C++)v={},[,l]=x[C].innerCapture(/(.+)\s\s\s\[\/td1\](\s?)\[td1\]/),v.name=l,f.push(v);d=i.nextText(t.totalCostPrefix).parentTag("td1").tagContents().innerCapture(regExpFormatted(/\1(.+)\n/,t.totalCostPrefix),1);var y=d.innerCapture(/([\d,.-]+)/,1),F=d.innerCapture(/([^\d,.-\w]+)/,1).trim();null!==F&&0!==(""+F).length||(F=d.innerCapture(/([^\d,.-]+)/,1).trim());var A,b=[];for(C=0;c.length>C;C++)for(var z=c[C],N=0;f.length>N;N++){var S=f[N];A={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:z.airlineName,airlineCode:z.airlineCode,flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:S.name},checkinUrl:o,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:S.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}},totalPrice:y,priceCurrency:F,reservationStatus:"http://schema.org/ReservationConfirmed"},b.push(A)}return b.length?b:void 0}}).call();
