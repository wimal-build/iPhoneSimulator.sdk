// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,o,p,s,d,m,g,c,l,h,u,T,v,y,C,f,A,k,x,N,S,b,I=[],R=[],$=[],F=[],U=[];for(b=a.getSpan().next(t.contactPerson).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,t.contactPerson),1),c=a.getSpan().next(t.passengers).parentAnyTag("table").allInnerTags("tr4"),n=1;c.length>n;n++)c[n].allInnerTags("td4").length>2&&(l=c[n],h={},h.name=l.nextAnyTag("td").tagContents(),$.push(h));for(f=a.getSpan().next(t.price).nextAnyTag("td").tagContents(),A=f.innerCapture(/([\d,.]+)/,1),k=f.innerCapture(/([^\d,.]+)/,1),o=a.getSpan().next(t.flightSummary).nextAnyTag("table").allInnerCapture(t.departure,0),n=0;o.length>n;n++)p=o[n],y={},s=(""+p.previousAnyTag("td").previousAnyTag("td").tagContents()).replace(/-/g," "),d=p.parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<departureAirport>.*)\s+\(($<departureCode>.*)\)\s+\1\s+($<departureTime>.*)/,t.departure)),y.departureAirport=d.$departureAirport,y.departureCode=d.$departureCode,y.departureTime=a.getDetachedSpan(""+s+" "+d.$departureTime).innerDate(),m=p.next(t.arrival).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<arrivalAirport>.*)\s+\(($<arrivalCode>.*)\)\s+\1\s+($<arrivalTime>.*)/,t.arrival)),y.arrivalAirport=m.$arrivalAirport,y.arrivalCode=m.$arrivalCode,y.arrivalTime=a.getDetachedSpan(""+s+" "+m.$arrivalTime).innerDate(),g=p.next(t.flight).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<airline>.*)\s+\1\s+($<flightNr>\d+)/,t.flight)),y.airlineName=g.$airline,y.flightNumber=g.$flightNr,y.seatingType=g.$flightNr.nextAnyTag("td").nextAnyTag("td").tagContents(),y.reservationId=a.getSpan().next(t.flightReservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,t.flightReservationId),1),ASSERT(y.airlineName,y.flightNumber,y.arrivalTime,y.departureTime,y.arrivalAirport,y.departureAirport)&&R.push(y);for(u=a.getSpan().next(t.carSummary).parentTag("table3").allInnerCapture(t.carPickup,0),n=0;u.length>n;n++)v=u[n],T={},T.pickupTime=v.parentAnyTag("td").tagContents().innerDate(),T.dropoffTime=v.next(t.carDropoff).parentAnyTag("td").tagContents().innerDate(),T.pickupAddress=T.dropoffAddress=v.next(t.carLocation).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,t.carLocation),1),T.reservationId=v.next(t.carReservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,t.carReservationId),1),T.provider=v.parentTag("td4").tagContents().innerCapture(/(.*)\:/,1),T.name=b,ASSERT(T.name,T.provider,T.dropoffTime,T.pickupTime)&&F.push(T);for(x=a.getSpan().next(t.hotelSummary).parentTag("table3").allInnerCapture(t.checkIn,0),n=0;x.length>n;n++)C=x[n],N={},S=C.parentAnyTag("td").innerCapture(regExpFormatted(/\1:\s+($<checkIn>.*)[\s\S]*\2:\s+($<checkOut>.*)/,t.checkIn,t.checkOut)),N.checkInDateTime=S.$checkIn.innerDate(),N.checkOutDateTime=S.$checkOut.innerDate(),N.address=C.parentAnyTag("table").innerAddress(),N.hotelName=C.parentAnyTag("table").nextAnyTag("td").tagContents(),N.phone=(""+C.next(t.hotelPhone).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+([\d\s\(\)-]*)\s+/,t.hotelPhonePrefix),1)).trim(),N.name=(""+C.parentAnyTag("table").parentAnyTag("table").parentAnyTag("table").inner(t.hotelUnderName).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)/,t.hotelUnderName),1)).trim(),ASSERT(N.hotelName,N.name,N.checkInDateTime)&&U.push(N);for(n=0,y;R.length>n;n++){y=R[n];for(var P=0;$.length>P;P++){var D=$[P];i={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:y.airlineName,airlineCode:y.airlineCode,flightNumber:y.flightNumber,departureAirportFuzzy:y.departureAirport,departureAirportCode:y.departureCode,departureTime:y.departureTime,arrivalAirportFuzzy:y.arrivalAirport,arrivalAirportCode:y.arrivalCode,arrivalTime:y.arrivalTime},underName:{"@type":"http://schema.org/Person",name:D.name},checkinUrl:y.checkinUrl,reservationId:y.reservationId,reservationStatus:"http://schema.org/Reservation"+(y.reservationStatus||"Confirmed"),totalPrice:A,priceCurrency:k,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:D.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:y.seats,seatingType:y.seatingType}}},valid(D.membershipNumber,D.programName)&&(i.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:D.membershipNumber,programName:D.programName}),I.push(i)}}for(n=0,T;F.length>n;n++)T=F[n],i={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:A,priceCurrency:k,reservationId:T.reservationId,reservationStatus:"http://schema.org/Reservation"+(T.reservationStatus||"Confirmed"),checkinUrl:T.checkinUrl,modifyReservationUrl:T.modifyReservationUrl,cancelReservationUrl:T.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:T.name,email:T.email},provider:{"@type":"http://schema.org/Organization",name:T.provider},pickupTime:T.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:T.pickupName,telephone:T.pickupTelephone,address:T.pickupAddress},dropoffTime:T.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:T.dropoffName,telephone:T.dropoffTelephone,address:T.dropoffAddress}},T.brand&&(i.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:T.brand},license:T.license,color:T.color}),I.push(i);for(n=0,N;U.length>n;n++)N=U[n],i={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:N.name,email:N.email},totalPrice:A,priceCurrency:k,checkinTime:N.checkInDateTime,checkoutTime:N.checkOutDateTime,modifyReservationUrl:N.modifyReservationUrl,cancelReservationUrl:N.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(N.reservationStatus||"Confirmed"),reservationId:N.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:N.hotelName,url:N.hotelUrl,telephone:N.phone,address:N.address}},I.push(i);return I.length?I:void 0}}).call();
