// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,n){var r=Scanner.fromMessage(e);r.setLocale(t);var a,i,o,p,g,c,d,s,m,l,x,h,u,f,S,y,C,T,v,A,E;if(o=r.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,n.confirmationNumberPrefix),1),o.exists()||(o=r.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,n.confirmationNumberAlternatePrefix),1)),!o.exists()){var R=e.subject.match(n.confirmationNumberInSubject);R&&(o=R[1])}n.cancellationEmailSubjectRegExp.test(e.subject)&&(p="Cancelled"),u=r.getSpan().nextText(n.informationHeader).nextAnyTag("table").innerText(n.namePrefix).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+($<name>.*)[^]+\2\s+($<email>.*)/,n.namePrefix,n.emailPrefix)),a=u?u.$name:null,i=u?u.$email:null,u=r.getSpan().nextRegExp(n.pickupRegex).nextAnyTag("table");var b=u.innerText(n.pickupHeader).parentAnyTag("td").tagContents();E=b.innerDate(),T=b.withStart(E.getEnd()).trim().innerCapture(/(.*)\s/,1),v=b.withStart(T.getEnd()).trim(),b.innerAddress().getLength()>=v.getLength()&&(v=b.innerAddress());var P=u.innerText(n.dropoffHeader).parentAnyTag("td").tagContents();if(C=P.innerDate(),f=P.withStart(C.getEnd()).trim().innerCapture(/(.*)\s/,1),S=P.withStart(f.getEnd()).trim(),P.innerAddress().getLength()>=S.getLength()&&(S=P.innerAddress()),"fr_FR"===t){E=""+b.innerCapture(/.*\n(.*)/,1),E=E.replace(/.+\.\,/,""),E=E.replace(/[.,]/g,"").trim();var F=E.match(/\w+\s(\d+)/,1);E=E.replace(/\d+/,""),E=F[1]+" "+E,E=getFuzzyDate(r.getDetachedSpan(E)),C=""+P.innerCapture(/.*\n(.*)/,1),C=C.replace(/.+\.\,/,""),C=C.replace(/[.,]/g,"").trim(),F=C.match(/\w+\s(\d+)/,1),C=C.replace(/\d+/,""),C=F[1]+" "+C,C=getFuzzyDate(r.getDetachedSpan(C))}return l=r.getSpan().next(n.vehicleHeader).nextText(n.carSummaryHeader).parentAnyTag("td").innerCapture(regExpFormatted(/\s+(.* \1)/,n.brandSuffix),1),s=r.getSpan().nextText(n.priceHeader).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),m=r.getSpan().nextText(n.priceHeader).nextAnyTag("td").tagContents().innerCapture(/([^\d,.\s]+)/,1),c=r.getSpan().nextText(n.modifyReservationUrlPrefix).nextLink(),not(E)&&not(T)&&not(v)?STOP:((not(f)||valid(f,T)&&""+T==""+f)&&(S=v,not(y)&&(y=A)),ASSERT(a,l,E,OR(T,v))?[{"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:s,priceCurrency:m,reservationId:o,reservationStatus:"http://schema.org/Reservation"+(p||"Confirmed"),checkinUrl:g,modifyReservationUrl:c,cancelReservationUrl:d,underName:{"@type":"http://schema.org/Person",name:a,email:i},provider:{"@type":"http://schema.org/Organization",name:"Alamo"},reservationFor:{"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:l},license:x,color:h},pickupTime:E,pickupLocation:{"@type":"http://schema.org/Place",name:T,telephone:A,address:v},dropoffTime:C,dropoffLocation:{"@type":"http://schema.org/Place",name:f,telephone:y,address:S}}]:void 0)}}).call();
