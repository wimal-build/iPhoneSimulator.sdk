// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){function a(){ASSERT(N.airlineName,N.flightNumber,N.departureAirportCode,N.departureDateTime,N.arrivalAirportCode,N.arrivalDateTime)&&(T.push(N),N={},h=!1)}var i=Scanner.fromMessage(e);i.setLocale(r);for(var n,o,m,p,d,g,l=i.getSpan().nextText(t.customerInformationHeader).parentTag("table6"),s=l.nextText(t.passengerNamePrefix).nextTag("td7").tagContents().trim(),u=l.nextText(t.tripSummaryHeader).nextText(t.flightSummaryHeader).nextText(t.ticketNumberSuffix).parentTag("td8").tagContents().innerCapture(regExpFormatted(/(\d+) \1/,t.ticketNumberSuffix),1),x=l.nextText(t.flightDetails).nextTag("table6").nextTag("table6").nextTag("table6"),f=x.nextTag("table7").allInnerTags("tr7").filter(function(e){return(""+e.tagContents()).length}),T=[],N={},h=!1,c=0;f.length>c;c++)n=f[c],n.innerText(t.operatedByPrefix).exists()?N.airlineName=n.innerText(t.operatedByPrefix).parentTag("td7").tagContents().innerCapture(regExpFormatted(/\1 (.+)/,t.operatedByPrefix),1):(n.innerText(t.flightNumberPrefix).exists()&&n.innerText(t.fromPrefix).exists()&&n.innerText(t.toPrefix).exists()&&(h&&a(),n.innerText(t.reservationIdPrefix).exists()?(m=n.firstTag("td7").tagContents().innerCapture(regExpFormatted(/^($<airlineName>.+)\n\1\s($<flightNumber>\d+)[^]+\2:\s($<reservationId>\w+)/,t.flightNumberPrefix,t.reservationIdPrefix)),N.airlineName=m.$airlineName.trim(),N.flightNumber=m.$flightNumber.trim(),N.reservationId=m.$reservationId.trim()):(o=n.firstTag("td7").tagContents().innerCapture(regExpFormatted(/^($<airlineName>.+)\n\1\s($<flightNumber>\d+)/,t.flightNumberPrefix)),N.airlineName=o.$airlineName.trim(),N.flightNumber=o.$flightNumber.trim()),d=n.nextTag("td7").nextTag("td7").tagContents(),p=d.innerCapture(/($<airportName>.+)\(($<airportCode>\w{3})\)/),N.departureAirportName=p.$airportName.trim(),N.departureAirportCode=p.$airportCode.trim(),N.departureDateTime=d.innerDate(),g=d.nextTag("td7"),p=g.innerCapture(/($<airportName>.+)\(($<airportCode>\w{3})\)/),N.arrivalAirportName=p.$airportName.trim(),N.arrivalAirportCode=p.$airportCode.trim(),N.arrivalDateTime=g.innerDate(),h=!0),n.innerTag("table8").exists()&&a());for(var C=i.getSpan().nextText(t.pricePrefix).nextTag("td8").tagContents().innerCapture(/($<currency>[^\d\.,]+)($<price>[\d\.,]+)/),v=C.$currency.trim(),$=C.$price.trim(),b=[],y=0;T.length>y;y++){var A=T[y];b.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:A.airlineName,airlineCode:A.airlineCode,flightNumber:A.flightNumber,departureAirportFuzzy:A.departureAirportName,departureAirportCode:A.departureAirportCode,departureTime:A.departureDateTime,arrivalAirportFuzzy:A.arrivalAirportName,arrivalAirportCode:A.arrivalAirportCode,arrivalTime:A.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:s},reservationId:A.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:$,priceCurrency:v,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:u,ticketedSeat:{"@type":"http://schema.org/Seat"}}})}return b}}).call();
