// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,o,p,m,g,s,l,u,d,h,c,v,C,N,T,b=[],f={};s=a.getSpan(),i=s.next(t.reservationId).innerCapture(t.reservationId,1);for(var y=a.getSpan().next(t.ticket).nextTag("table2").allInnerTags("td2"),x=0;y.length>x;x++){if(p=y[x].tagContents().trim(),n=y[x].previousPhoneNumber(),not(p))return CONTINUE;f[""+p]={name:p,seats:{},seatingType:{},ticketNumber:""+n,totalPrice:null,priceCurrency:null}}var S;do{S=S?S.next(t.leg):s.next(t.leg),m=S.next(t.departure).parentTag("table4").allInnerTags("td4");var I=m[1].previousDate();d=m[1].tagContents().trim(),c=m[4].tagContents().trim(),d=a.getDetachedSpan(I+" "+d),c=a.getDetachedSpan(I+" "+c),h=m[2].tagContents().trim(),v=m[5].tagContents().trim();var A=m[1].next(t.flightInfos).parentTag("tr3").allInnerTags("td3")[1].tagContents().innerCapture(t.flightSummary);g=A.$flightNumber,u=A.$airlineCode,l=A.$airlineName,C=a.getSpan().next(t.price).nextTag("td4").nextTag("td4"),N=a.getDetachedSpan(C.tagContents().innerCapture(regExpFormatted(/([\d\.,]+)/),1)+C.nextTag("td4").tagContents().trim()),T=C.tagContents().innerCapture(regExpFormatted(/([^\d\.,]+)/),1).trim(),ASSERT(u,g,h,d,v,c)&&b.push({reservationId:i,airlineName:l,airlineCode:u,flightNumber:g,departureAirport:h,departureTime:d,arrivalAirport:v,arrivalTime:c,passengers:f})}while(0!==(""+S.next(t.leg)).length);for(var k=[],x=0;b.length>x;x++)for(var F=b[x],z=Object.keys(F.passengers),P=0;z.length>P;P++){var D=F.passengers[z[P]],E={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:F.airlineName,airlineCode:F.airlineCode,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirport,departureAirportCode:F.departureCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirport,arrivalAirportCode:F.arrivalCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:D.name},checkinUrl:o,reservationId:F.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:N,priceCurrency:T,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:D.seats[F.flightNumber],seatingType:D.seatingType[F.flightNumber]}}};valid(D.membershipNumber,D.programName)&&(E.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:D.membershipNumber,programName:D.programName}),k.push(E)}return k.length?k:void 0}}).call();
