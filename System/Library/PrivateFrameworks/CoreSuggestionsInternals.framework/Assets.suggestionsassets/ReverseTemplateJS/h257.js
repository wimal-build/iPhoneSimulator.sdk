// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e),n=a.getSpan();a.setLocale(t);for(var i,o,l,p,s,g,u,d,c=[],h={},m=[],C=n.nextText(r.contactDetailsPrefix).nextAnyTag("table").nextAnyTag("tr").allInnerTags("td8"),T=n.next(r.passengerDetailsPrefix).next(r.underPersonNamePrefix).parentAnyTag("table").allInnerTags("tr7"),f=1;T.length>f;f++){for(var v=T[f].nextTag("td8").tagContents().trim(),x=T[f].allInnerTags("td7"),A=[],y=1;x.length>y;y++)A.push(x[y].tagContents().trim());h[""+v]={name:v,seats:A,seatingType:{},ticketNumber:null,totalPrice:null,priceCurrency:null}}i=C[2].tagContents(),C[4]&&(o=C[4].tagContents()),n.nextText(r.pricePrefix)!==a.getNullSpan()&&([,p,s]=n.nextText(r.pricePrefix).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)\s?(\D)/)),l=n.nextText(r.reservationIdPrefix).nextAnyTag("td").tagContents(),n.nextText(r.flightBlock).parentTag("table8").allInnerTags("table9").forEach(function(e,t){for(var n=e.allInnerTags("tr9").filter(function(e,t){var a=""+e.tagContents();return 0!==(""+e.tagContents()).length&&-1===a.indexOf(r.flightBlock)&&-1===a.indexOf(r.flightBlock_2)}),i=n.length,o=0;i>o;o+=3){var l,p,s,u,d,h,m,C,T=n[o+2].allInnerTags("td10");[,l,p]=n[o+1].tagContents().innerCapture(/.*?\s(\D{2})(\d+)/);var f=""+n[o].tagContents();s=a.getDetachedSpan(f+" "+T[2].tagContents()).innerDate(),[,u,d]=T[0].tagContents().innerCapture(/(.*)?\s\((\D{3})\)/),h=a.getDetachedSpan(f+" "+T[5].tagContents()).innerDate(),[,m,C]=T[3].tagContents().innerCapture(/(.*)?\s\((\D{3})\)/),c.push({airlineName:null,airlineCode:l,flightNumber:p,departureDateTime:s,departureAirport:u,departureAirportCode:d,arrivalDateTime:h,arrivalAirport:m,arrivalAirportCode:C,seatNumber:g,seatType:null})}});var D=0;return c.forEach(function(e){if(ASSERT(h,e.airlineName||e.airlineCode,e.departureAirport||e.departureAirportCode,e.departureDateTime,e.arrivalAirport||e.arrivalAirportCode,e.arrivalDateTime)){for(var t=Object.keys(h),r=0;t.length>r;r++)m.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:e.airlineName,airlineCode:e.airlineCode,flightNumber:e.flightNumber,departureAirportFuzzy:e.departureAirport,departureAirportCode:e.departureAirportCode,departureTime:e.departureDateTime,arrivalAirportFuzzy:e.arrivalAirport,arrivalAirportCode:e.arrivalAirportCode,arrivalTime:e.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:t[r]},checkinUrl:d,reservationId:l,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:p,priceCurrency:s,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:u,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:h[t[r]].seats[D],seatingType:e.seatingType}}});D++%t.length}}),m.length>=1?m:CONTINUE}}).call();
