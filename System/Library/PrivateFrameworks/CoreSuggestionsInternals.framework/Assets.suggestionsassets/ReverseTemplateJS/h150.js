// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,o,l,s,m,u,g,d,c,h,b,v,T,f,C,N,$,y,A=[],x={};if(d=a.getSpan().nextText("Confirmation:").nextAnyTag("td").tagContents(),n=d.innerCapture(/([\w]{6})/,1),i=d.innerCapture(regExpFormatted(/\1 > <($<checkinUrl>.*)>/,r.checkin),1),d=a.getSpan().nextTag("table3").nextTag("table3").allInnerTags("tr3"),u=a.getSpan().nextText(r.eTicketTotal).nextTag("td4").tagContents(),g=u.nextTag("td4").tagContents(),d.length)for(var k,S=1;k=d[S++];)k=k.allInnerTags("td3").map(function(e){return e.tagContents()}),k.length>=4&&(p=k[0],x[""+p]={name:p,price:u,currency:g,ticketNumber:k[1],membershipNumber:""+k[2],seats:{},seatingType:{},seatList:(""+k[3]).split("/").map(function(e){return"---"===e?"":e})});s=a.getSpan().nextText(r.flightInformation).parentTag("table3").allInnerTagsFiltered("td3");var F=/\b(\d{2}[A-Z]{3}\d{2})$/;if(s.length)for(var S=0,D=s.length;D>S;S++)if(F.test(s[S])&&D>S+4){if(l=s[S].innerCapture(F,1),c=s[S+1].innerCapture(/($<code>[A-Z]+)($<flightNumber>\d+)/),h=c?c.$code:null,m=c?""+c.$flightNumber:null,b=s[S+3].innerCapture(/($<airportName>.*)\s+\(($<code>[A-Z]{3}).*\)\s+($<time>\d{1,2}:\d{2} (?:A|P)M)/),f=b?b.$code:null,T=b?b.$airportName.trim():null,v=b?a.getDetachedSpan(""+l+" "+b.$time).innerDate():null,C=s[S+4].innerCapture(/($<airportName>.*)\s+\(($<code>[A-Z]{3}).*\)\s+($<time>\d{1,2}:\d{2} (?:A|P)M)(?: \(($<nextDate>\d{2}[A-Z]{3})\))?/),y=C?C.$code:null,$=C?C.$airportName.trim():null,N=C?a.getDetachedSpan((not(C.$nextDate)?""+l:""+C.$nextDate)+" "+C.$time).innerDate():null,valid(m)){o=Object.keys(x);for(var z=0;o.length>z;z++)x[o[z]].seats[m]=x[o[z]].seatList[A.length]}ASSERT(h,m,f,v,y,N)&&A.push({airlineCode:h,flightNumber:m,departureAirport:T,departureCode:f,departureTime:v,arrivalAirport:$,arrivalCode:y,arrivalTime:N,passengers:x})}for(var I,M=[],S=0;A.length>S;S++)for(var P=A[S],Z=Object.keys(P.passengers),z=0;Z.length>z;z++){var L=P.passengers[Z[z]];I={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:P.airlineCode,flightNumber:P.flightNumber,departureAirportFuzzy:P.departureAirport,departureAirportCode:P.departureCode,departureTime:P.departureTime,arrivalAirportFuzzy:P.arrivalAirport,arrivalAirportCode:P.arrivalCode,arrivalTime:P.arrivalTime},underName:{"@type":"http://schema.org/Person",name:L.name},checkinUrl:i,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:L.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:L.seats[P.flightNumber],seatingType:L.seatingType[P.flightNumber]}},totalPrice:L.price,priceCurrency:L.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(L.membershipNumber)&&(I.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:L.membershipNumber,programName:"Frequent Flyer"}),M.push(I)}return M.length?M:void 0}}).call();