// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,x,u,o,l=[],m=[],h=[],d=1,s="Confirmed",c="NH";g=a.getSpan().nextText(r.price).nextText("\n"),g=a.getSpan().withInterval(g.getEnd(),g.nextText("\n").getStart()),x=g.innerCapture(regExpFormatted(/([\d\., ]+)/),1).trim(),u=g.innerCapture(regExpFormatted(/([^\d\., ]+)/),1),n=a.getSpan().nextText(r.passenger).nextText("\n"),n=a.getSpan().withInterval(n.getEnd(),n.nextText(r.passengerSuffix).getStart());do ASSERT(n)&&m.push({name:n}),n=n.nextText("\n"),n=a.getSpan().withInterval(n.getEnd(),n.nextText("\n").getStart());while(n.getLength());for(i=a.getSpan().nextText(r.flight).nextText("[1]"),a.getSpan().nextText(r.limit).exists()?s="Pending":a.getSpan().nextText(r.cancel).exists()?s="Cancelled":a.getSpan().nextText(r.refund).exists()&&(s="Cancelled");i.exists();){var T,v,S,z={},f=i.nextDate();z.flightNumber=i.nextRegExp(regExpFormatted(/\d{3,4}/)),v=z.flightNumber.nextDate(),T=z.flightNumber.nextDate().nextDate(),z.departureAirportFuzzy=a.getSpan().withInterval(z.flightNumber.getEnd(),v.previousText("(").getStart()).trim(),z.arrivalAirportFuzzy=a.getSpan().withInterval(z.flightNumber.nextText("-").getEnd(),T.previousText("(").getStart()).trim(),z.departureTime=getFuzzyDate(a.getDetachedSpan(f+" "+v)),z.arrivalTime=getFuzzyDate(a.getDetachedSpan(f+" "+T)),S=i.nextText(r.ticket),z.ticketNumber=a.getSpan().withInterval(S.getEnd(),S.nextText("\n").getStart()).trim(),ASSERT(z.arrivalAirportFuzzy,z.departureAirportFuzzy,z.flightNumber,z.departureTime,z.arrivalTime)&&l.push(z),d++,i=i.nextText("["+d+"]")}for(var y=0;l.length>y;y++)for(var F=l[y],N=0;m.length>N;N++){var A=m[N],b={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"All Nippon Airways",airlineCode:c,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirportFuzzy,departureAirportCode:F.departureAirportCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirportFuzzy,arrivalAirportCode:F.arrivalAirportCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:A.name},checkinUrl:o,reservationId:p,reservationStatus:"http://schema.org/Reservation"+s,totalPrice:x,priceCurrency:u,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:F.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:F.seatNumber,seatingType:""}}};h.push(b)}return h.length?h:void 0}}).call();