// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,l={},o=[],g={};n=a.getSpan().innerCapture(regExpFormatted(/\1\n(.*?) /,r.bookingCode),1);var p=a.getSpan().firstText(r.passengersHeader).nextTag("table2").allInnerTags("tr2");if(p)for(var s=p.length-1,d=1;s+1>d;d++){T=p[d].allInnerTags("td2");var c=""+T[0].tagContents(),m=regExpFormatted(/\1/,r.child.toLowerCase()).test(c.toLowerCase())?"child":"adult";c=c.replace(/\(.*\)/,"");var h=""+T[1].tagContents();ticket=""+T[2].tagContents(),l[c]={ticketNumber:ticket,membershipNumber:h,ageCategory:m}}var u=a.getSpan().firstText(r.flightDetails).nextTag("table2").allInnerTags("tr2");if(u){for(var v={},d=1,C=u.length;C>d;d++)3==u[d].allInnerTags("td2").length&&(v[d]=0,C>d+1&&regExpFormatted(/\1/,r.codesharePrefix).test(u[d+1])&&(v[d]=d+1));for(var d in v){var T=u[d].allInnerTags("td2"),f=T[0].nextDate().innerDate(),x=T[0].nextDate().nextDate().innerDate(),b=a.getDetachedSpan(f+" "+x).innerDate(),D=(""+T[0].tagContents().innerCapture(/\/(.*\n.*)/,1).trim()).replace("\n",", "),y=T[1].nextDate().innerDate(),S=T[1].nextDate().nextDate().innerDate(),N=a.getDetachedSpan(y+" "+S).innerDate(),k=(""+T[1].tagContents().innerCapture(/\/(.*\n.*)/,1).trim()).replace("\n",", "),F=T[2].tagContents().innerCapture(/(\w+)/,1),A="Iberia",I="IB";if(v[d]>2){var z=u[v[d]].nextTag("td2").tagContents();z&&(A=(""+z).replace(r.codesharePrefix,"").replace(".","").trim(),I="")}ASSERT(A,F,D,b,k,N)&&o.push({airlineName:A,airlineCode:I,flightNumber:F,departureAirport:D,departureTime:b,arrivalAirport:k,arrivalTime:N})}}var E=a.getSpan().firstText(r.priceHeader).nextTag("table2").allInnerTags("tr2");if(E){i=""+a.getSpan().firstText(r.totalPrice).parentTag("td2").tagContents().trim(),i=i.charAt(i.length-1);for(var P=E.length-1,d=1;P+1>d;d++){var T=E[d].allInnerTags("td2"),w=regExpFormatted(/\1/,r.adult).test(""+T[0])?"adult":regExpFormatted(/\1/,r.child).test(""+T[0])?"child":null;valid(w)&&(g[w]=""+T[5].tagContents())}}var L=[];for(d=0;o.length>d;d++)for(var R=o[d],H=Object.keys(l),j=0;H.length>j;j++){var B=l[H[j]],M=g[B.ageCategory],O={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:R.airlineName,airlineCode:R.airlineCode,flightNumber:R.flightNumber,departureAirportFuzzy:R.departureAirport,departureAirportCode:R.departureCode,departureTime:R.departureTime,arrivalAirportFuzzy:R.arrivalAirport,arrivalAirportCode:R.arrivalCode,arrivalTime:R.arrivalTime},underName:{"@type":"http://schema.org/Person",name:H[j],email:""},checkinUrl:"",reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:M,priceCurrency:i,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:B.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};L.push(O)}return L}}).call();