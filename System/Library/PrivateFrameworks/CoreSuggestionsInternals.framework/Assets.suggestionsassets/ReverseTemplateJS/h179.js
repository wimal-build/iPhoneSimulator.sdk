// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,s,o,m,l,d,u,h,c,T,C,v,x,N,b,f=[],y={};for(s=a.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+</,r.reservationId),1),m=a.getSpan().next(r.ticketNr).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+</,r.ticketNr),1),p=a.getSpan().next(r.price).nextTag("th7").tagContents(),l=p.innerCapture(/([\d,.]+)/,1),d=p.innerCapture(/([^\d,.]+)/,1),u=a.getSpan().next(r.departure).parentTag("table5").allInnerTags("tr5"),h=1;u.length>h;h++)if(u[h].tagContents().innerRegExp(r.departure).exists())T=u[h].tagContents().innerRegExp(r.departure),c=T.previousAnyTag("th").tagContents();else{if(T=u[h],C={},v=T.nextTag("td6").tagContents().innerCapture(/($<airline>[^\d]+)\s+($<flightNumber>\d+)/),C.airlineName=v.$airline,C.flightNumber=v.$flightNumber,C.airlineCode=/delta/gi.test(C.airlineName)?"DL":null,C.seatingType=C.flightNumber.nextTag("td6").tagContents(),C.departureAirport=C.seatingType.nextTag("td6").tagContents(),C.departureTime=a.getDetachedSpan(""+c+" "+(""+C.departureAirport.nextTag("td6").tagContents()).replace("N"," pm")).innerDate(),C.arrivalAirport=C.departureAirport.nextTag("td6").nextTag("td6").tagContents(),g=(""+C.arrivalAirport.nextTag("td6").tagContents()).replace(/(\d+:\d+)(N)/,"$1 pm"),/\*\*/.test(g)){var A=g.split("\n");A&&2===A.length?(g=A[0].replace("**",""),c=A[1].replace("**","")):(g=g.replace("**",""),c=modifyDate(c,1))}C.arrivalTime=a.getDetachedSpan(c+" "+g).innerDate(),ASSERT(C.airlineName,C.flightNumber,C.departureAirport,C.departureTime,C.arrivalAirport,C.arrivalTime)&&f.push(C)}for(x=a.getSpan().next(r.passengerInfo).nextTag("table6").allInnerTags("tr6"),h=0;x.length-1>h;h++)N=x[h],N.tagContents().innerRegExp(r.name).exists()?(n=N.tagContents().innerRegExp(r.name).nextTag("td7").tagContents(),b={name:n,seats:{}}):(i=N.nextTag("td6").tagContents().innerCapture(/(\d+)/,1),i.nextTag("td7").tagContents().inner(r.seat,1).exists()||(b.seats[i]=i.nextTag("td7").tagContents()),y[b.name]=b);var S=[];for(h=0;f.length>h;h++){C=f[h];for(var k=Object.keys(y),F=0;k.length>F;F++){N=y[k[F]];var E={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:C.airlineName,airlineCode:C.airlineCode,flightNumber:C.flightNumber,departureAirportFuzzy:C.departureAirport,departureAirportCode:C.departureCode,departureTime:C.departureTime,arrivalAirportFuzzy:C.arrivalAirport,arrivalAirportCode:C.arrivalCode,arrivalTime:C.arrivalTime},underName:{"@type":"http://schema.org/Person",name:N.name},checkinUrl:o,reservationId:s,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:l,priceCurrency:d,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:m,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:N.seats[C.flightNumber],seatingType:C.seatingType}}};valid(N.membershipNumber,N.programName)&&(E.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:N.membershipNumber,programName:N.programName}),S.push(E)}}return S.length?S:void 0}}).call();
