// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var i,n,p,o,m,s,l,g,u,d,h,c,v=[],N={};l=a.getSpan(),n=l.next(t.confirmation).innerCapture(t.confirmation,1);o=l.next(t.reservationName).innerCapture(t.reservationName,1);var b=a.getSpan().next(t.totalPrice).parentAnyTag("td").nextAnyTag("td").nextAnyTag("td").nextAnyTag("td").tagContents(),y=b.innerCapture(/([\d,.]+)/,1),T=b.innerCapture(/([^\d,.]+)/,1).trim();N[""+o]={name:o,seats:{},seatingType:{},ticketNumber:null,totalPrice:null,priceCurrency:null};for(var C=l.allInnerCapture(t.legs),f=0;C.length>f;f++)m=C[f],u=combineDateAndTime(a.getDetachedSpan(""+m.$date).innerDate(),a.getDetachedSpan(""+m.$departure).innerDate()),h=combineDateAndTime(a.getDetachedSpan(""+m.$date).innerDate(),a.getDetachedSpan(""+m.$arrival).innerDate()),d=m.$from,c=m.$to,s=m.$flight,[,g,s]=s.innerCapture(/([0-9A-Z]{2})(\d{3,4})/),ASSERT(g,s,d,u,c,h)&&v.push({reservationId:n,airlineName:null,airlineCode:g,flightNumber:s,departureAirport:d,departureTime:u,arrivalAirport:c,arrivalTime:h,passengers:N});var A=[];for(f=0;v.length>f;f++)for(var S=v[f],D=Object.keys(S.passengers),k=0;D.length>k;k++){var x=S.passengers[D[k]],$={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:x.name},checkinUrl:p,reservationId:S.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:y,priceCurrency:T,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:x.seats[S.flightNumber],seatingType:x.seatingType[S.flightNumber]}}};valid(x.membershipNumber,x.programName)&&($.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:x.membershipNumber,programName:x.programName}),A.push($)}return A.length?A:void 0}}).call();
