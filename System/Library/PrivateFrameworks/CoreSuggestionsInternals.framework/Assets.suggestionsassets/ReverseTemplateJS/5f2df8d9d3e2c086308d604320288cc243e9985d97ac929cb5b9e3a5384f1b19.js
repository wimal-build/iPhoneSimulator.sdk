// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("delta.com-checkin-or-upgrade-en",function(e){return/^It's Time To Check-In/i.test(e.subject)||/^Your upgrade is now confirmed/.test(e.subject)},function(e){if(/^It's Time To Check-In/i.test(e.subject)||/^Your upgrade is now confirmed/.test(e.subject)){var r,t="en_US",a={};return a.name="Hello,",a.reservationId=/Delta\s+Confirmation\s+\#\:/,a.departure=/DEPART/,a.seat="Seat",(r=loadHelper(/Hello,/.test(e.plain)?"delta.com-checkin-skeleton.js":"delta.com-checkin-skeleton-2013-2014.js"))(e,t,a)}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/185/316/317","SGcfe08655"),new ReverseTemplate("delta.com-confirmation-en",function(){return!0},function(e){if(/Flight Receipt and Itinerary/.test(e.html)){var r="en_US",t=loadHelper("delta.com-vocabulary-skeleton-en.js")(),a=loadHelper("delta.com-skeleton.js");return a(e,r,t)}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/185/316/318","SG16f63537"),new ReverseTemplate("delta.com-itinerary-receipt-en",function(e){var r=Scanner.fromMessage({plain:e.subject});return r.setLocale("en_US"),r.getSpan().innerDate().exists()||/^Delta Reservation Itinerary/.test(e.subject)},function(e){if(/Delta\s+Reservation\s+Itinerary/.test(e.subject)&&/Hello\,/.test(e.html)){var r="en_US",t=loadHelper("delta.com-vocabulary-skeleton-en.js")(),a=loadHelper("delta.com-skeleton.js");return a(e,r,t)}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),n.getSpan().nextRegExp(/YOUR ITINERARY AND (?:RECEIPT|PASSENGER DETAILS)/).exists()){var i,l,s,o,p,m,u,g,c,d,h,b=[],v={};if(l=n.getSpan().innerCapture(/\bFlight Confirmation #: (\S+)/,1),s=l.parentTag("table4").withStart(l.getStart()).innerLink(),i=n.getSpan().innerCapture(/\bTicket #: (\d+)/,1),not(l)&&(l=n.getSpan().innerCapture(/\bYour Delta Confirmation #: (\S+)/,1)),d=n.getSpan().nextText("Passenger Details").nextTag("table5").tagContents().innerCapture(/\b($<name>.*)\s?(?:\bSkyMiles #($<membershipNumber>.*?)($<programName>\s?[A-z]*?) <)?/)){o=d.$name.trim(),o.innerCapture(/.*? </)&&(o=o.innerCapture(/(.*?) </,1));var T=""+o;v[T]={name:o,programName:d.$programName.exists()?"SkyMiles"+d.$programName:"",membershipNumber:""+d.$membershipNumber,seats:{},seatingType:{}};var f=n.getSpan().nextText("Passenger Details").nextTag("table6").allInnerTagsFiltered("td6");if(f.length&&f.length%2===0)for(var C=0,S=f.length/2;S>C;C++)/(?:See delta\.com|Not Assigned)/.test(f[2*C+1])||(g=""+f[2*C].innerCapture(/([\d]+)/,1),p=f[2*C+1].innerCapture(/(\d+[A-Z])/,1),v[T].seats[""+g]=p);c=n.getSpan().nextRegExp(/\b(?:Ticket Amount|Total):/).nextTag("td4").tagContents().innerCapture(/($<totalPrice>[\d,.]+)\s?($<priceCurrency>[A-Z]{3})?/),c&&(v[T].totalPrice=c.$totalPrice,v[T].priceCurrency=c.$priceCurrency)}u=n.getSpan().nextText("Your Flight Information").nextTag("table4").allInnerTagsFiltered("td4");for(var N,y,A,R,x=/\b($<date>(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) \d{2}(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))/,k=/\b($<type>LV|AR) ($<time>\d{1,2}:\d{2}(?:am|pm|N))/,$=/\b($<airlineName>.*) ($<flightNumber>[\d]+)/,I={},D={},C=0;y=u[C++];)if(y.innerCapture(k)){if(A=y.innerCapture(k),N=""+A.$type=="LV"?"departure":"arrival",y.innerCapture(x)&&(m=y.innerCapture(x,1)),valid(m,A.$time)){var E=""+A.$time;"12:00N"===E&&(E="12:00pm"),R=n.getDetachedSpan(""+m+" "+E),I[N+"Time"]=R.innerDate()}}else y.innerCapture(x)?m=y.innerCapture(x,1):y.innerCapture($)?(h=y.innerCapture($),h&&(I.airlineName=h.$airlineName,I.flightNumber=h.$flightNumber,I.airlineCode=/delta/gi.test(I.airlineName)?"DL":null),ASSERT(I.departureTime,I.arrivalTime,I.departureAirport,I.arrivalAirport,I.airlineName,I.flightNumber)&&(D[""+I.airlineName]=!0,I.passengers=v,b.push(I)),I={}):N&&(I[N+"Airport"]=""+y,N=null);var F=[],j=n.getSpan().nextText("Baggage Fees"),P=j.nextRegExp(/1[:)]On Delta[- ]operated flights/).previousTag("table4").collapseToEnd();P.exists()&&(j=j.withEnd(P.getStart()));for(var A,U=j.allInnerDates(),L=function(e){return 3===(""+e).length?e:""},C=0;U.length>C;C++)for(var M,w=U[C],H=U[C+1]||P,R=w.super(H),z=R.allInnerTagsFiltered("td5"),Y=0;M=z[Y];Y++)D[M]&&z.length>Y+2&&F.push([L(z[Y+1]),L(z[Y+2])]);if(F.length===b.length)for(var C=0,S=b.length;S>C;C++)b[C].departureCode=F[C][0],b[C].arrivalCode=F[C][1];for(var O=[],C=0;b.length>C;C++){var I=b[C];ASSERT(OR(I.airlineCode,AND(I.departureCode,I.arrivalCode)));for(var G=Object.keys(I.passengers),Y=0;G.length>Y;Y++){var _=I.passengers[G[Y]],J={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:I.airlineName,airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:_.name},checkinUrl:s,reservationId:l,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:_.totalPrice,priceCurrency:_.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:_.seats[I.flightNumber],seatingType:_.seatingType[I.flightNumber]}}};valid(_.membershipNumber,_.programName)&&(J.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:_.membershipNumber,programName:_.programName}),O.push(J)}}if(O.length)return O}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/185/316/321","SG0d1528be")]);