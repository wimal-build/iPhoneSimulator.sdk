// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("apple.com-travel.res.APAC",function(e){return void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0?!1:/^My Trip Ticketed/.test(e.subject)},function(e){if(void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0)return STOP;if(/^My Trip Ticketed/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,c,l,d,m,u,g,h,T,v,y,C,f,x,A,b,N,S,R,k,P,$,I,F,H,U,E,L,D,w,j=[],M=[],z={},O=[],Z=[];n=t.getSpan().innerCapture(/Travel Itinerary for\s+(.+?)\n/,1),z[""+n]={name:n,seats:{},seatingType:{}},c=t.getSpan().allInnerCapture(/Reference #/);for(var G=0;c.length>G;G++)p=c[G][0].withStart(c[G][0].previousText("Airline").getStart()).withEnd(c[G][0].nextText("Flight time").getEnd()),m=p.previousText("Flight").parentAnyTag("td").tagContents().innerCapture(/Flight ($<code>\D+)($<flightNumber>\d+)/),u=m?m.$code:null,l=m?m.$flightNumber:null,s=p.innerText("Reference #").nextAnyTag("td").tagContents(),g=s.nextTag("table1").nextText("From").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),T=g?g.$airport:null,v=g?g.$code:null,y=s.nextTag("table1").nextTag("table1").nextText("To").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),f=y?y.$airport:null,x=y?y.$code:null,h=p.innerText("Departs").nextAnyTag("td").innerDate(),C=p.innerText("Arrives").nextAnyTag("td").innerDate(),valid(l)&&(z[""+n].seats[""+l]=p.innerText("Seat #").nextAnyTag("td").tagContents()),d=p.innerText("Frequent flier #").nextAnyTag("td").innerCapture(/($<programName>\D+)\s*($<membershipNumber>\d+)/),d&&(z[""+n].programName=d?d.$programName:null,z[""+n].membershipNumber=d?d.$membershipNumber:null),ASSERT(s,u,l,h,v,C,x)&&M.push({reservationId:s,airlineCode:u,flightNumber:l,departureTime:h,departureCode:v,departureAirport:T,arrivalTime:C,arrivalCode:x,arrivalAirport:f,passengers:z});S=t.getSpan().allInnerCapture(/Check-in/);for(var G=0;S.length>G;G++)N=S[G][0].withStart(S[G][0].previousText("Hotel").previousText("Hotel").getStart()).withEnd(S[G][0].nextText("Confirmation #").getEnd()),R=N.innerText("Address").previousAnyTag("td").tagContents(),P=N.innerText("Address").nextAnyTag("td").tagContents().innerCapture(/(.+?) </,1),k=N.innerText("Telephone").nextAnyTag("td").tagContents(),A=N.innerText("Check-in").nextAnyTag("td").innerDate(),b=N.innerText("Check-out").nextAnyTag("td").innerDate(),a=N.innerText("Rate").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+)\s*($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,s=N.innerText("Confirmation #").nextAnyTag("td").tagContents(),ASSERT(n,s,R,P,A,b)&&O.push({name:n,reservationId:s,hotelName:R,hotelAddress:P,hotelPhone:k,checkInDateTime:A,checkOutDateTime:b,totalPrice:i,priceCurrency:o});I=t.getSpan().allInnerCapture(/Rental location/);for(var G=0;I.length>G;G++)$=I[G][0].withEnd(I[G][0].nextText("Confirmation #").getEnd()),a=$.innerText("Approximate Total Price").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+)\s*($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,H=$.innerText("Rental company").nextAnyTag("td").tagContents(),w=$.innerText("Pick-up").nextAnyTag("td").innerDate(),L=$.innerText("Rental location").nextAnyTag("td").tagContents(),D=$.innerText("Telephone").nextAnyTag("td").tagContents(),E=$.innerText("Drop-off").nextAnyTag("td").innerDate(),U=$.innerText("Return location").nextAnyTag("td").tagContents(),s=$.innerText("Confirmation #").nextAnyTag("td").tagContents(),F=$.innerText("Type of car").nextAnyTag("td").tagContents(),ASSERT(n,s,F,w,L,H)&&Z.push({reservationId:s,name:n,totalPrice:i,priceCurrency:o,provider:H,pickupTime:w,pickupAddress:L,pickupTelephone:D,dropoffTime:E,dropoffAddress:U,brand:F});for(var G=0;M.length>G;G++)for(var Y=M[G],_=Object.keys(Y.passengers),q=0;_.length>q;q++){var B=Y.passengers[_[q]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:Y.airlineName,airlineCode:Y.airlineCode,flightNumber:Y.flightNumber,departureAirportFuzzy:Y.departureAirport,departureAirportCode:Y.departureCode,departureTime:Y.departureTime,arrivalAirportFuzzy:Y.arrivalAirport,arrivalAirportCode:Y.arrivalCode,arrivalTime:Y.arrivalTime},underName:{"@type":"http://schema.org/Person",name:B.name},checkinUrl:Y.checkinUrl,reservationId:Y.reservationId,reservationStatus:"http://schema.org/Reservation"+(Y.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:B.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:B.seats[Y.flightNumber],seatingType:B.seatingType[Y.flightNumber]}},totalPrice:B.totalPrice,priceCurrency:B.currency},valid(B.membershipNumber,B.programName)&&(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:B.membershipNumber,programName:B.programName}),j.push(r)}for(var $,G=0;Z.length>G;G++)$=Z[G],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:$.totalPrice,priceCurrency:$.priceCurrency,reservationId:$.reservationId,reservationStatus:"http://schema.org/Reservation"+($.reservationStatus||"Confirmed"),checkinUrl:$.checkinUrl,modifyReservationUrl:$.modifyReservationUrl,cancelReservationUrl:$.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:$.name,email:$.email},provider:{"@type":"http://schema.org/Organization",name:$.provider},pickupTime:$.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:$.pickupName,telephone:$.pickupTelephone,address:$.pickupAddress},dropoffTime:$.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:$.dropoffName,telephone:$.dropoffTelephone,address:$.dropoffAddress}},$.brand&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:$.brand},license:$.license,color:$.color}),j.push(r);for(var N,G=0;O.length>G;G++)N=O[G],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:N.name,email:N.email},totalPrice:N.totalPrice,priceCurrency:N.priceCurrency,checkinTime:N.checkInDateTime,checkoutTime:N.checkOutDateTime,modifyReservationUrl:N.modifyReservationUrl,cancelReservationUrl:N.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(N.reservationStatus||"Confirmed"),reservationId:N.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:N.hotelName,url:N.hotelUrl,telephone:N.hotelPhone,address:N.hotelAddress}},j.push(r);if(j.length)return j}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1019/1020","SG60b86021"),new ReverseTemplate("appletravel-confirmation-en",function(e){return void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0?!1:/Trip Schedule Change/.test(e.subject)||/ITINERARY/.test(e.subject)},function(e){if(void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0)return STOP;if(/Trip Schedule Change/.test(e.subject)||/ITINERARY/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r=(t.getSpan(),{});r.underName=e.plain.split("\n")[2];var n=loadHelper("appletravel-flight-parser.js"),a=loadHelper("appletravel-rentalcar-parser.js"),i=loadHelper("appletravel-hotel-parser.js"),o=n(e,r),s=a(e,r),p=i(e,r),c=[];if(o&&(c=c.concat(o)),s&&(c=c.concat(s)),p&&(c=c.concat(p)),c)return c}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1019/1021","SGa5e3e1d5")]);
