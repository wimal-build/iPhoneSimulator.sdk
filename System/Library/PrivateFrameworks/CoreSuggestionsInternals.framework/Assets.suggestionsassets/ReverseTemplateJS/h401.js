// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t){var n=Scanner.fromMessage(e);n.setLocale("en_US");for(var r=n.getSpan(),a=[],o=[],c=[],i=e.plain.split(/Check In/i).length-1,s=(e.plain.slice(),0);i>s;s++)r=r.next(/(^Hotel[\s\S]*?)(?:^Flight [A-Z]|^Hotel$|^Car Rental$|^Plan)/gm),c.push(""+r);return c.forEach(function(e,r){var a,c,i,s,h,l,m,u,d,p,g,v,f,k,D,T,I=n.getDetachedSpan(e),S=e.slice(),e=e.split("\n");s=/Confirmation #.*\n.*\n(.*)\n/.exec(S),s&&2===s.length&&(s=s[1]),u=I.nextDate(),g=I.nextDate().nextDate(),f=e[4],D=I.nextAddress(),""+D==""&&(D=e[6].split("<")[0]),k=e[8],a=/Rate.*\n.*\n([\d,.]+)\s*([A-Z]{2,3})/.exec(S),a&&3===a.length&&(c=a[1],i=a[2]),o.push({totalPrice:c,priceCurrency:i,reservationId:s,reservationStatus:h,checkInTime:l,checkInDate:m,checkInDateTime:u,checkOutTime:d,checkOutDate:p,checkOutDateTime:g,hotelUrl:v,hotelName:f,hotelPhone:k,hotelAddress:D,modifyReservationUrl:T,underPersonName:t.underName})}),o.forEach(function(e,t){ASSERT(e.checkInDateTime,e.checkOutDateTime,e.hotelName,e.hotelAddress),a.push({"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:e.underPersonName},totalPrice:e.totalPrice,priceCurrency:e.priceCurrency,checkinTime:e.checkInDateTime,checkoutTime:e.checkOutDateTime,modifyReservationUrl:e.modifyReservationUrl,reservationStatus:"http://schema.org/Reservation"+(e.reservationStatus||"Confirmed"),reservationId:e.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:e.hotelName,url:e.hotelUrl,telephone:e.hotelPhone,address:e.hotelAddress}})}),a.length>=1?a:CONTINUE}}).call();
