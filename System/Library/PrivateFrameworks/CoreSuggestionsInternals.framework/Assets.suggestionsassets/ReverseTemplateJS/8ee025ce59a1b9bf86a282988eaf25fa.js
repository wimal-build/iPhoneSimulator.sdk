// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("virginamerica.com-confirmation-and-checkin-en",function(e){return/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)},function(e){if(/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,o,s,l,p,m,g,u,d,c,h,v,C,T,f,b,A,x,N=[],S={};if(t=r.getSpan().innerCapture(/\bYour Confirmation Code: ([A-Z]{6})/,1),a=t.nextLink(),i=r.getSpan().nextRegExp(/Who['\u2019]s Flying/).nextAnyTag("table"),i.exists()){var $=i.getTagNumber();i=i.allInnerTags("tr"+$);for(var y,F=1;y=i[F++];)u=y.allInnerTags("td"+$),n=u[0].tagContents(),S[""+n]={name:n,membershipNumber:""+u[1].tagContents(),seatList:u[2]&&u[2].tagContents().split(/(?:\s+|,)(?:\/\s+)?/g).filter(function(e){return"Not"!=e}).map(function(e){return"Selected"==e||"N/A"==e?"":e})}}if(l=r.getSpan().nextRegExp(/Where You['\u2019]re Going/).nextAnyTag("table"),l.exists()){var $=l.getTagNumber();l=l.allInnerTags("tr"+$);for(var F=1;s=l[F];F++)if(s=s.allInnerTags("td"+$),s.length>=4&&(o=s[0].innerDate(),d=s[1].tagContents().innerCapture(/($<code>.*?)\s*($<flightNumber>\d{1,4})/g),c=d?d.$code:null,p=d?d.$flightNumber:null,h=s[2].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),C=h?h.$airport:null,T=h?h.$code:null,v=combineDateAndTime(o,s[2].tagContents().innerDate()),f=s[3].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),A=f?f.$airport:null,x=f?f.$code:null,b=combineDateAndTime(o,s[3].tagContents().innerDate()),v>b&&(b=modifyDate(b,1)),ASSERT(c,p,T,v,x,b))){for(var I=Object.keys(S),k=0;n=I[k++];)S[n].seats||(S[n].seats={}),S[n].seatList.length>=F&&(S[n].seats[p]=S[n].seatList[F-1]);N.push({airlineCode:c,flightNumber:p,departureAirport:C,departureCode:T,departureTime:v,arrivalAirport:A,arrivalCode:x,arrivalTime:b,passengers:S})}}g=r.getSpan().firstText("What It Costs").nextTag("table3").innerCapture(/This total is for [0-9][\d]* Traveler\(s\) in (.*):/,1),m=r.getSpan().nextText("Grand Total:").nextTag("td4").tagContents().innerCapture(/([\d,.]+)/,1);for(var R=[],F=0;N.length>F;F++){var z=N[F];if(z.passengers)for(var I=Object.keys(z.passengers),k=0;I.length>k;k++){var D=z.passengers[I[k]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:z.airlineCode,flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:D.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:D.seats[z.flightNumber]}},checkinUrl:a,reservationId:t,totalPrice:m,priceCurrency:g,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(D.membershipNumber)&&(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:D.membershipNumber,programName:"Frequent Flyer"}),R.push(schema)}}if(R.length)return R}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/641/642","SG781cd342"),new ReverseTemplate("virginamerica.com-flight-update-en",function(e){return/^Flight Update/.test(e.subject)},function(e){if(/^Flight Update/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,o,s,l,p,m,g,u,d,c,h,v,C,T,f,b=[],A=!0;t=r.getSpan().innerCapture(/\bConfirmation Code: ([A-Z]{6})/,1),m="Virgin America",a=r.getSpan().nextText("online-check-in").parentTag("td2").innerLink(),o=r.getSpan().nextText("Confirmation Code").nextTag("table4").allInnerTags("tr4"),not(o)&&(A=!1,o=r.getSpan().nextText("Confirmation Code").nextTag("table3").allInnerTags("tr3"));for(var x=0;l=o[2*x+1];x++)i=l.allInnerTags(A?"td4":"td3"),i.length>=4&&(n=i[0].innerDate(),p=i[1].tagContents().innerCapture(/($<code>.*?)\s*($<flightNumber>\d{1,4})/g),g=p?p.$code:null,s=p?p.$flightNumber:null,u=i[2].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),c=u?u.$airport:null,h=u?u.$code:null,d=combineDateAndTime(n,l.collapseToEnd().nextDate()),v=i[3].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),T=v?v.$airport:null,f=v?v.$code:null,C=combineDateAndTime(n,l.collapseToEnd().nextDate().nextDate()),ASSERT(g,s,h,d,f,C)&&b.push({airlineName:m,airlineCode:g,flightNumber:s,departureAirport:c,departureCode:h,departureTime:d,arrivalAirport:T,arrivalCode:f,arrivalTime:C}));for(var N=[],x=0;b.length>x;x++){var S=b[x];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},checkinUrl:a,reservationId:t,reservationStatus:"http://schema.org/ReservationConfirmed"},N.push(schema)}if(N.length)return N}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/641/643","SG18c48dfe")]);
