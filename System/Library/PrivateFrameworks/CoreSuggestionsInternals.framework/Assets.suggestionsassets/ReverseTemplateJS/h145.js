// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o,p,d,g,l,s=a.getSpan(),u="Confirmed",c=[],m=[];n=s.next(r.underPersonName_prefix).nextAnyTag("td").nextAnyTag("td").tagContents(),i=s.next(r.reservationId_prefix).nextAnyTag("td").tagContents();var h=s.next(r.totalPrice_prefix).nextAnyTag("td").tagContents();h=/^(.)(.*)/.exec(h),p=h[1],o=h[2],d=s.next(r.checkinUrl_prefix).nextLink(),g=l=s.next(r.modifyReservationUrl_prefix).nextLink();var v=s.next(r.flightLegs_prefix).nextTag("table5").allInnerTags("tr5");v.forEach(function(e,t){var a=e.nextAnyTag("td").tagContents();r.detectNewLeg.test(a)&&c.push(v[t]+v[t+1]+v[t+2])});var T=function(e,t){e.forEach(function(e){var r,n,i,o,p,d,g,l,s,u,c,m,h,v,T="NK";e=a.getDetachedSpan(e),d=c=e.nextAnyTag("td").tagContents();var x=e.nextAnyTag("tr").allInnerTagsFiltered("td5");l=x[0],p=x[1],g=getFuzzyDate(a.getDetachedSpan(d+" "+p).firstDate()),n=x[2];var f=e.nextAnyTag("tr").nextAnyTag("tr").allInnerTagsFiltered("td5");h=f[0],u=f[1],m=getFuzzyDate(a.getDetachedSpan(c+" "+u).firstDate()),t({airlineName:r,airlineCode:T,flightNumber:n,departureDateTime:g,departureAirport:l,departureAirportCode:s,arrivalDateTime:m,arrivalAirport:h,arrivalAirportCode:v,ticketNumber:i,seatType:o})})};return T(c,function(e){ASSERT(e.flightNumber,e.departureDateTime,e.departureAirport,e.arrivalAirport)&&m.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:e.airlineName,airlineCode:e.airlineCode,flightNumber:e.flightNumber,departureAirportFuzzy:e.departureAirport,departureAirportCode:e.departureAirportCode,departureTime:e.departureDateTime,arrivalAirportFuzzy:e.arrivalAirport,arrivalAirportCode:e.arrivalAirportCode,arrivalTime:e.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:n},checkinUrl:d,reservationId:i,reservationStatus:"http://schema.org/Reservation"+u,totalPrice:o,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:e.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:e.seatNumber,seatingType:e.seatType}}})}),m.length>=1?m:CONTINUE}}).call();