// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var i,p,n,o,m,s,u,l,g,h,d,c,v,N,b,C=[],f=[];if(i=a.getSpan().innerCapture(t.name,1).trim(),v=a.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.reservationId),1),not(i))return CONTINUE;f[""+i]={name:i,seats:{},seatingType:{},ticketNumber:g,totalPrice:h,priceCurrency:d},N=a.getSpan().allInnerCapture(t.flightInfo);for(var y=0;N.length>y;y++)b=N[y],m=a.getDetachedSpan(""+b.$departureDate+" "+b.$departureHour+":"+b.$departureMinute).innerDate(),u=a.getDetachedSpan(""+b.$arrivalDate+" "+b.$arrivalHour+":"+b.$arrivalMinute).innerDate(),o=b.$airlineCode,p=b.$flightNumber,s=b.$departureAirport,l=b.$arrivalAirport,n=a.getSpan().innerCapture(regExpFormatted(/\1\s+(.*)/,t.price),1),h=n.innerCapture(/([\d,.]+)/,1),d=n.innerCapture(/([^\d,.]+)/,1).trim(),ASSERT(o,p,s,m,l,u)&&C.push({reservationId:v,airlineCode:o,flightNumber:p,departureAirport:s,departureTime:m,arrivalAirport:l,arrivalTime:u,passengers:f});var T=[];for(y=0;C.length>y;y++)for(var S=C[y],A=Object.keys(S.passengers),$=0;A.length>$;$++){var F=S.passengers[A[$]],k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:F.name},checkinUrl:c,reservationId:S.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:h,priceCurrency:d,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:g,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:F.seats[S.flightNumber],seatingType:F.seatingType[S.flightNumber]}}};valid(F.membershipNumber,F.programName)&&(k.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:F.membershipNumber,programName:F.programName}),T.push(k)}return T.length?T:void 0}}).call();