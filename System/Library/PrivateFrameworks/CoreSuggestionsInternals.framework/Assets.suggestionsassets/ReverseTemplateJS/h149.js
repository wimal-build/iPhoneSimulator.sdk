// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a,n,i,s,g,m,p,o,l,d,x,T,h,u,b,c;passengers=[];var v=Scanner.fromMessage(e),f=[];v.setLocale(t);var C,N,y;for(C=v.getSpan().nextTag("table1"),N=C.nextTag("tr1").nextTag("tr1"),d=N.nextText(r.reservationIdLabel).parentTag("td1").innerCapture(regExpFormatted(/\1\s*([A-Za-z0-9]*)/,r.reservationIdLabel),1).tagContents(),N=C.nextText(r.passengerCellTitle).nextTag("tr1");-1===(""+N.nextTag("td1")).indexOf(r.fromLabel);){var F={},L=N.allInnerTags("td1");if(N=N.nextTag("tr1"),!(2>L.length)){F.ticketNumber=L[1].tagContents().trim(),F.name=L[0].tagContents();var S=v.getSpan().nextText(r.id);S.exists()&&L.length>=4&&(F.membershipNumber=L[2].tagContents().trim(),F.programName=S.nextTag("td1").tagContents()),passengers.push(F)}}var E,k,z,A;for(N=N.nextText(r.fromLabel).parentTag("tr1");N!==v.getNullSpan();){y=N.nextTag("td1"),s=y.tagContents().innerCapture(regExpFormatted(/\1\s*([\w \.\-]*)/,r.fromLabel),1).trim(),y=y.nextTag("td1"),p=y.innerCapture(regExpFormatted(/\1\s*([\w \.\-]*)/,r.toLabel),1).trim(),y=y.nextTag("td1"),E=y.tagContents().innerCapture(regExpFormatted(/\1\s+($<airlineCode>\w{2})($<flightNumber>\w+)\s+/,r.flight)),E&&(n=E.$airlineCode,i=E.$flightNumber),a="",-1!==(""+y.nextTag("td1").nextTag("td1")).indexOf(r.codeshareLabel)&&(a=y.nextTag("td1").nextTag("td1").innerCapture(regExpFormatted(/\1\s+([^\[]*).*$/,r.codeshareLabel),1).trim()),m=y.nextText(r.departureTimeLabel).nextDate(),b=m.split(", "),b&&2===b.length&&(z=b[0]),u=y.nextText(r.class).parentTag("td1").innerCapture(regExpFormatted(/\1\s+([^\[]*).*$/,r.class),1).trim(),h=y.next(r.seatNumber).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+\2/,r.seatNumber,r.class),1);var $=0;if(l=y.nextText(r.arrivalTimeLabel).nextDate(),-1!==(""+y.nextText(r.arrivalTimeLabel).parentTag("td1")).indexOf("+1")&&($=1),c=l.split(", ")){if(1===c.length&&z){A=c[0];var D=v.getDetachedSpan(""+z+" "+A);l=D.innerDate(),l=modifyDate(l,$)}}else l=null;if(ASSERT(n,i,m,s,l,p))for(var F=0;F<passengers.length;F++){var w=passengers[F],k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:a,airlineCode:n,flightNumber:i,departureAirportFuzzy:s,departureAirportCode:g,departureTime:m,arrivalAirportFuzzy:p,arrivalAirportCode:o,arrivalTime:l},underName:{"@type":"http://schema.org/Person",name:w.name},checkinUrl:"",reservationId:d,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:x,priceCurrency:T,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:w.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:u,seatNumber:h}}};valid(OR(w.membershipNumber,w.programName))&&(k.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:w.membershipNumber,programName:w.programName}),f.push(k)}N=N.nextTag("tr1").nextText(r.fromLabel).parentTag("tr1")}return f.length?f:void 0}}).call();
