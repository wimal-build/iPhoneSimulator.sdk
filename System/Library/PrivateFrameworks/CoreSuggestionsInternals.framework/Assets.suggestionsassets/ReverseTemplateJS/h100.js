// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,g,o,m,p,d,l,s,u,h,T,c,x,C,v,N,y,f=[],A=[],b=[];n=a.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)/,r.reservationId),1),s=a.getSpan().next(r.pricePrefix).nextAnyTag("td").tagContents(),u=s.innerCapture(/([\d,.]+)/,1),h=s.innerCapture(/([^\d,.]+)/,1).trim();var S=a.getSpan().next(r.manageBooking).next(r.yourItinerary);for(T=S.withEnd(S.next(r.itineraryEnd).getStart()).allInnerTagsFiltered("td4"),c=0;T.length>c;c++)C=T[c],C.innerDate().exists()&&(x={},i=C.innerCapture(/^($<airlineCode>\D+)($<flightNumber>\d+)/),x.airlineCode=i.$airlineCode,x.flightNumber=i.$flightNumber,v=C.nextAnyTag("td").tagContents().innerCapture(/^($<airlineName>.*)\|.*\|($<status>.*)$/),x.airlineName=v.$airlineName.trim(),x.airlineStatus=v.$status,g=x.airlineName.nextTag("td7").tagContents(),p=g.nextTag("td7").nextTag("td7").tagContents(),x.departureTime=combineDateAndTime(g,p),m=p.nextTag("td7").nextTag("td7").tagContents(),x.departureAirport=(""+m+" "+m.nextAnyTag("td").tagContents()).trim(),o=m.nextTag("table7").nextTag("td7").tagContents(),d=o.nextTag("td7").nextTag("td7").tagContents(),x.arrivalTime=combineDateAndTime(o,d),l=d.nextTag("td7").nextTag("td7").tagContents(),x.arrivalAirport=(""+l+" "+l.nextAnyTag("td").tagContents()).trim(),ASSERT(x.airlineName,x.airlineCode,x.flightNumber,x.departureTime,x.departureAirport,x.arrivalTime,x.arrivalAirport)&&f.push(x));for(N=a.getSpan().next(r.ticketNumberPrefix).collapseToEnd().withEnd(a.getSpan().next(r.passengerPostFix).getStart()).allInnerTagsFiltered("td5"),c=0;N.length>c;c++)y=N[c].tagContents().innerCapture(/($<ticketNumber>.*)\s+\(($<name>.*)\)/),b.push({name:y.$name,ticketNumber:y.$ticketNumber});for(0===b.length&&b.push({name:a.getSpan().innerCapture(r.nameCapture,1)}),c=0;f.length>c;c++){x=f[c];for(var $=0;b.length>$;$++){y=b[$];var k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:x.airlineName,airlineCode:x.airlineCode,flightNumber:x.flightNumber,departureAirportFuzzy:x.departureAirport,departureTime:x.departureTime,arrivalAirportFuzzy:x.arrivalAirport,arrivalTime:x.arrivalTime},underName:{"@type":"http://schema.org/Person",name:y.name},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:u,priceCurrency:h,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:y.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat"}}};A.push(k)}}return A.length?A:void 0}}).call();