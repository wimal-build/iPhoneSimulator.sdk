// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,a){var n=Scanner.fromMessage(e);n.setLocale(t);var r,s,o,i,p,d,g,c,m,l,u,x,h,S,v,$,T,C,D,E,F,b=loadHelper("eventbrite.com-microdata-parser.js"),f=b(e);a.reminder.test(e.subject)&&(l=regExpFormatted(/\1 (.*)/,a.reminder).exec(e.subject)[1],T=n.getSpan().nextDate().parentAnyTag("td").tagContents().innerCapture(a.details));for(var k=0;a.confirmations.length>k;k++)if(a.confirmations[k].test(e.subject)){T=n.getSpan().innerCapture(regExpFormatted(/\1/,a.details));break}if(l=T?T.$eventName:l,f?(s=f[0].name,l||(l=f[0].reservationFor.name)):T&&(s=T.$name),n.getSpan().next(a.seat).exists()){var y=n.getSpan().next(a.seat).parentAnyTag("td").tagContents();m=y.innerCapture(regExpFormatted(/\1:\s+(\w+),?/,a.section),1),c=y.innerCapture(regExpFormatted(/\1:\s+(\w+),?/,a.row),1),g=y.innerCapture(regExpFormatted(/\1:\s+(\w+),?/,a.seat),1)}if(u=T?T.$eventUrl:null,d=n.getSpan().nextRegExp(a.ticketToken).nextLink(),p=n.getSpan().innerCapture(regExpFormatted(/\1\s+(\w+)/,a.ticketNumber),1),o=n.getSpan().nextText(a.orderSummary).nextText(a.total).nextTag("td3").tagContents().innerCapture(/([\d,.]+)/,1),T=n.getSpan().nextText(a.aboutThisEvent).nextAnyTag("table"),C=T.getTagNumber(),T=T.allInnerTagsFiltered("td"+C),T.length>1){if(T[0].allInnerDates().length>0){var A=T[0].innerCapture(a.dates);A||(A=T[0].innerCapture(a.datesRange)),A||(f?x=f[0].reservationFor.startDate:A=T[0].innerCapture(a.startDate)),A&&(E=A.$timezone,D=A.$start,h=A.$end,A.$startTime&&(D=A.$start+" "+A.$startTime,h=A.$start+" "+A.$endTime)),x||(x=n.getDetachedSpan(D+" "+E).innerDate()),h&&(h=n.getDetachedSpan(h+" "+E).innerDate())}$=T[1].innerAddress(),T=T[1].innerCapture(/^($<place>.*)\n($<address>[\s\S]+)/),T&&($&&T.$address&&T.$address.getLength()>$.getLength()?($=T.$address,v=T.$place):f&&!/[$&%]/.test(f[0].reservationFor.location.name)?v=f[0].reservationFor.location.name:/:/.test(T.$place)||(v=T.$place))}else x=n.getSpan().next(a.name).nextDate(),F=n.getDateDD(x),F&&F.endIso8601&&(h=F.endIso8601),2===n.getSpan().allInnerAddresses().length&&($=n.getSpan().allInnerAddresses()[0]);return ASSERT(x,l)?[{"@context":"http://schema.org","@type":"http://schema.org/EventReservation",name:s,totalPrice:o,priceCurrency:i,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:p,ticketToken:d,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:g,seatRow:c,seatSection:m}},reservationFor:{"@type":"http://schema.org/Event",eventStatus:"http://schema.org/Event"+(r||"Confirmed"),name:l,url:u,startDate:x,endDate:h,location:{"@type":"http://schema.org/Place",name:v,telephone:S,address:$}}}]:void 0}}).call();
