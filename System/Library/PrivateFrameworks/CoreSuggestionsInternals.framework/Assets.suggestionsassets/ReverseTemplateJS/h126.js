// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){function a(){return(""+c).indexOf("AMERICAN AIRLINES")>=0?"AA":(""+c).indexOf("US AIRWAYS")>=0?"US":""}var n=Scanner.fromMessage(e);n.setLocale(r);var i,o,p,s,g,m,l,u,h,d,c,v,T,f,y,b,A=[],C={};if(d=n.getSpan().nextText(t.travelerInformation).nextTag("table2").allInnerTags("tr2"),u={},d.length)for(var N=1;d.length>N;N++)l=d[N].allInnerTags("td2").map(function(e){return e.tagContents()}),3===l.length&&(s=""+l[0],u[s]||(u[s]={seat:[],seatingType:[]}),u[s].seat.push(l[2]),u[s].seatingType.push(l[1]));if(m=n.getSpan().nextText(t.yourItinerary).nextTag("table1").allInnerTags("tr1"),m.length>2)for(var N=2;m.length>N;N++)if(h=m[N].allInnerTags("td1").map(function(e){return e.tagContents()}),8===h.length){c=h[0];var S=h[1];if(f=h[2].innerCapture(/^([A-Z]{3})/,1),T=getFuzzyDate(h[3]),b=h[4].innerCapture(/^([A-Z]{3})/,1),y=getFuzzyDate(h[5]),ASSERT(c,S,f,T,b,y)){g=Object.keys(u),C={};for(var I=0;g.length>I;I++)C[g[I]]={name:g[I],seat:u[g[I]].seat[A.length],seatingType:u[g[I]].seatingType[A.length]};v=a(c),i=n.getSpan().innerCapture(regExpFormatted(/\1 \2:\s+(\w{6})/,v,t.recordLocator),1),not(i)&&(i=n.getSpan().innerCapture(regExpFormatted(/\b\1:\s+(\w{6})/,t.recordLocator),1)),A.push({airlineName:c,airlineCode:v,flightNumber:S,reservationId:i,departureCode:f,departureTime:T,arrivalCode:b,arrivalTime:y,passengers:C})}}for(var x=[],N=0;A.length>N;N++)for(var z=A[N],F=Object.keys(z.passengers),I=0;F.length>I;I++){var k=z.passengers[F[I]],R={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:z.airlineName,airlineCode:z.airlineCode||"AA",flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:k.name},checkinUrl:o,reservationId:z.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:k.totalPrice,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:k.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:k.seatingType,seatNumber:k.seat}}};valid(k.membershipNumber)&&(R.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:k.membershipNumber,programName:k.programName}),x.push(R)}return x.length?x:void 0}}).call();
