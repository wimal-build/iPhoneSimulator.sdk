// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("apple.com-travel.res.APAC",function(e){return void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0?!1:/^My Trip Ticketed/.test(e.subject)},function(e){if(void 0!==e.accountHandles&&intersectArrays(e.accountHandles.map(function(e){return e.toLowerCase()}),parseEmailListFromMessageHeader(e.headers,"cc")).length>0)return STOP;if(/^My Trip Ticketed/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,c,l,m,d,g,h,u,T,y,v,x,C,f,A,b,k,N,R,S,P,$,F,I,U,D,E,L,w,z,H=[],M=[],O={},Z=[],j=[];n=t.getSpan().innerCapture(/Travel Itinerary for\s+(.+?)\n/,1),O[""+n]={name:n,seats:{},seatingType:{}},c=t.getSpan().allInnerCapture(/Reference #/);for(var q=0;c.length>q;q++)p=c[q][0].withStart(c[q][0].previousText("Airline").getStart()).withEnd(c[q][0].nextText("Flight time").getEnd()),d=p.previousText("Flight").parentAnyTag("td").tagContents().innerCapture(/Flight ($<code>\D+)($<flightNumber>\d+)/),g=d?d.$code:null,l=d?d.$flightNumber:null,s=p.innerText("Reference #").nextAnyTag("td").tagContents(),h=s.nextTag("table1").nextText("From").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),T=h?h.$airport:null,y=h?h.$code:null,v=s.nextTag("table1").nextTag("table1").nextText("To").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),C=v?v.$airport:null,f=v?v.$code:null,u=p.innerText("Departs").nextAnyTag("td").innerDate(),x=p.innerText("Arrives").nextAnyTag("td").innerDate(),valid(l)&&(O[""+n].seats[""+l]=p.innerText("Seat #").nextAnyTag("td").tagContents()),m=p.innerText("Frequent flier #").nextAnyTag("td").innerCapture(/($<programName>\D+)\s*($<membershipNumber>\d+)/),m&&(O[""+n].programName=m?m.$programName:null,O[""+n].membershipNumber=m?m.$membershipNumber:null),ASSERT(s,g,l,u,y,x,f)&&M.push({reservationId:s,airlineCode:g,flightNumber:l,departureTime:u,departureCode:y,departureAirport:T,arrivalTime:x,arrivalCode:f,arrivalAirport:C,passengers:O});N=t.getSpan().allInnerCapture(/Check-in/);for(var q=0;N.length>q;q++)k=N[q][0].withStart(N[q][0].previousText("Hotel").previousText("Hotel").getStart()).withEnd(N[q][0].nextText("Confirmation #").getEnd()),R=k.innerText("Address").previousAnyTag("td").tagContents(),P=k.innerText("Address").nextAnyTag("td").tagContents().innerCapture(/(.+?) </,1),S=k.innerText("Telephone").nextAnyTag("td").tagContents(),A=k.innerText("Check-in").nextAnyTag("td").innerDate(),b=k.innerText("Check-out").nextAnyTag("td").innerDate(),a=k.innerText("Rate").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+)($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,s=k.innerText("Confirmation #").nextAnyTag("td").tagContents(),ASSERT(n,s,R,P,A,b)&&Z.push({name:n,reservationId:s,hotelName:R,hotelAddress:P,hotelPhone:S,checkInDateTime:A,checkOutDateTime:b,totalPrice:i,priceCurrency:o});F=t.getSpan().allInnerCapture(/Rental location/);for(var q=0;F.length>q;q++)$=F[q][0].withEnd(F[q][0].nextText("Confirmation #").getEnd()),a=$.innerText("Approximate Total Price").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+) ($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,U=$.innerText("Rental company").nextAnyTag("td").tagContents(),z=$.innerText("Pick-up").nextAnyTag("td").innerDate(),L=$.innerText("Rental location").nextAnyTag("td").tagContents(),w=$.innerText("Telephone").nextAnyTag("td").tagContents(),E=$.innerText("Drop-off").nextAnyTag("td").innerDate(),D=$.innerText("Return location").nextAnyTag("td").tagContents(),s=$.innerText("Confirmation #").nextAnyTag("td").tagContents(),I=$.innerText("Type of car").nextAnyTag("td").tagContents(),ASSERT(n,s,I,z,L,U)&&j.push({reservationId:s,name:n,totalPrice:i,priceCurrency:o,provider:U,pickupTime:z,pickupAddress:L,pickupTelephone:w,dropoffTime:E,dropoffAddress:D,brand:I});for(var q=0;M.length>q;q++)for(var B=M[q],G=Object.keys(B.passengers),_=0;G.length>_;_++){var J=B.passengers[G[_]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:B.airlineName,airlineCode:B.airlineCode,flightNumber:B.flightNumber,departureAirportFuzzy:B.departureAirport,departureAirportCode:B.departureCode,departureTime:B.departureTime,arrivalAirportFuzzy:B.arrivalAirport,arrivalAirportCode:B.arrivalCode,arrivalTime:B.arrivalTime},underName:{"@type":"http://schema.org/Person",name:J.name},checkinUrl:B.checkinUrl,reservationId:B.reservationId,reservationStatus:"http://schema.org/Reservation"+(B.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:J.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:J.seats[B.flightNumber],seatingType:J.seatingType[B.flightNumber]}},totalPrice:J.totalPrice,priceCurrency:J.currency},valid(J.membershipNumber,J.programName)&&(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:J.membershipNumber,programName:J.programName}),H.push(r)}for(var $,q=0;j.length>q;q++)$=j[q],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:$.totalPrice,priceCurrency:$.priceCurrency,reservationId:$.reservationId,reservationStatus:"http://schema.org/Reservation"+($.reservationStatus||"Confirmed"),checkinUrl:$.checkinUrl,modifyReservationUrl:$.modifyReservationUrl,cancelReservationUrl:$.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:$.name,email:$.email},provider:{"@type":"http://schema.org/Organization",name:$.provider},pickupTime:$.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:$.pickupName,telephone:$.pickupTelephone,address:$.pickupAddress},dropoffTime:$.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:$.dropoffName,telephone:$.dropoffTelephone,address:$.dropoffAddress}},$.brand&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:$.brand},license:$.license,color:$.color}),H.push(r);for(var k,q=0;Z.length>q;q++)k=Z[q],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:k.name,email:k.email},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency,checkinTime:k.checkInDateTime,checkoutTime:k.checkOutDateTime,modifyReservationUrl:k.modifyReservationUrl,cancelReservationUrl:k.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(k.reservationStatus||"Confirmed"),reservationId:k.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:k.hotelName,url:k.hotelUrl,telephone:k.hotelPhone,address:k.hotelAddress}},H.push(r);if(H.length)return H}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/771/772/773","SG3600c401")]);