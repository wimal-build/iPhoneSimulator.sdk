// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("emirates.com-confirmation-en",function(e){return/^Booking Confirmation -/.test(e.subject)},function(e){if(/^Booking Confirmation -/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,o,l,p,s,m,g,u,d,c,h,T,v,b,C,f,y,N,x,A,S,F=[],k={};a=r.getSpan().nextText("BOOKING REFERENCE").nextTag("td5").nextTag("td5").nextTag("td5").tagContents(),o=r.getSpan().nextText("Passengers").nextTag("table3").allInnerTags("tr3"),g=r.getSpan().nextText("Total price in").nextTag("td3").innerCapture(/($<priceCurrency>[A-Z]{3})\s+($<totalPrice>[\d,.]+)/),u=g?g.$totalPrice:null,d=g?g.$priceCurrency:null,o.length>=4&&(i=o[0].innerCapture(/Passenger\s+\d\s+-\s+(.*)\n/,1).trim(),c=o[3].allInnerTagsFiltered("td3"),c=c.length>=2&&""+c[1]!="Not Applicable"?c[1]:null,k[""+i]={name:i,programName:"Frequent Flyer",membershipNumber:c,totalPrice:u,priceCurrency:d,seats:{},seatingType:{}}),s=r.getSpan().nextText("Flights").withEnd(r.getSpan().nextText("Manage Your Booking").getStart()).allInnerTags("table3");for(var $=0,I=s.length;I>$;$++)if(p=s[$].allInnerTags("tr3"),3==p.length&&p[1].innerDate().exists()&&p[2].innerDate().exists()&&(b=p[1].allInnerTagsFiltered("td3"),N=p[2].allInnerTagsFiltered("td3"),b.length>=6&&N.length>=3)){if(T=b[0].innerCapture(/($<code>\w+?)($<flightNumber>\d+)/),v=T?T.$code:null,m=T?T.$flightNumber:null,C=combineDateAndTime(b[1].innerDate(),b[2].innerDate()),h=b[3].innerCapture(/($<departureAirport>.*) \(($<departureCode>[A-Z]{3})\)/),f=h?h.$departureAirport:null,y=h?h.$departureCode:null,x=combineDateAndTime(N[0].innerDate(),N[1].innerDate()),h=N[2].innerCapture(/($<arrivalAirport>.*) \(($<arrivalCode>[A-Z]{3})\)/),A=h?h.$arrivalAirport:null,S=h?h.$arrivalCode:null,l=b[5].innerCapture(/(.*)\n/,1),valid(m,l)){o=Object.keys(k);for(var D=0;o.length>D;D++)k[o[D]].seatingType[""+m]=l}ASSERT(v,m,C,y,x,S)&&F.push({airlineCode:v,flightNumber:m,departureTime:C,departureCode:y,departureAirport:f,arrivalTime:x,arrivalCode:S,arrivalAirport:A,passengers:k})}for(var P=[],$=0;F.length>$;$++)for(var R=F[$],z=Object.keys(R.passengers),E=0;z.length>E;E++){var B=R.passengers[z[E]],j={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:R.airlineName,airlineCode:R.airlineCode,flightNumber:R.flightNumber,departureAirportFuzzy:R.departureAirport,departureAirportCode:R.departureCode,departureTime:R.departureTime,arrivalAirportFuzzy:R.arrivalAirport,arrivalAirportCode:R.arrivalCode,arrivalTime:R.arrivalTime},underName:{"@type":"http://schema.org/Person",name:B.name},checkinUrl:n,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:B.totalPrice,priceCurrency:B.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:t,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:B.seats[""+R.airlineCode+(""+R.flightNumber)],seatingType:B.seatingType[R.flightNumber]}}};valid(B.membershipNumber,B.programName)&&(j.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:B.membershipNumber,programName:B.programName}),P.push(j)}if(P.length)return P}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/433/434","SGc4e6659e"),new ReverseTemplate("emirates.com-flight-confirmation-en",function(e){return/^Your Emirates Itinerary -/.test(e.subject)},function(e){if(/^Your Emirates Itinerary -/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,o,l,p,s,m,g,u,d,c,h,T,v=r.getSpan(),b=[],C={};a=v.nextText("Booking Reference").parentTag("td3").tagContents().innerCapture(regExpFormatted(/\1\n(.+)/,"Booking Reference"),1).trim(),p=v.withInterval(v.nextText("Booking Status").getEnd(),v.nextClosingTag("table5").getStart()).allInnerTagsFiltered("td5"),m=(""+p[0]).match(/([0-9A-Z]{2})/)[1],s=(""+p[0]).match(/([0-9A-Z]{2})(\d+)/)[2],g=combineDateAndTime(p[1].innerDate(),p[2].innerDate()),c=combineDateAndTime(p[8].innerDate(),p[9].innerDate()),[,u,d]=p[3].innerCapture(/(.+)\s\((.+)\)/),[,h,T]=p[10].innerCapture(/(.+)\s\((.+)\)/),o=v.nextText("Booking Status").nextTag("table4").allInnerTagsFiltered("tr4"),i=v.nextText("Booking Status").nextTag("table4").nextTag("td4").tagContents();var f=v.nextText("Flight number").parentTag("table4").allInnerTagsFiltered("tr4");f.shift(),C[""+i]={name:i,seat:{}};for(var y=0,N=f.length;N>y;y++){if(l=(""+f[y]).match(/(?:.+)td4\]\s(.+)/)[1],valid(s,l)){o=Object.keys(C);for(var x=0;o.length>x;x++)C[o[x]].seat[""+s]=l}ASSERT(m,s,g,d,c,T)&&b.push({airlineCode:m,flightNumber:s,departureTime:g,departureCode:d,departureAirport:u,arrivalTime:c,arrivalCode:T,arrivalAirport:h,passengers:C})}var A=[];for(y=0;b.length>y;y++)for(var S=b[y],F=Object.keys(S.passengers),k=0;F.length>k;k++){var $=S.passengers[F[k]],I={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:S.airlineName,airlineCode:S.airlineCode,flightNumber:S.flightNumber,departureAirportFuzzy:S.departureAirport,departureAirportCode:S.departureCode,departureTime:S.departureTime,arrivalAirportFuzzy:S.arrivalAirport,arrivalAirportCode:S.arrivalCode,arrivalTime:S.arrivalTime},underName:{"@type":"http://schema.org/Person",name:$.name},checkinUrl:n,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:$.totalPrice,priceCurrency:$.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:t,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:$.seat[""+S.flightNumber],seatingType:""}}};valid($.membershipNumber,$.programName)&&(I.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:"",programName:""}),A.push(I)}if(A.length)return A}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/433/435","SG53a371eb")]);
