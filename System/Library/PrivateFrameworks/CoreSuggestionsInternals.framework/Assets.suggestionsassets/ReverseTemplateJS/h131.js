// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o,m,g,p,s,l,u,c,d,h,T,C,b,N,v,x,y,f,$,A,S,k=[],P={};n=a.getSpan().nextText(r.confirmationCode).parentTag("table2").tagContents().innerCapture(r.confirmationCodeRegex,1);var z=a.getSpan().nextText(r.passengerInfo).parentTag("table2").nextTag("td2").nextTag("td2").nextTag("td2").nextTag("td2");m=z.nextTag("td2").tagContents(),$=z.nextTag("td2").nextTag("td2").tagContents(),d=z.nextTag("td2").nextTag("td2").nextTag("td2").tagContents().innerCapture(/($<programName>\D+)($<membershipNumber>\d+)/),S=d?d.$programName:null,A=d?d.$membershipNumber:null,c=a.getSpan().nextText(r.totalPrice).nextTag("td2").tagContents().innerCapture(/($<currency>\w+)\s($<totalPrice>.+)/),l=c?c.$totalPrice:null,u=c?c.$currency:null,P[o]={name:m,programName:S,membershipNumber:A,ticketNumber:$,seats:{},seatingType:{},totalPrice:l,priceCurrency:u},i=a.getSpan().nextText(r.checkinUrl).nextTag("td2").innerLink(),p=a.getSpan().nextText(r.itinerary).parentTag("table2").allInnerTags("td2");for(var F=8;p.length>F;F+=14){var g=p[F].tagContents(),R=p[F+7].tagContents();b=combineDateAndTime(g,R),g=p[F+4].tagContents(),R=p[F+11].tagContents(),x=combineDateAndTime(g,R),N=p[F+2].tagContents(),v=p[F+9].tagContents(),y=p[F+3].tagContents(),f=p[F+10].tagContents(),h=p[F+1].tagContents().innerCapture(/($<code>\w+)\s($<flightNumber>\d+)/),C=h?h.$code:null,s=h?h.$flightNumber:null,ASSERT(C,s,b,N,x,y)&&k.push({airlineCode:C,airlineName:T,flightNumber:s,departureAirport:N,departureCode:v,departureTime:b,arrivalAirport:y,arrivalCode:f,arrivalTime:x,passengers:P})}for(var D=[],F=0;k.length>F;F++)for(var I=k[F],M=Object.keys(I.passengers),U=0;M.length>U;U++){var z=I.passengers[M[U]],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:I.airlineName,airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name,email:z.email},checkinUrl:i,reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:z.totalPrice,priceCurrency:z.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:z.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[I.flightNumber],seatingType:z.seatingType[I.flightNumber]}}};valid(z.membershipNumber,z.programName)&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:z.programName}),D.push(w)}return D.length?D:void 0}}).call();