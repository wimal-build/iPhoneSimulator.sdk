// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline-flight-confirmation-en",function(e){return/Your priceline itinerary for .+/.test(e.subject)},function(e){if(!/Your priceline itinerary for .+/.test(e.subject))return CONTINUE;var t=loadHelper("priceline-schemaorg-parser.js")(e);if(t&&t.length>0)return t;var n="en_US",r={};return r.dateFormatRegExp=/\D{3}\s\D{3}\s\d{1,2}/,r.timeFormatRegExp=/(\d{2}:\d{2}\s[AP]M)\s+-\s+(\d{2}:\d{2}\s[AP]M)/,r.airlineAndFlightNumberRegExp=/\n(.+)\sFlight\s(\d{1,4})/,r.ticketNumberRegExp=/Ticket Number:/,r.isOverNightRegExp=/Overnight Flight/,loadHelper("priceline-flight-confirmation-skeleton.js")(e,n,r)},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1172/1174","SGa8c88812"),new ReverseTemplate("priceline-package-confirmation-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var n=e.innerAddress();if(n.getLength()>0)for(var r=n.split(" ")[0],a=1;t.length>a;a++)if((""+t[a]).split(" ")[0]===""+r){e=n;break}return""+e}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var r,a,i,o,s,p,g,l,m,c,u,d,x,h,T,f,C,v,S,b,y,N,R,k,A,I,P,D,F,U,E,$,O,L,j,w,Z,z,M,H,Y,G,_,B=[],q=[],J=[],K={},Q=[],V=[];if(n.getSpan().nextText("time to pack your bags").exists())N=!0,a=n.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1),K[""+a]={name:""+a,totalPrice:null,currency:null,seats:{},seatingType:{}},d=n.getSpan().nextText("Departing").parentTag("table5").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{if(o=n.getSpan().nextText("Amount Charged to Card").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1),c=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1),q=n.getSpan().nextText("Passenger and Ticket Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),q.length)for(var W=0,X=q.length;X>W;W+=4)a=q[W][1],not(a)||(K[""+a]={name:""+a,totalPrice:s,currency:c,seats:{},seatingType:{}});d=n.getSpan().nextText("Flight Details").nextTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(d.length)for(var ee,W=0;ee=d[W];W++)if(""+ee[0]=="Departing")i=ee[0].withStart(ee[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,y=i?i.$arrivalCode:null,C=ee[1],f=ee[2].innerDate();else if(""+ee[0]=="Arriving")b=ee[1],S=ee[2].innerDate();else if(""+ee[0]=="Flight / Class"||""+ee[0]=="Airline / Flight"){if(h=ee[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),T=h?h.$name:null,x=h?h.$flightNumber:null,N?(u=null,g=ee[2]&&ee[2].innerCapture(/Conf Number: (.*)/,1)):(u=ee[2],g=ee[3]&&ee[3].innerCapture(/Conf Number: (.*)/,1)),valid(x)){q=Object.keys(K);for(var a,te=0;a=q[te];te++)K[a].seatingType[""+x]=u}ASSERT(T,x,C,f,v,b,S,y)&&(J.push({airlineName:T,flightNumber:x,departureAirport:C,departureCode:v,departureTime:f,arrivalAirport:b,arrivalTime:S,arrivalCode:y,reservationId:g,passengers:K}),h=T=x=C=f=v=b=S=y=g=null)}if(!n.getSpan().nextText("Hotel Reservation").exists()&&!n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(n.getSpan().nextText("Hotel Reservation").exists()?(a=n.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),g=n.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=n.getSpan().nextText("Hotel Reservation"),P=i.nextTag("td9").tagContents(),A=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),D=A.innerPhoneNumber(),F=A.tagContents(),D.exists()&&(F=F.withEnd(D.getStart()).trim()),A.innerAddress().getLength()>=F.getLength()&&(F=A.innerAddress()),R=i.nextText("Check-In").nextTag("td11").innerDate(),k=i.nextText("Check-Out").nextTag("td11").innerDate(),s=n.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(a=n.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),g=n.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),P=n.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),A=P.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),F=A?A.$address:null,D=A?A.$phone:null,R=n.getSpan().nextText("Check-In").nextDate(),k=n.getSpan().nextText("Check-Out").nextDate()),ASSERT(R,k,F)&&Q.push({name:a,reservationId:g,totalPrice:s,priceCurrency:p,checkInDateTime:R,checkOutDateTime:k,hotelName:P,hotelUrl:I,hotelPhone:D,hotelAddress:F})),n.getSpan().nextText("Your Rental Car Confirmation").exists()){_=n.getSpan().next(/Pick-up: \n/).nextDate(),Y=n.getSpan().nextText("Rental Location").nextAddress(),z=n.getSpan().next(/Drop-off: \n/).nextDate(),w=Y,a=n.getSpan().next(/Driver Name: \n+(.*?)\s\s/).innerCapture(/Driver Name: \n+(.*?)\s\s/,1).trim(),g=n.getSpan().next(/Confirmation Number: \n+(.*?)\s/).innerCapture(/Confirmation Number: \n+(.*?)\s/,1),U=n.getSpan().next(/Modify Reservation/).nextLink(),E=n.getSpan().next(/Cancel Reservation/).nextLink(),O=n.getSpan().next(/Rental Car Contact Information/).nextTag("td6").tagContents().trim(),g.exists()&&($=n.getSpan().next(/Car Type: \n+(.*)\n/).innerCapture(/Car Type: \n+(.*)\n/,1).trim()),Z=n.getSpan().next(/Phone Number \n+(.*?)\s\s/).innerCapture(/Phone Number \n+(.*?)\s\s/,1).trim(),G=Z;var ne=n.getSpan().next("Estimated Total").nextAnyTag("td");s=ne.tagContents().innerCapture(/.*?([\d,.]+)/,1).trim(),p=ne.tagContents().innerCapture(/(\w+)\s.*?[\d,.]+/,1).trim(),ASSERT(_,O,g,OR(Y,H))&&V.push({name:a,brand:$,pickupTime:_,pickupName:H,pickupAddress:Y,pickupTelephone:G,dropoffTime:z,dropoffName:j,dropoffAddress:w,dropoffTelephone:Z,provider:O,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:U,cancelReservationUrl:E})}else if(n.getSpan().nextText("Rental Car Confirmation").exists()){if(M=n.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),M.length>=3&&(_=M[0].innerDate(),H=M[1].tagContents(),Y=n.getDetachedSpan(M.slice(2).join(" ")),Y=t(Y,M)),L=n.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(z=L[0].innerDate(),j=L[1].tagContents(),w=n.getDetachedSpan(L.slice(2).join(" ")),w=t(w,L)),a=n.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),g=n.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),!g.exists()){var re=n.getSpan().next(/Rental Car Confirmation Number.*\n(.*?)\:\s+(\w+)/).innerCapture(/Rental Car Confirmation Number.*\n($<provider>.*?)\:\s+($<reservationId>\w+)/);O=re.$provider,g=re.$reservationId}if(U=n.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),E=n.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),g.exists()&&(O&&O.exists()||(O=n.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+g),1)),O.exists())){var ae=n.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();$=ae.innerCapture(regExpFormatted(/\1 (.*)$/,""+O),1),$.exists()||(""+ae).match(/\n/)&&($=ae.withStart(ae.next("\n").getEnd()))}Z=(""+n.getSpan().nextText("Phone Number").nextTag("td10").tagContents()).trim(),G=Z,s=n.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)\(?/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(_,O,g,OR(Y,H))&&V.push({name:a,brand:$,pickupTime:_,pickupName:H,pickupAddress:Y,pickupTelephone:G,dropoffTime:z,dropoffName:j,dropoffAddress:w,dropoffTelephone:Z,provider:O,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:U,cancelReservationUrl:E})}for(var W=0;J.length>W;W++)for(var ie=J[W],oe=Object.keys(ie.passengers),se=0;oe.length>se;se++){var pe=ie.passengers[oe[se]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:ie.airlineName,flightNumber:ie.flightNumber,departureAirportFuzzy:ie.departureAirport,departureAirportCode:ie.departureCode,departureTime:ie.departureTime,arrivalAirportFuzzy:ie.arrivalAirport,arrivalAirportCode:ie.arrivalCode,arrivalTime:ie.arrivalTime},underName:{"@type":"http://schema.org/Person",name:pe.name},checkinUrl:m,reservationId:ie.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:pe.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:pe.seats[ie.flightNumber],seatingType:pe.seatingType[ie.flightNumber]}},totalPrice:pe.totalPrice,priceCurrency:pe.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(pe.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:pe.membershipNumber,programName:pe.programName}),B.push(r)}for(var ge,W=0;V.length>W;W++)ge=V[W],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:ge.totalPrice,priceCurrency:ge.priceCurrency,reservationId:ge.reservationId,reservationStatus:"http://schema.org/Reservation"+(ge.reservationStatus||"Confirmed"),checkinUrl:ge.checkinUrl,modifyReservationUrl:ge.modifyReservationUrl,cancelReservationUrl:ge.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:ge.name,email:ge.email},provider:{"@type":"http://schema.org/Organization",name:ge.provider},pickupTime:ge.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:ge.pickupName,telephone:ge.pickupTelephone,address:ge.pickupAddress},dropoffTime:ge.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:ge.dropoffName,telephone:ge.dropoffTelephone,address:ge.dropoffAddress}},ge.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:ge.brand},license:ge.license,color:ge.color}),B.push(r);for(var A,W=0;Q.length>W;W++)A=Q[W],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:A.name,email:A.email},totalPrice:A.totalPrice,priceCurrency:A.priceCurrency,checkinTime:A.checkInDateTime,checkoutTime:A.checkOutDateTime,modifyReservationUrl:A.modifyReservationUrl,cancelReservationUrl:A.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(A.reservationStatus||"Confirmed"),reservationId:A.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:A.hotelName,url:A.hotelUrl,telephone:A.hotelPhone,address:A.hotelAddress}},B.push(r);if(B.length)return B}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/1014/1172/1176","SGd546163e")]);
