// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("expedia.com-flight-changes-en",function(e){return/^Changes have been made to your .*? flight/.test(e.subject)||/^Your flight itinerary .*? changed$/.test(e.subject)},function(e){if(/^Changes have been made to your .*? flight/.test(e.subject)||/^Your flight itinerary .*? changed$/.test(e.subject)){if(!/notifications@expedia.com/.test(e.from)){var r="en_US",t={};t.itineraryLabel="Revised Itinerary",t.confirmationLabel="Airline confirmation code",t.passenger="Traveler(s)",t.traveler="Traveler",t.ticketNo="Airline Ticket No.",t.cancelled=/Per your request, your flight is canceled/,t.cancelledLabel="CANCELED";var a=loadHelper("expediamail.com-flight-alternative-skeleton.js");return a(e,r,t)}var i=Scanner.fromMessage(e);i.setLocale("en_US");var n,s,l,o,p,u,m,g,c,h,d,f,v,b,C,T,y=[],N={};if(n=i.getSpan().nextText("Passenger(s):").parentAnyTag("td").tagContents().innerCapture(/\bPassenger\(s\): (.*)/,1),not(n))return CONTINUE;n=n.split(",").map(function(e){return e.trim()});for(var S=0;n.length>S;S++)N[""+n[S]]={name:n[S],seats:{},seatingType:{}};p=i.getSpan().nextText("Your updated flight itinerary is below").nextText("Flight Details").parentAnyTag("table");var x=p.getTagNumber();p=p.withStart(i.getSpan().nextText("Your updated flight itinerary is below").getEnd()).allInnerTags("tr"+x).map(function(e){return e.allInnerTagsFiltered("td"+x)}).filter(function(e){return e.length>0});for(var A=0;p.length>A;A++)if(s=p[A],s[0].innerCapture(/^Flight(?: Change)? Details/)&&s[1])d=s[1];else if(s[1]&&s[1].innerCapture(/^Flight Number:/))m=s[0],u=s[1].innerCapture(/^Flight Number: ($<code>\w{2})($<flightNumber>\d+)/),g=u?u.$code:null,c=u?u.$flightNumber:null,i.getSpan().nextText(""+m+" confirmation code:").exists()&&(l=i.getSpan().innerCapture(RegExp(regExpEscape(""+m)+" confirmation code: (.*)\\s"),1));else if(s[0].innerCapture(/^From:/)&&s[1])f=s[0].innerCapture(/^From: \(([A-Z]{3})\)/,1);else if(s[0].innerCapture(/^To:/)&&s[1])b=s[0].innerCapture(/^To: \(([A-Z]{3})\)/,1),C=s[1].innerCapture(/^Arrive: .* \+1 day$/),v=combineDateAndTime(d,s[1].lastInnerDate()),not(C)||(v=modifyDate(v,1));else if(s[1]&&s[1].innerCapture(/^Class:/))T=s[1].innerCapture(/^Class: (.*)/,1);else if(s[0].innerCapture(/^Equipment:/)){if(s[1]&&s[1].innerCapture(/^Seats:/)&&(o=s[1].innerCapture(/^Seats: (.*)/,1).split(",").map(function(e){return e.trim()})),valid(c)){n=Object.keys(N);for(var S=0;n.length>S;S++)valid(o)&&(N[n[S]].seats[""+c]=o[S]),valid(T)&&(N[n[S]].seatingType[""+c]=T)}ASSERT(g,c,d,f,v,b)&&y.push({airlineName:m,airlineCode:g,flightNumber:c,departureTime:d,departureCode:f,arrivalTime:v,arrivalCode:b,reservationId:l,passengers:N}),u=m=g=c=h=d=f=v=b=T=o=l=null}for(var F,k=[],A=0;y.length>A;A++){F=y[A];for(var E=Object.keys(F.passengers),I=0;E.length>I;I++){var j=F.passengers[E[I]],R={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:F.airlineName,airlineCode:F.airlineCode,flightNumber:F.flightNumber,departureAirportFuzzy:F.departureAirport,departureAirportCode:F.departureCode,departureTime:F.departureTime,arrivalAirportFuzzy:F.arrivalAirport,arrivalAirportCode:F.arrivalCode,arrivalTime:F.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:F.checkinUrl,reservationId:F.reservationId,reservationStatus:"http://schema.org/Reservation"+(F.reservationStatus||"Confirmed"),totalPrice:j.price,priceCurrency:j.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:j.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[F.flightNumber],seatingType:j.seatingType[F.flightNumber]}}};valid(j.membershipNumber,j.programName)&&(R.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:j.programName}),k.push(R)}}if(k.length)return k}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/771/804/805","SG7272f80d")]);