// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,g,p,o,l,d,u=[],m=[],T=[];i=a.getSpan().nextTag("table3").innerTag("tr3").nextTag("tr3").nextTag("tr3").innerTag("td3").nextTag("td3").tagContents(),g=a.getSpan().nextText(r.payment).nextText(r.total).nextTag("td5").tagContents(),p=g.innerCapture(regExpFormatted(/([\d\.,]+)/),1),o=g.innerCapture(regExpFormatted(/\((\w{3})\)/),1),l=a.getSpan().nextText(r.passenger).parentTag("table3").allInnerTags("tr3");for(var s=1;l.length>s;s++){var x={};x.name=l[s].innerTag("td4").tagContents().innerCapture(regExpFormatted(/.+?\s(.*)/),1),ASSERT(x.name)&&T.push(x)}d=a.getSpan().nextText(r.itinerary).parentTag("table2").allInnerTags("table3");for(var v=0;d.length>v;v++){n=d[v].allInnerTags("table4");for(var h=1;n.length>h;h++){var C,c,z,F=n[h],y={},S=F.innerTag("td5").tagContents().innerCapture(regExpFormatted(/([\w]+)/),1),E=S.nextTag("td5").tagContents().innerCapture(regExpFormatted(/([\d]+)/),1),A=E+" "+S;"zh_Hans_CN"===t&&(A=S+"/"+E);var N=F.nextTag("td3").nextTag("td3").tagContents(),f=N.innerCapture(/($<airline>[\w]{2})($<number>\d{1,4})/);y.airlineCode=f.$airline,y.flightNumber=f.$number,y.airlineName=F.nextTag("tr3").nextTag("tr3").innerTag("td3").tagContents().innerCapture(regExpFormatted(/\1 (.*)/,r.operated),1),y.airlineName.exists()||(y.airlineName="Japan Airlines"),C=F.nextTag("tr3").nextTag("tr3").nextTag("tr3").innerTag("td3").tagContents(),z=C.innerDate(),c=C.lastInnerDate(),y.departureTime=getFuzzyDate(a.getDetachedSpan(A+" "+z)),((""+C).match(/\n/g)||[]).length>3?(A=a.getSpan().withInterval(c.previousText("\n").previousText("\n").previousText("\n").getEnd(),c.previousText("\n").previousText("\n").getEnd()),E=A.innerCapture(regExpFormatted(/(\d+)/),1),A=E+" "+A,y.arrivalTime=getFuzzyDate(a.getDetachedSpan(A+" "+c))):y.arrivalTime=a.getDetachedSpan(A+" "+c),y.departureAirportFuzzy=a.getSpan().withInterval(z.getEnd(),z.nextRegExp(regExpFormatted(/\-/)).getStart()).trim(),y.arrivalAirportFuzzy=a.getSpan().withInterval(c.getEnd(),c.nextRegExp(regExpFormatted(/\-/)).getStart()).trim(),ASSERT(y.arrivalAirportFuzzy,y.departureAirportFuzzy,y.flightNumber,y.departureTime,y.arrivalTime)&&u.push(y)}}for(var b=0;u.length>b;b++){var I=u[b];for(var D in T){var w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:I.airlineName,airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirportFuzzy,departureAirportCode:I.departureAirportCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirportFuzzy,arrivalAirportCode:I.arrivalAirportCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:T[D].name},checkinUrl:"",reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:p,priceCurrency:o,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};m.push(w)}}return m.length?m:void 0}}).call();