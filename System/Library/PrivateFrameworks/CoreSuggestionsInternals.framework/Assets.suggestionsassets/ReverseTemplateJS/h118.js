// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var i,n,m,p,l,o,u,s,h,g,d,c,v,N=[],y={};u=a.getSpan(),n=u.next(t.reservationId).innerCapture(t.reservationId,1);var b;do{if(b=b?b.next(t.name):u.next(t.name),p=b.innerCapture(t.name,1),not(p))return CONTINUE;y[""+p]={name:p,seats:{},seatingType:{},ticketNumber:null,totalPrice:null,priceCurrency:null}}while(0!==(""+b.next(t.name)).length);if(not(p))return CONTINUE;y[""+p]={name:p,seats:{},seatingType:{},ticketNumber:null,totalPrice:null,priceCurrency:null};var C;do C=C?C.next(t.flightSummary):u.next(t.flightSummary),l=C.innerCapture(t.flightSummary),g=C.next(t.departure).nextDate(),(""+g).match(/\-/)&&(g=g.nextDate()),c=C.next(t.arrival).nextDate(),(""+c).match(/\-/)&&(c=c.nextDate()),d=C.next(t.departure).innerCapture(t.departure).$airportAddress,v=C.next(t.arrival).innerCapture(t.arrival).$airportAddress,h=l.$airlineCode,s=l.$airlineName,o=l.$flightNumber,ASSERT(h,o,d,g,v,c)&&N.push({reservationId:n,airlineName:s,airlineCode:h,flightNumber:o,departureAirport:d,departureTime:g,arrivalAirport:v,arrivalTime:c,passengers:y});while(0!==(""+C.next(t.flightSummary)).length);for(var f=[],x=0;N.length>x;x++)for(var T=N[x],A=Object.keys(T.passengers),S=0;A.length>S;S++){var k=T.passengers[A[S]],I={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:T.airlineName,airlineCode:T.airlineCode,flightNumber:T.flightNumber,departureAirportFuzzy:T.departureAirport,departureAirportCode:T.departureCode,departureTime:T.departureTime,arrivalAirportFuzzy:T.arrivalAirport,arrivalAirportCode:T.arrivalCode,arrivalTime:T.arrivalTime},underName:{"@type":"http://schema.org/Person",name:k.name},checkinUrl:m,reservationId:T.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:null,priceCurrency:null,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:k.seats[T.flightNumber],seatingType:k.seatingType[T.flightNumber]}}};valid(k.membershipNumber,k.programName)&&(I.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:k.membershipNumber,programName:k.programName}),f.push(I)}return f.length?f:void 0}}).call();