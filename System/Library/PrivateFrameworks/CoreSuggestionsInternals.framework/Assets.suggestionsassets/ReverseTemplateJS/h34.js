// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,s,r){function n(e,s){function r(e){function s(e,r){for(var n in r)if(0===e.indexOf(n))return e.length===n.length?!0 in r[n]?r[n][!0]:!1:s(e.slice(n.length),r[n]);return!1}return s(e,o.w)}function n(e){var s=/ ?[\s\.\\(\)\[\]\|\/\,<\>\-\_\!\?\~\#\:\;\u3010\u3002\u3011"] ?/g,r=" "+e.replace(s,"  ")+" ",n=/(\s([a-z0-9]+)?[a-z]\d([a-z0-9]+)?\s)|(\s([a-z0-9]+)?\d[a-z]([a-z0-9]+)?\s)/g,l=r.replace(n," REFTAG "),t=/ +/g,o=l.replace(t," "),a=/\d+(( \d+)+)?/g,i=o.replace(a,"0").trim();return i.split(" ")}function l(e,s){s||(s="");var l=e.toLowerCase(),a=n(l),i=s.toLowerCase();if(i){a.concat(n(i.split("@")[0]));var u=i.split("@")[1].split(".");if(u.length>2&&u[u.length-2].length+u[u.length-1].length>5){var c=n(u[0]);a.push("CS_"+c[0])}}var _,h,d=o.bias.slice(),f=new Set,g=0;for(_=0;a.length>_;_++){var v=r(a[_]);if(v){if(!f.has(a[_])){if(Array.isArray(v))for(h=0;v.length>h;h++)d[h]=d[h]+v[h];else for(h in v)d[h]=d[h]+v[h];f.add(a[_])}}else g+=1}if(g>0)for(_=0;o.unk_words_weights.length>_;_++)d[_]+=o.unk_words_weights[_];var p=[],w=[],E=[],m=[];for(_=0;o.usecases.length>_;_++)o.usecases[_]===t.NoEvent?(p.push([t.NoEvent,d[_]+o.high_recall_threshold]),E.push([t.NoEvent,d[_]+o.high_precision_threshold])):(p.push([o.usecases[_],d[_]]),E.push([o.usecases[_],d[_]])),w.push([o.usecases[_],d[_]]);for(h=0;o.locales.length>h;h++)m.push([o.locales[h],d[_+h]]);return p.sort(function(e,s){return s[1]-e[1]}),w.sort(function(e,s){return s[1]-e[1]}),E.sort(function(e,s){return s[1]-e[1]}),m.sort(function(e,s){return s[1]-e[1]}),{high_recall_model_usecase_results:p,regular_usecase_results:w,high_precision_model_usecase_results:E,locale_results:m,logs:{token_count:a.length,unk_word_count:g}}}s||(s="");var t=loadHelper("UseCaseEnum.js"),o=loadHelper("model.js");return o.usecases=[t.NoEvent,t.Confirmed,t.Cancelled],o.locales=["de_DE","ja_JP","en_US","fr_FR","es_ES","zh_Hans","nl_NL","it_IT","ko_KR"],o.high_recall_threshold=-7.5,o.high_precision_threshold=11.5,o.bias=[0,0,0,0,0,0,0,0,0,0,0,0],o.unk_words_weights=[1,-1,-3,-3,-5,0,-2,-3,-4,-4,-3,-6],l(e,s)}r||(r="");for(var l=loadHelper("UseCaseEnum.js"),t=loadHelper("use_case_no_event_keywords.js"),o=0;t.length>o;o++)if(t[o].test(r))return{use_case:l.NoEvent,locale:"xx_XX",log:{}};var a,i=n(tokenizeString(s).join(" "),r),u=loadHelper("use_case_overrides.js"),c=u[r.replace(/.*</,"").replace(/>.*/,"").split("@")[1]];if(void 0!==c){var _;for(_=0;c.cancelled.length>_&&void 0===a;_++)c.cancelled[_].test(s)&&(a=l.Cancelled);for(_=0;c.confirmed.length>_&&void 0===a;_++)c.confirmed[_].test(s)&&(a=l.Confirmed);for(_=0;c.noevent.length>_&&void 0===a;_++)c.noevent[_].test(s)&&(a=l.NoEvent)}return void 0!==a&&(i[e+"_usecase_results"][0][0]=a),{use_case:i[e+"_usecase_results"][0][0],locale:i.locale_results[0][0],log:i.logs}}}).call();
