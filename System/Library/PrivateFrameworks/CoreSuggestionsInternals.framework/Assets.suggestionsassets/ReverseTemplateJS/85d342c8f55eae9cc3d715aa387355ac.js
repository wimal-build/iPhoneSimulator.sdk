// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("virginamerica.com-confirmation-and-checkin-en",function(e){return/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)},function(e){if(/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,s,o,p,l,m,g,u,d,c,h,v,C,T,b,f,A,y,x=[],N={};if(t=r.getSpan().innerCapture(/\bYour Confirmation Code: ([A-Z]{6})/,1),a=t.nextLink(),i=r.getSpan().nextRegExp(/Who['\u2019]s Flying/).nextAnyTag("table"),i.exists()){var $=i.getTagNumber();i=i.allInnerTags("tr"+$);for(var S,F=1;S=i[F++];)u=S.allInnerTags("td"+$),n=u[0].tagContents(),N[""+n]={name:n,membershipNumber:""+u[1].tagContents(),seatList:u[2]&&u[2].tagContents().split(/(?:\s+|,)(?:\/\s+)?/g).filter(function(e){return"Not"!=e}).map(function(e){return"Selected"==e||"N/A"==e?"":e})}}if(p=r.getSpan().nextRegExp(/Where You['\u2019]re Going/).nextAnyTag("table"),p.exists()){var $=p.getTagNumber();p=p.allInnerTags("tr"+$);for(var F=1;o=p[F];F++)if(o=o.allInnerTags("td"+$),o.length>=4&&(s=o[0].innerDate(),d=o[1].tagContents().innerCapture(/($<code>.*?)\s*($<flightNumber>\d{1,4})/g),c=d?d.$code:null,l=d?d.$flightNumber:null,h=o[2].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),C=h?h.$airport:null,T=h?h.$code:null,v=combineDateAndTime(s,o[2].tagContents().innerDate()),b=o[3].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),A=b?b.$airport:null,y=b?b.$code:null,f=combineDateAndTime(s,o[3].tagContents().innerDate()),v>f&&(f=modifyDate(f,1)),ASSERT(c,l,T,v,y,f))){for(var k=Object.keys(N),D=0;n=k[D++];)N[n].seats||(N[n].seats={}),N[n].seatList.length>=F&&(N[n].seats[l]=N[n].seatList[F-1]);x.push({airlineCode:c,flightNumber:l,departureAirport:C,departureCode:T,departureTime:v,arrivalAirport:A,arrivalCode:y,arrivalTime:f,passengers:N})}}g=r.getSpan().firstText("What It Costs").nextTag("table3").innerCapture(/This total is for [0-9][\d]* Traveler\(s\) in (.*):/,1),m=r.getSpan().nextText("Grand Total:").nextTag("td4").tagContents().innerCapture(/([\d,.]+)/,1);for(var R=[],F=0;x.length>F;F++){var z=x[F];if(z.passengers)for(var k=Object.keys(z.passengers),D=0;k.length>D;D++){var I=z.passengers[k[D]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:z.airlineCode,flightNumber:z.flightNumber,departureAirportFuzzy:z.departureAirport,departureAirportCode:z.departureCode,departureTime:z.departureTime,arrivalAirportFuzzy:z.arrivalAirport,arrivalAirportCode:z.arrivalCode,arrivalTime:z.arrivalTime},underName:{"@type":"http://schema.org/Person",name:I.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:I.seats[z.flightNumber]}},checkinUrl:a,reservationId:t,totalPrice:m,priceCurrency:g,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(I.membershipNumber)&&(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:I.membershipNumber,programName:"Frequent Flyer"}),R.push(schema)}}if(R.length)return R}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/641/642","SG781cd342"),new ReverseTemplate("virginamerica.com-reservation-en",function(e){return/^Virgin America Reservation/.test(e.subject)},function(e){if(/^Virgin America Reservation/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,s,o,p,l,m,g,u,d,c,h,v,C,T,b,f,A,y,x,N=[],$={};if(t=r.getSpan().innerCapture(/\bYour Confirmation Code: ([A-Z]{6})/,1),a=t.nextLink(),u=r.getSpan().nextText("TOTAL").nextAnyTag("td").tagContents(),d=u.innerCapture(/([\d,.]+)/,1),c=u.innerCapture(/([^\d,.]+)/,1),i=r.getSpan().allInnerCapture(/Traveler \d{1,}:/),i.length)for(var S=0,F=i.length;F>S;S++){n=i[S][0].parentAnyTag("td").tagContents().innerCapture(/Traveler \d{1,}: (.*)/,1),h=n.parentTag("table4");var k=h.nextTag("table4");g=k.innerText("Frequent Flyer:").nextAnyTag("td").tagContents(),not(int(g))&&(g=null),s=k.nextTag("table4").innerText("Seats:").nextAnyTag("td").tagContents().innerCapture(/(.*?) </,1),s=s.split(" ").map(function(e){return/\d{1,2}[A-Z]/.test(""+e)?e:null}),$[""+n]={name:n,membershipNumber:g,totalPrice:d,priceCurrency:c,seats:{},seatingType:{},seatList:s}}var D=concatRegExp(/($<departureAirport>.+?) \(($<departureCode>[A-Z]{3})\) to /,/($<arrivalAirport>.+?) \(($<arrivalCode>[A-Z]{3})\)/);if(l=r.getSpan().allInnerCapture(D),l.length)for(var R=0,F=l.length;F>R;R++)if(p=l[R],b=p.$departureAirport,f=p.$departureCode,y=p.$arrivalAirport,x=p.$arrivalCode,o=p[0].nextText("Date:").nextTag("td4").tagContents(),not(o.innerDate())&&(o=o.innerCapture(/($<day>\d+)($<month>\D+)($<year>\d+)/),o&&(o=r.getDetachedSpan(""+o.$day+" "+o.$month+" "+o.$year))),o=o.innerDate(),v=p[0].nextText("Flight:").nextAnyTag("td").tagContents().innerCapture(/($<code>[a-zA-Z]+)\s*($<flightNumber>\d+)/),C=v?v.$code:null,m=v?v.$flightNumber:null,valid(o)&&(T=combineDateAndTime(o,p[0].nextText("Depart:").nextDate()),A=combineDateAndTime(o,p[0].nextText("Arrive:").nextDate())),ASSERT(C,m,T,f,A,x)){i=Object.keys($);for(var S=0;i.length>S;S++)$[i[S]].seats[""+m]=$[i[S]].seatList[N.length];N.push({airlineCode:C,flightNumber:m,departureTime:T,departureCode:f,departureAirport:b,arrivalTime:A,arrivalCode:x,arrivalAirport:y,passengers:$})}for(var z,I=[],R=0;N.length>R;R++){var L=N[R];if(L.passengers)for(var j=Object.keys(L.passengers),Z=0;j.length>Z;Z++){var P=L.passengers[j[Z]];z={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:L.airlineCode,flightNumber:L.flightNumber,departureAirportFuzzy:L.departureAirport,departureAirportCode:L.departureCode,departureTime:L.departureTime,arrivalAirportFuzzy:L.arrivalAirport,arrivalAirportCode:L.arrivalCode,arrivalTime:L.arrivalTime},underName:{"@type":"http://schema.org/Person",name:P.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:P.seats[L.flightNumber]}},checkinUrl:a,reservationId:t,totalPrice:d,priceCurrency:c,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(P.membershipNumber)&&(z.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:P.membershipNumber,programName:"Frequent Flyer"}),I.push(z)}}if(I.length)return I}},"0/1/2/3/4/5/6/5/7/7/7/7/4/8/9/244/641/644","SGf784a29c")]);
