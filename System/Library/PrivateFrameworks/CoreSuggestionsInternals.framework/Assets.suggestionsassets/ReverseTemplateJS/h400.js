// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r){var t=Scanner.fromMessage(e);t.setLocale("en_US");for(var a=t.getSpan(),i=[],n=[],o=[],p=e.plain.split(/Departing From/i).length-1,m=(e.plain.slice(),0);p>m;m++)a=a.next(/(^Flight [A-Z]{2}[\s\S]*?)(?:^Flight [A-Z]|^Hotel$|^Car Rental$|^Plan)/gm),o.push(""+a);return o.forEach(function(e,a){var i,o,p,m,c,l,s,u,h,d,g,v,A,N,C,b,y="Confirmed",T=t.getDetachedSpan(e),f=e.slice(),e=e.split("\n"),x=/^([A-Z]{3})-([A-Z]{3})$/.exec(e[2].trim());h=x[1],v=x[2];var S=/([A-Z]{2})([0-9]{4})/.exec(e[0].trim());o=S[1],p=S[2],i=/Airline.*\n.*\n(.*)\n/.exec(f)[1].split("<")[0].trim(),u=/Departing From.*\n.*\n(.*)\n/.exec(f)[1],g=/Arriving At.*\n.*\n(.*)\n/.exec(f)[1],A=/Reference #.*\n.*\n(.*)\n/.exec(f),A&&2===A.length&&(A=A[1]),l=/Seat #.*\n.*\n(.*)\n/.exec(f),l&&2===l.length&&(l=l[1]),c=/Cabin.*\n.*\n(.*)\n/.exec(f),c&&2===c.length&&(c=c[1]),s=T.nextDate(),d=T.nextDate().nextDate(),n.push({airlineName:i,airlineCode:o,flightNumber:p,departureDateTime:s,departureAirport:u,departureAirportCode:h,arrivalDateTime:d,arrivalAirport:g,arrivalAirportCode:v,ticketNumber:m,checkinUrl:b,reservationId:A,reservationStatus:y,totalPrice:N,priceCurrency:C,seatNumber:l,seatType:c,underPersonName:r.underName})}),n.forEach(function(e,r){ASSERT(e.departureDateTime,e.arrivalDateTime,e.departureAirportCode,e.arrivalAirportCode),i.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:e.airlineName,airlineCode:e.airlineCode,flightNumber:e.flightNumber,departureAirportFuzzy:e.departureAirport,departureAirportCode:e.departureAirportCode,departureTime:e.departureDateTime,arrivalAirportFuzzy:e.arrivalAirport,arrivalAirportCode:e.arrivalAirportCode,arrivalTime:e.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:e.underPersonName},checkinUrl:e.checkinUrl,reservationId:e.reservationId,reservationStatus:"http://schema.org/Reservation"+e.reservationStatus,totalPrice:e.totalPrice,priceCurrency:e.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:e.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:e.seatNumber,seatingType:e.seatType}},programMembershipUsed:{"@type":"http://schema.org/ProgramMembership",membershipNumber:e.membershipNumber,programName:e.programName}})}),i.length>=1?i:CONTINUE}}).call();
