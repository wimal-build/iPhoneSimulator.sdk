// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(t,e,n){var a=Scanner.fromMessage(t);a.setLocale(e);var r,i,o,s,c,p,g,h,m,v,u,f=[];r=a.getSpan().innerCapture(n.reservationIdRegExp,1).trim(),n.nameRegExp&&(i=a.getSpan().innerCapture(n.nameRegExp,1).trim()),o=a.getSpan().next(n.pricePrefix).nextTag("td1").tagContents(),o&&o.exists()&&(s=o.innerCapture(/([\d,.]+)/,1),c=o.innerCapture(/([^\d,.]+)/,1).trim()),u=a.getDetachedSpan(""+a.getSpan().next(n.ticketDetailsPrefix).withEnd(a.getSpan().next(n.ticketDetailsPrefix).next(n.ticketDetailsSuffix).getStart())),m=u.allInnerTags("tr1"),m.forEach(function(t){if(v=t.allInnerTags("td1"),6!==v.length)return CONTINUE;if(!/^\d+$/.test(v[0].tagContents().trim()))return CONTINUE;if(g=v[1].tagContents(),h=v[2].innerDate(),ASSERT(h)){var e={startDate:h,eventName:g,eventLocation:p};f.push(e)}});var S=[];return f.forEach(function(t){if(ASSERT(r)){var e={"@context":"http://schema.org","@type":"http://schema.org/EventReservation",name:i,totalPrice:s,priceCurrency:c,reservationStatus:"http://schema.org/Reservation"+(n.reservationStatus||"Confirmed"),reservationId:r,reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat"}},reservationFor:{"@type":"http://schema.org/Event",eventStatus:"http://schema.org/EventConfirmed",name:t.eventName,startDate:t.startDate,location:{"@type":"http://schema.org/Place",name:t.eventLocation}}};S.push(e)}}),S.length?S:void 0}}).call();
