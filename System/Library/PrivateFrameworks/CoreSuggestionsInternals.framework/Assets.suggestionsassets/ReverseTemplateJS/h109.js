// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,s,o,m,d,l,u,h,T,c,C,x,v,N,b,y=[],f={};for(s=a.getSpan().next(r.reservationId).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+</,r.reservationId),1),m=a.getSpan().next(r.ticketNr).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s+(.*)\s+</,r.ticketNr),1),p=a.getSpan().next(r.price).nextTag("th7").tagContents(),d=p.innerCapture(/([\d,.]+)/,1),l=p.innerCapture(/([^\d,.]+)/,1),u=a.getSpan().next(r.departure).parentTag("table5").allInnerTags("tr5"),h=1;u.length>h;h++)u[h].tagContents().innerRegExp(r.departure).exists()?(c=u[h].tagContents().innerRegExp(r.departure),T=c.previousAnyTag("th").tagContents()):(c=u[h],C={},x=c.nextTag("td6").tagContents().innerCapture(/($<airline>[^\d]+)\s+($<flightNumber>\d+)/),C.airlineName=x.$airline,C.flightNumber=x.$flightNumber,C.airlineCode=/delta/gi.test(C.airlineName)?"DL":null,C.seatingType=C.flightNumber.nextTag("td6").tagContents(),C.departureAirport=C.seatingType.nextTag("td6").tagContents(),C.departureTime=a.getDetachedSpan(""+T+" "+(""+C.departureAirport.nextTag("td6").tagContents()).replace("N"," pm")).innerDate(),C.arrivalAirport=C.departureAirport.nextTag("td6").nextTag("td6").tagContents(),g=(""+C.arrivalAirport.nextTag("td6").tagContents()).replace(/(\d)(N)/,"$1 pm"),g=/\*\*/.test(g)?g.replace("**","").replace(/\n/,""):T+" "+g,C.arrivalTime=a.getDetachedSpan(g).innerDate(),ASSERT(C.airlineName,C.flightNumber,C.departureAirport,C.departureTime,C.arrivalAirport,C.arrivalTime)&&y.push(C));for(v=a.getSpan().next(r.passengerInfo).nextTag("table6").allInnerTags("tr6"),h=0;v.length-1>h;h++)N=v[h],N.tagContents().innerRegExp(r.name).exists()?(n=N.tagContents().innerRegExp(r.name).nextTag("td7").tagContents(),b={name:n,seats:{}}):(i=N.nextTag("td6").tagContents().innerCapture(/(\d+)/,1),i.nextTag("td7").tagContents().inner(r.seat,1).exists()||(b.seats[i]=i.nextTag("td7").tagContents()),f[b.name]=b);var A=[];for(h=0;y.length>h;h++){C=y[h];for(var S=Object.keys(f),k=0;S.length>k;k++){N=f[S[k]];var F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:C.airlineName,airlineCode:C.airlineCode,flightNumber:C.flightNumber,departureAirportFuzzy:C.departureAirport,departureAirportCode:C.departureCode,departureTime:C.departureTime,arrivalAirportFuzzy:C.arrivalAirport,arrivalAirportCode:C.arrivalCode,arrivalTime:C.arrivalTime},underName:{"@type":"http://schema.org/Person",name:N.name},checkinUrl:o,reservationId:s,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:d,priceCurrency:l,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:m,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:N.seats[C.flightNumber],seatingType:C.seatingType}}};valid(N.membershipNumber,N.programName)&&(F.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:N.membershipNumber,programName:N.programName}),A.push(F)}}return A.length?A:void 0}}).call();