// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a,i,n,o,p,l,m,u,d,s,h=[],g={},v=Scanner.fromMessage(e);for(v.setLocale(r),n=v.getSpan().innerCapture(regExpFormatted(/\1\n\n(.*)/,t.reservationId),1),d=v.getSpan().allTransitInformation(),p=0;d.length>p;p++){u={};var c=d[p].previousDate();for(m=!1,l=0;2*d.length>l&&!m;l++)hasTime_(unSpanDate_(c))||(m=c),c=c.previousDate();a=d[p].nextDate(),u.departureCode=a.parentAnyTag("td").innerCapture(/\((.*?)[\)\s-]/,1),i=a.nextDate(),u.arrivalCode=i.parentAnyTag("td").innerCapture(/\((.*?)[\)\s-]/,1),s=d[p].innerCapture(/($<airlineCode>\D+)\s+($<flightNumber>\d+)/),u.airlineCode=s.$airlineCode,u.flightNumber=s.$flightNumber,u.departureTime=combineDateAndTime(m,a),u.arrivalTime=combineDateAndTime(m,i),ASSERT(u.departureTime,u.arrivalTime,u.airlineCode,u.flightNumber,u.departureCode,u.arrivalCode)&&h.push(u)}g=v.getSpan().allInnerCapture(/\[table4\]\s\[tr4\]\s\[td4\]([^\[\]:><\uff1a\/]{4,})\[\/td4\]\s\[td4\]\s{3}/,1),ASSERT(g.length>0);var C,b=[];for(p=0;h.length>p;p++){u=h[p];for(var l=0;g.length>l;l++){var T=(""+g[l]).trim();C={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:u.airlineCode,flightNumber:u.flightNumber,departureAirportFuzzy:u.departureAirport,departureAirportCode:u.departureCode,departureTime:u.departureTime,arrivalAirportFuzzy:u.arrivalAirport,arrivalAirportCode:u.arrivalCode,arrivalTime:u.arrivalTime},underName:{"@type":"http://schema.org/Person",name:T},checkinUrl:o,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:null,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:null,seatingType:null}},totalPrice:null,priceCurrency:null,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(T.membershipNumber)&&(C.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:T.membershipNumber,programName:"Frequent Flyer"}),b.push(C)}}return b.length?b:void 0}}).call();
