// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("alaskaair.com-cancellation-en",function(e){return/^Canceled Reservation: Your .*? Trip/.test(e.subject)},function(e){if(int(e.epoch)<1356998400)return CONTINUE;var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,i,n,p,o,s,m,u,c,d,l,g,h=[],v={};if(/^Canceled Reservation:/.test(e.subject)){var C=/\s($<name>.*)\s+-\s+($<ticketNumber>\d+)/;for(m=r.getSpan().nextText("TRAVELERS - TICKET NUMBERS").withEnd(r.getSpan().nextText("Confirmation Code").getStart());m.innerCapture(C);){i=m.innerCapture(C),n=i.$name;var N=i.$ticketNumber;valid(n,N)&&(v[""+n]={name:n,ticketNumber:N,seats:{},seatingType:{}}),m=m.withStart(i[0].getEnd())}t=r.getSpan().innerCapture(/Confirmation Code: (\w+)/,1);var b=concatRegExp(/($<currentDate>.*)\s+/,/($<airlineName>.*) #($<flightNumber>\d+)\s+/,/Depart: .* \(($<departureCode>[A-Z]{3})\) ($<departureTime>at .*)\s+/,/Arrive: .* \(($<arrivalCode>[A-Z]{3})\)/);m=r.getSpan().nextText("ITINERARY").withEnd(r.getSpan().nextText("FARE SUMMARY").getStart());var T=r.getSpan().innerCapture(/\bFARE SUMMARY \((\w+)\)\s+/,1);for(s=r.getSpan().innerCapture(/\bTotal: .*([\d,.]+)/,1);m.innerCapture(b);)i=m.innerCapture(b),p=i.$currentDate,u=i.$airlineName,o=i.$flightNumber,d=i.$departureCode,c=getFuzzyDate(i[0]),g=i.$arrivalCode,l=i.$currentDate,ASSERT(u,o,d,c,g,l)&&h.push({airlineName:u,flightNumber:o,totalPrice:s,priceCurrency:T,reservationId:t,reservationStatus:"Cancelled",departureCode:d,departureTime:c,arrivalCode:g,arrivalTime:l,passengers:v}),m=m.withStart(i[0].getEnd())}for(var S=[],f=0;h.length>f;f++)for(var y=h[f],R=Object.keys(y.passengers),A=0;R.length>A;A++){var $=y.passengers[R[A]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:y.airlineName,airlineCode:y.airlineCode,flightNumber:y.flightNumber,departureAirportFuzzy:y.departureAirport,departureAirportCode:y.departureCode,departureTime:y.departureTime,arrivalAirportFuzzy:y.arrivalAirport,arrivalAirportCode:y.arrivalCode,arrivalTime:y.arrivalTime},underName:{"@type":"http://schema.org/Person",name:$.name},checkinUrl:a,reservationStatus:"http://schema.org/Reservation"+(y.reservationStatus||"Confirmed"),reservationId:valid(y.reservationId)?y.reservationId:t,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:$.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:$.seats[y.flightNumber],seatingType:$.seatingType[y.flightNumber]}},totalPrice:$.totalPrice,priceCurrency:$.priceCurrency},not($.membershipNumber)||(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:$.membershipNumber,programName:$.programName}),S.push(schema)}return S.length?S:void 0},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/112/160/161","SG3586b9dd")]);