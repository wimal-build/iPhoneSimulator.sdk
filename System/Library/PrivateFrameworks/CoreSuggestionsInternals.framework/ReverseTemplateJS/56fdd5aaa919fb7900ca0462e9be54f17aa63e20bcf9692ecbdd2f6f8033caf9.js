// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("delta.com-itinerary-change-en",function(e){return/^Your Delta itinerary has changed/.test(e.subject)},function(e){if(/^Your Delta itinerary has changed/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,i,n,p,s,m,o,l,h,u,g,d,c,b,v,N=[],f={};for(n=r.getSpan().innerCapture(/\bDear (.*),/,1),n.exists()&&(f[n]={name:n,seats:{},seatingType:{}}),a=r.getSpan().innerCapture(/\bDelta confirmation # (.*)\s/,1),m=r.getSpan().nextText("Updated Itinerary");m.nextText("Flight:").exists();)m=m.nextText("Flight:"),p=m.previousDate(),s=m.parentTag("table2").allInnerTagsFiltered("td2"),10===s.length&&(l=s[1].innerCapture(/($<airlineName>.*)\s+($<flightNumber>\d+)/),h=l?l.$airlineName:null,o=l?l.$flightNumber:null,u=s[3].innerCapture(/($<time>\d{1,2}:\d{2} (?:am|pm))\s+from\s+($<airport>.*)/),u&&(g=r.getDetachedSpan(""+p+" "+u.$time).innerDate(),d=u.$airport),c=s[5].innerCapture(/($<time>\d{1,2}:\d{2} (?:am|pm))\s+at\s+($<airport>.*)/),c&&(b=r.getDetachedSpan(""+p+" "+c.$time).innerDate(),v=c.$airport),valid(o,f[n])&&(f[n].seats[o]=s[7]),ASSERT(h,o,d,g,v,b)&&N.push({airlineName:h,flightNumber:o,departureAirport:d,departureTime:g,arrivalAirport:v,arrivalTime:b,passengers:f}));for(var y=[],T=0;N.length>T;T++)for(var C=N[T],S=Object.keys(C.passengers),$=0;S.length>$;$++){var x=C.passengers[S[$]],A={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:C.airlineName,airlineCode:C.airlineCode,flightNumber:C.flightNumber,departureAirportFuzzy:C.departureAirport,departureAirportCode:C.departureCode,departureTime:C.departureTime,arrivalAirportFuzzy:C.arrivalAirport,arrivalAirportCode:C.arrivalCode,arrivalTime:C.arrivalTime},underName:{"@type":"http://schema.org/Person",name:x.name},checkinUrl:i,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:x.totalPrice,priceCurrency:x.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:t,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:x.seats[C.flightNumber],seatingType:x.seatingType[C.flightNumber]}}};valid(x.membershipNumber,x.programName)&&(A.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:x.membershipNumber,programName:x.programName}),y.push(A)}if(y.length)return y}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/112/197/200","SGb68f53f6")]);