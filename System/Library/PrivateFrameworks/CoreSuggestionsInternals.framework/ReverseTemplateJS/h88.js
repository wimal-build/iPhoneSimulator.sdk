// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,p,s,g,l,o,m,u,h,d,c,f,T,b=[],v={},C=loadHelper("united.com-common.js");n=a.getSpan().nextText(t.confirmationNumber).nextTag("td4").nextTag("td4").tagContents(),m=a.getSpan().nextText(t.seatAssignments).parentTag("td3"),s=m.allInnerCapture(regExpFormatted(/\1/,t.dateOfBirth)).filter(function(e){return e.length>0});for(var y={},x=0;s.length>x;x++)p=a.getSpan().innerCapture(regExpFormatted(/\]\s+(.*)\s+\1/,""+s[x][0].parentTag("table4")),1),m=p.nextTag("table4").withEnd(p.nextTag("table4").nextTag("table4").getEnd()),y[""+p]=m;if(s=Object.keys(y),!s.length)return CONTINUE;for(var x=0;s.length>x;x++){p=s[x],v[p]={name:p,seats:{},seatingType:{}},m=y[p].allInnerTags("table5");for(var F,N,E=0;m.length>E;E++)F=m[E].innerTag("th5").tagContents(),N=m[E].innerTag("td5").tagContents(),F.innerCapture(regExpFormatted(/^\1/,t.knownTravelerNumber))?v[p].ticketNumber=N:F.innerCapture(regExpFormatted(/^\1/,t.frequentFlyer))?(v[p].programName=t.frequentFlyer,v[p].membershipNumber=N):F.innerCapture(regExpFormatted(/^\1/,t.seatAssignments))&&(v[p].seatMap=C.getSeatMap(N))}l=a.getSpan().nextText(t.flightDetails).nextTag("table4").allInnerTags("table5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return e.length>0});for(var k=0;l.length>k;k++){g=l[k];for(var A=0;g.length>A;A++)if(m=g[A],m.innerCapture(regExpFormatted(/^\1/,t.depart)))d=getFuzzyDate(m),c=m.innerCapture(/\(([A-Z]{3})/,1);else if(m.innerCapture(regExpFormatted(/^\1/,t.arrive)))f=getFuzzyDate(m),T=m.innerCapture(/\(([A-Z]{3})/,1);else if(m.innerCapture(regExpFormatted(/^\1/,t.flight))){if(u=m.innerCapture(regExpFormatted(/^\1\s*($<code>\w{2})($<flightNumber>\d+)/,t.flight)),h=u?u.$code:null,o=u?u.$flightNumber:null,seatingType=m.innerCapture(regExpFormatted(/\1\s*(.*)\s+/,t.fareClass),1),valid(o)){s=Object.keys(v);for(var x=0;s.length>x;x++)if(valid(seatingType)&&(v[s[x]].seatingType[""+o]=seatingType.trim()),valid(c,T)){var S=""+c+" - "+T;v[s[x]].seats[""+o]=v[s[x]].seatMap[S]}}ASSERT(d,c,f,T,h,o)&&b.push({airlineCode:h,flightNumber:o,departureTime:d,departureCode:c,arrivalTime:f,arrivalCode:T,passengers:v}),d=c=f=T=u=h=o=seatingType=null}}for(var z=[],k=0;b.length>k;k++)for(var I=b[k],M=Object.keys(I.passengers),O=0;M.length>O;O++){var j=I.passengers[M[O]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:i,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:j.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[I.flightNumber],seatingType:j.seatingType[I.flightNumber]}},totalPrice:j.price,priceCurrency:j.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},j.membershipNumber&&(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:"Frequent Flyer"}),z.push(schema)}return z.length?z:void 0}}).call();