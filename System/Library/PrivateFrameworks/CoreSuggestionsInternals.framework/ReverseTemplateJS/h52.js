// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){function a(){y||ASSERT(s,g,l,c,h,d)&&(u=""+s=="American"?"AA":null,C.push({airlineName:s,airlineCode:u,flightNumber:g,departureAirport:l,departureTime:c,arrivalAirport:h,arrivalTime:d,passengers:N}),s=u=g=l=c=h=d=v=null,N={}),y=!1}if(!e||!r||!t)return CONTINUE;var i=Scanner.fromMessage(e);i.setLocale(r);for(var n,p,m,o,s,u,g,l,c,h,d,v,b,C=[],N={},n=i.getSpan().nextText(t.reservationIdPrefix).parentTag("td4").tagContents().innerCapture(regExpFormatted(/\b\1: (.*)/,t.reservationIdPrefix),1),T=i.getSpan().nextTag("table5").allInnerTagsFiltered("td5"),y=!0,f=0;T.length>f;f++)T[f].innerCapture(t.dateRegex)&&T[f+1]?(a(),o=T[f+1].innerDate()):T[f].innerCapture(t.flightRegex)&&T[f+2]?(s=T[f+1],g=T[f+2]):T[f].innerCapture(t.departureRegex)&&T[f+2]?(l=T[f+1],c=combineDateAndTime(o,T[f+2].innerDate())):T[f].innerCapture(t.arrivalRegex)&&T[f+2]?(h=T[f+1],d=combineDateAndTime(o,T[f+2])):T[f].innerCapture(t.seatRegex)&&T[f+1]&&(m=""+T[f-1],b=T[f+3]&&T[f+3].innerCapture(/^FF#:\s+($<number>\w+)/,1),N[m]={name:m,seat:T[f].innerCapture(concatRegExp(t.seatRegex,/\s+(.*)/),1),seatingType:T[f+1],programName:"Frequent Flyer",membershipNumber:b});a();for(var x=[],f=0;C.length>f;f++)for(var A=C[f],F=Object.keys(A.passengers),R=0;F.length>R;R++){var S=A.passengers[F[R]],k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:A.airlineName,airlineCode:A.airlineCode,flightNumber:A.flightNumber,departureAirportFuzzy:A.departureAirport,departureAirportCode:A.departureCode,departureTime:A.departureTime,arrivalAirportFuzzy:A.arrivalAirport,arrivalAirportCode:A.arrivalCode,arrivalTime:A.arrivalTime},underName:{"@type":"http://schema.org/Person",name:S.name},checkinUrl:p,reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:S.totalPrice,priceCurrency:S.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:S.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:S.seatingType,seatNumber:S.seat}}};valid(S.membershipNumber)&&(k.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:S.membershipNumber,programName:S.programName}),x.push(k)}return x.length?x:void 0}}).call();