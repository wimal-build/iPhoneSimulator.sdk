// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o,p,s,l,m,g,d,c,h,u,v,T,x,f,C,y,b,A,S,N,k,F,P,R,I,E,D,U,$=[],z=[],L={},O=[],M=[];if(l=a.getSpan().innerCapture(regExpFormatted(/\b\1 (\d+)/,r.reservationId),1),s=a.getSpan().nextText(r.totalPrice).nextTag("td8").tagContents().innerCapture(/([\d,.]+)/,1),a.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).exists()){i=a.getSpan().innerCapture(regExpFormatted(/\1 (.*)\s/,r.flight.names),1),i=i.split(", ");for(var j=0,Z=i.length;Z>j;j++)L[""+i[j]]={name:i[j],seats:{},seatingType:{},totalPrice:s};if(Object.keys(L).length){p=a.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).previousAnyTag("table"),o=p.getTagNumber(),p=p.nextTag("table"+o),p.innerText(r.taxes).exists()&&(p=p.nextTag("table"+o)),p=p.allInnerTags("tr"+o).map(function(e){return e.allInnerTagsFiltered("td"+o)}).filter(function(e){return e.length>=4});for(var j=0,Z=p.length;Z>j;j++)d=p[j],c=d[0].innerCapture(regExpFormatted(/($<departureAirport>.*) \(($<departureCode>[A-Z]{3})\) \1 ($<arrivalAirport>.*) \(($<arrivalCode>[A-Z]{3})\)/,r.flight.to)),c&&(x=c.$departureAirport,f=c.$departureCode,y=c.$arrivalAirport,b=c.$arrivalCode),g=d[1].innerDate(),m=a.getDateDD(d[2].innerDate()),m.endIso8601&&(T=combineDateAndTime(g,m.iso8601),C=combineDateAndTime(g,m.endIso8601)),h=d[3].innerCapture(/($<name>.*) ($<flightNumber>\w+)/),u=h?h.$name:null,v=h?h.$flightNumber:null,ASSERT(u,v,T,f,C,b)&&z.push({airlineName:u,flightNumber:v,reservationId:l,departureAirport:x,departureCode:f,departureTime:T,arrivalAirport:y,arrivalCode:b,arrivalTime:C,passengers:L})}}if(a.getSpan().nextText(r.hotel.name).exists()){n=a.getSpan().innerCapture(regExpFormatted(/\b\1 (.*) -/,r.hotel.name),1),not(s)&&(s=a.getSpan().nextText(r.hotel.totalPrice).nextTag("td8").tagContents().innerCapture(/([\d,.]+)/,1)),p=n.nextAnyTag("table"),o=p.getTagNumber(),p.innerText(r.taxes).exists()&&(p=p.nextTag("table"+o)),p=p.allInnerTagsFiltered("td"+o),N=p[0],F=s.nextTag("table7").innerAddress(),k=s.nextTag("table7").innerPhoneNumber();for(var w,B="",q=1;p.length>q;q++)if(p[q].innerCapture(regExpFormatted(/^\1/,r.hotel.telephone))){for(var G=q-1;G>0;G--)B=p[G]+"\n"+B;(not(F)||B.length>F.getLength())&&(F=B),w=p[q].innerCapture(regExpFormatted(/^\1 (.*)/,r.hotel.telephone),1),valid(w)&&(not(k)||valid(k)&&w.getLength()>k.getLength())&&(k=w)}else p[q].innerCapture(regExpFormatted(/^\1/,r.hotel.checkin))?A=p[q].innerDate():p[q].innerCapture(regExpFormatted(/^\1/,r.hotel.checkout))&&(S=p[q].innerDate());ASSERT(F,A,S)&&O.push({name:n,reservationId:l,totalPrice:s,hotelName:N,hotelAddress:F,hotelPhone:k,checkInDateTime:A,checkOutDateTime:S})}a.getSpan().nextText(r.car.name).exists()&&(n=a.getSpan().nextText(r.car.name).parentAnyTag("td").innerCapture(regExpFormatted(/\b\1 (.*)\s/,r.car.name),1),s=a.getSpan().nextText(r.car.totalPrice).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),R=a.getSpan().nextText(r.car.provider).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1 (.*?),/,r.car.provider),1),P=a.getSpan().nextText(r.car.totalPrice).nextTag("table7").allInnerTagsFiltered("td7")[0],U=getFuzzyDate(a.getSpan().nextText(r.car.pickup).parentAnyTag("td")),D=a.getSpan().nextText(r.car.pickup).parentAnyTag("td").tagContents().innerCapture(/(.*)$/,1),E=getFuzzyDate(a.getSpan().nextText(r.car.dropoff).parentAnyTag("td")),I=a.getSpan().nextText(r.car.dropoff).parentAnyTag("td").tagContents().innerCapture(/(.*)$/,1),ASSERT(n,U,D,P,R)&&M.push({name:n,reservationId:l,totalPrice:s,pickupTime:U,pickupAddress:D,dropoffTime:E,dropoffAddress:I,brand:P,provider:R}));for(var H,J,j=0;z.length>j;j++){J=z[j];for(var K=Object.keys(J.passengers),Q=0;K.length>Q;Q++){var V=J.passengers[K[Q]];H={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:J.airlineName,airlineCode:J.airlineCode,flightNumber:J.flightNumber,departureAirportFuzzy:J.departureAirport,departureAirportCode:J.departureCode,departureTime:J.departureTime,arrivalAirportFuzzy:J.arrivalAirport,arrivalAirportCode:J.arrivalCode,arrivalTime:J.arrivalTime},underName:{"@type":"http://schema.org/Person",name:V.name},checkinUrl:J.checkinUrl,reservationId:J.reservationId,reservationStatus:"http://schema.org/Reservation"+(J.reservationStatus||"Confirmed"),totalPrice:V.totalPrice,priceCurrency:V.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:V.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:V.seats[J.flightNumber],seatingType:V.seatingType[J.flightNumber]}}},valid(V.membershipNumber,V.programName)&&(H.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:V.membershipNumber,programName:V.programName}),$.push(H)}}for(var W,j=0;M.length>j;j++)W=M[j],H={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:W.totalPrice,priceCurrency:W.priceCurrency,reservationId:W.reservationId,reservationStatus:"http://schema.org/Reservation"+(W.reservationStatus||"Confirmed"),checkinUrl:W.checkinUrl,modifyReservationUrl:W.modifyReservationUrl,cancelReservationUrl:W.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:W.name,email:W.email},provider:{"@type":"http://schema.org/Organization",name:W.provider},pickupTime:W.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:W.pickupName,telephone:W.pickupTelephone,address:W.pickupAddress},dropoffTime:W.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:W.dropoffName,telephone:W.dropoffTelephone,address:W.dropoffAddress}},W.brand&&(H.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:W.brand},license:W.license,color:W.color}),$.push(H);for(var X,j=0;O.length>j;j++)X=O[j],H={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:X.name,email:X.email},totalPrice:X.totalPrice,priceCurrency:X.priceCurrency,checkinTime:X.checkInDateTime,checkoutTime:X.checkOutDateTime,modifyReservationUrl:X.modifyReservationUrl,cancelReservationUrl:X.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(X.reservationStatus||"Confirmed"),reservationId:X.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:X.hotelName,url:X.hotelUrl,telephone:X.hotelPhone,address:X.hotelAddress}},$.push(H);return $.length?$:void 0}}).call();