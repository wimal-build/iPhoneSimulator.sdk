// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline.com-itinerary-2013-2014-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){if(/^Your priceline itinerary for/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,g,l,m,d,c,h,u,x,T,C,f,v,S,b,y,N,k,R,A,I,P,D,U,F,$,L,E,O,z,j,w,G,H,M,Z,Y=[],B=[],_={},q=[],J=[];if(t.getSpan().nextText("Flight Confirmation").exists()){o=t.getSpan().nextText("Total Charges").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1);var K=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1);if(a=t.getSpan().nextText("Passenger Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),a.length)for(var Q=0,V=a.length;V>Q;Q+=3)n=a[Q][1],not(n)||(_[""+n]={name:""+n,totalPrice:s,currency:K,seats:{},seatingType:{}});if(c=t.getSpan().nextText("Flight Details").parentTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3}),c.length)for(var W,Q=0;W=c[Q];Q++)if(""+W[0]=="Departing")i=W[0].withStart(W[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),f=i?i.$departureCode:null,b=i?i.$arrivalCode:null,C=W[1],T=W[2].innerDate();else if(""+W[0]=="Arriving")S=W[1],v=W[2].innerDate();else if(""+W[0]=="Flight / Class"){if(u=W[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),x=u?u.$name:null,h=u?u.$flightNumber:null,d=W[2],g=W[3]&&W[3].innerCapture(/Conf Number: (.*)/,1),valid(h,d)){a=Object.keys(_);for(var n,X=0;n=a[X];X++)_[n].seatingType[""+h]=d}ASSERT(x,h,C,T,f,S,v,b)&&(B.push({airlineName:x,flightNumber:h,departureAirport:C,departureCode:f,departureTime:T,arrivalAirport:S,arrivalTime:v,arrivalCode:b,reservationId:g,passengers:_}),u=x=h=C=T=f=S=v=b=g=null)}}if((t.getSpan().nextText("Hotel Reservation Confirmation").exists()||t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists())&&(t.getSpan().nextText("Hotel Reservation Confirmation").exists()?(n=t.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),g=t.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=t.getSpan().nextText("Hotel Reservation Confirmation"),A=i.nextTag("td9").tagContents(),k=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),I=k.innerPhoneNumber(),P=k.tagContents(),I.exists()&&(P=P.withEnd(I.getStart()).trim()),k.innerAddress().getLength()>=P.getLength()&&(P=k.innerAddress()),y=i.nextText("Check-In").nextTag("td11").innerDate(),N=i.nextText("Check-Out").nextTag("td11").innerDate(),s=t.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&(n=t.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),g=t.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),A=t.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),k=A.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),P=k?k.$address:null,I=k?k.$phone:null,y=t.getSpan().nextText("Check-In").nextDate(),N=t.getSpan().nextText("Check-Out").nextDate()),ASSERT(y,N,P)&&q.push({name:n,reservationId:g,totalPrice:s,priceCurrency:p,checkInDateTime:y,checkOutDateTime:N,hotelName:A,hotelUrl:R,hotelPhone:I,hotelAddress:P})),t.getSpan().nextText("Rental Car Confirmation").exists()){if(w=t.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),w.length>=3&&(Z=w[0].innerDate(),G=w[1].tagContents(),H=t.getDetachedSpan(w.slice(2).join(" ")),H.innerAddress().getLength()>=H.getLength()&&(H=H.innerAddress())),L=t.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(j=L[0].innerDate(),E=L[1].tagContents(),O=t.getDetachedSpan(L.slice(2).join(" ")),O.innerAddress().getLength()>=O.getLength()&&(O=O.innerAddress())),n=t.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),g=t.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),D=t.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),U=t.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),g.exists()&&($=t.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+g),1),$.exists())){var et=t.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();F=et.innerCapture(regExpFormatted(/\1 (.*)$/,""+$),1),F.exists()||(F=et.withStart(et.next("\n").getEnd()))}s=t.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(Z,$,g,OR(H,G))&&J.push({name:n,brand:F,pickupTime:Z,pickupName:G,pickupAddress:H,pickupTelephone:M,dropoffTime:j,dropoffName:E,dropoffAddress:O,dropoffTelephone:z,provider:$,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:D,cancelReservationUrl:U})}for(var Q=0;B.length>Q;Q++)for(var tt=B[Q],rt=Object.keys(tt.passengers),nt=0;rt.length>nt;nt++){var at=tt.passengers[rt[nt]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:tt.airlineName,flightNumber:tt.flightNumber,departureAirportFuzzy:tt.departureAirport,departureAirportCode:tt.departureCode,departureTime:tt.departureTime,arrivalAirportFuzzy:tt.arrivalAirport,arrivalAirportCode:tt.arrivalCode,arrivalTime:tt.arrivalTime},underName:{"@type":"http://schema.org/Person",name:at.name},checkinUrl:m,reservationId:tt.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:at.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:at.seats[tt.flightNumber],seatingType:at.seatingType[tt.flightNumber]}},totalPrice:at.totalPrice,priceCurrency:at.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(at.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:at.membershipNumber,programName:at.programName}),Y.push(r)}for(var it,Q=0;J.length>Q;Q++)it=J[Q],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:it.totalPrice,priceCurrency:it.priceCurrency,reservationId:it.reservationId,reservationStatus:"http://schema.org/Reservation"+(it.reservationStatus||"Confirmed"),checkinUrl:it.checkinUrl,modifyReservationUrl:it.modifyReservationUrl,cancelReservationUrl:it.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:it.name,email:it.email},provider:{"@type":"http://schema.org/Organization",name:it.provider},pickupTime:it.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:it.pickupName,telephone:it.pickupTelephone,address:it.pickupAddress},dropoffTime:it.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:it.dropoffName,telephone:it.dropoffTelephone,address:it.dropoffAddress}},it.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:it.brand},license:it.license,color:it.color}),Y.push(r);for(var k,Q=0;q.length>Q;Q++)k=q[Q],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:k.name,email:k.email},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency,checkinTime:k.checkInDateTime,checkoutTime:k.checkOutDateTime,modifyReservationUrl:k.modifyReservationUrl,cancelReservationUrl:k.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(k.reservationStatus||"Confirmed"),reservationId:k.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:k.hotelName,url:k.hotelUrl,telephone:k.hotelPhone,address:k.hotelAddress}},Y.push(r);if(Y.length)return Y}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/611/614","SGe9f7c8a6")]);