// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){function a(e){if(e){g=i.getSpan().nextRegExp(regExpFormatted(/\1/,e)).parentAnyTag("td");var r=g.getTagNumber()-2;g=g.parentTag("table"+r).allInnerTags("tr"+r),4==g.length&&(l=g[2].allInnerTagsFiltered("td"+r),5==l.length&&(u=l[0].innerCapture(/^($<departureAirport>.*?) - ($<arrivalAirport>.*?)$/),v=u?u.$departureAirport:null,T=u?u.$arrivalAirport:null,m=l[1].innerDate(),d=l[2].innerCapture(/($<code>[A-Z]+)($<flightNumber>\d+)/),h=d?d.$code:null,s=d?d.$flightNumber:null,c=combineDateAndTime(m,l[3].innerDate()),b=combineDateAndTime(m,l[4].innerDate()),ASSERT(h,s,c,v,b,T)&&N.push({airlineCode:h,flightNumber:s,departureAirport:v,departureTime:c,arrivalAirport:T,arrivalTime:b,passengers:A})))}}var i=Scanner.fromMessage(e);i.setLocale(r);var n,p,o,m,l,g,s,u,d,h,c,v,b,T,N=[],A={};p=i.getSpan().nextText(t.reservationId).nextTag("td9").tagContents(),A[e.to]={name:e.to,seats:{},seatingType:{}},a(t.goingOut),a(t.comingBack);for(var y=[],f=0;N.length>f;f++)for(var C=N[f],$=Object.keys(C.passengers),F=0;$.length>F;F++){var S=C.passengers[$[F]],k={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:C.airlineName,airlineCode:C.airlineCode,flightNumber:C.flightNumber,departureAirportFuzzy:C.departureAirport,departureAirportCode:C.departureCode,departureTime:C.departureTime,arrivalAirportFuzzy:C.arrivalAirport,arrivalAirportCode:C.arrivalCode,arrivalTime:C.arrivalTime},underName:{"@type":"http://schema.org/Person",name:S.name},checkinUrl:o,reservationId:p,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:S.totalPrice,priceCurrency:S.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:S.seats[""+C.airlineCode+(""+C.flightNumber)],seatingType:S.seatingType[C.flightNumber]}}};valid(S.membershipNumber,S.programName)&&(k.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:S.membershipNumber,programName:S.programName}),y.push(k)}return y.length?y:void 0}}).call();