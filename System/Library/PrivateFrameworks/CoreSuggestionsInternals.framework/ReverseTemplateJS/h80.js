// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){function a(e){var r;if("ja_JP"===t){if(r=e.tagContents().innerCapture(/($<day>\d{1,2}) ($<month>\d{1,2}) ($<year>\d{2})/),valid(r))return n.getDetachedSpan(""+r.$month+"/"+r.$day+"/20"+r.$year).innerDate()}else if("zh_Hans_CN"===t&&(r=e.tagContents().innerCapture(/($<day>\d{1,2}) ($<month>.{2,3}) ($<year>\d{2})/),valid(r)))return n.getDetachedSpan(r.$year+"\u5e74"+r.$month+(""+r.$day)+"\u65e5").innerDate()}var n=Scanner.fromMessage(e);n.setLocale(t);var i,p,o,l,m,g,s,d,u,h,T,c,v,x,b,N,f,y,C,S,P,A,$,D,v,k,z,_,F,R,b,U,j,I,M=[],E=[],L={};i=n.getSpan().nextText(r.confirmationCode).parentTag("table4").nextTag("table5").tagContents(),l=n.getSpan().nextText(r.passenger).parentTag("table4").nextTag("table5").nextTag("table5").allInnerTags("td5"),h=n.getSpan().nextText(r.totalPrice).nextTag("td5").nextTag("td5").tagContents().innerCapture(/($<currency>\w+)\s($<totalPrice>.+)/),d=h?h.$totalPrice:null,u=h?h.$currency:null;for(var H=0;l.length>H;H+=3)o=l[H+1].tagContents().innerCapture(/(.+)\(/,1).trim(),f=""+l[H+2].nextText(r.ticketNumber).nextTag("td7").tagContents(),L[o]={name:o,programName:C,membershipNumber:y,ticketNumber:f,seats:{},seatingType:{},totalPrice:d,priceCurrency:u};g=n.getSpan().nextRegExp(r.flightSummary).nextTag("table4").allInnerTags("table6").filter(function(e){return!r.totalTravelTime.test(e)});for(var J=n.getSpan().nextRegExp(r.flightSummary).nextTag("table4").allInnerTags("td5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return r.flightNumber.test(e)||r.train.test(e)}),O=[],K=0;g.length>K;K++)O.push([g[K],J[K]]);for(var K=0;O.length>K;K++)m=O[K][0].nextTag("td6").tagContents().innerDate(),!not(m)||"ja_JP"!==t&&"zh_Hans_CN"!==t||(m=a(O[K][0].nextTag("td6"))),v=O[K][0].nextTag("td6").nextTag("td6").tagContents().innerDate(),v=combineDateAndTime(m,v),x=O[K][0].nextTag("td6").nextTag("td6").tagContents().innerCapture(/\d\d:\d\d\s(.+)/,1),!not(m)||"ja_JP"!==t&&"zh_Hans_CN"!==t||(m=a(O[K][0].nextTag("tr6").nextTag("tr6").nextTag("td6"))),b=O[K][0].nextTag("tr6").nextTag("tr6").nextTag("td6").nextTag("td6").tagContents().innerDate(),b=combineDateAndTime(m,b),N=O[K][0].nextTag("tr6").nextTag("tr6").nextTag("td6").nextTag("td6").tagContents().innerCapture(/\d\d:\d\d\s(.+)/,1),null!==O[K][1]&&(r.train.test(O[K][1])?(c=s=T="",U="KLM",P=x,z=N,ASSERT(v,P,b,z,U)&&E.push({departurePlatform:S,departureName:P,departureTelephone:A,departureUrl:$,departureAddress:D,departureTime:v,arrivalPlatform:k,arrivalName:z,arrivalTelephone:_,arrivalUrl:F,arrivalAddress:R,arrivalTime:b,provider:U,trainName:j,trainNumber:I,passengers:L})):(c=n.getDetachedSpan(""+O[K][1]).innerCapture(r.flightNumber,1),s=n.getDetachedSpan(""+O[K][1]).innerCapture(r.flightNumber,2),T=n.getDetachedSpan(""+O[K][1]).innerCapture(r.operatedBy,1),ASSERT(c,s,v,x,b,N)&&(T.getLength()||(T="KLM"),M.push({airlineCode:c,airlineName:T,flightNumber:s,departureAirport:x,departureTime:v,arrivalAirport:N,arrivalTime:b,passengers:L}))));for(var w=[],K=0;M.length>K;K++)for(var B=M[K],q=Object.keys(B.passengers),G=0;q.length>G;G++){var Q=B.passengers[q[G]],V={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:B.airlineName,airlineCode:B.airlineCode,flightNumber:B.flightNumber,departureAirportFuzzy:B.departureAirport,departureAirportCode:B.departureCode,departureTime:B.departureTime,arrivalAirportFuzzy:B.arrivalAirport,arrivalAirportCode:B.arrivalCode,arrivalTime:B.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Q.name,email:Q.email},checkinUrl:p,reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:Q.totalPrice,priceCurrency:Q.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Q.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Q.seats[B.flightNumber],seatingType:Q.seatingType[B.flightNumber]}}};valid(Q.membershipNumber,Q.programName)&&(V.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Q.membershipNumber,programName:Q.programName}),w.push(V)}for(var K=0;E.length>K;K++)for(var B=E[K],q=Object.keys(B.passengers),G=0;q.length>G;G++){var Q=B.passengers[q[G]];w.push({"@context":"http://schema.org","@type":"http://schema.org/TrainReservation",reservationFor:{"@type":"http://schema.org/TrainTrip",departurePlatform:B.departurePlatform,departureStation:{"@type":"http://schema.org/TrainStation",name:B.departureName,telephone:B.departureTelephone,url:B.departureUrl,address:B.departureAddress},departureTime:B.departureTime,arrivalPlatform:B.arrivalPlatform,arrivalStation:{"@type":"http://schema.org/TrainStation",name:B.arrivalName,telephone:B.arrivalTelephone,url:B.arrivalUrl,address:B.arrivalAddress},arrivalTime:B.arrivalTime,provider:{"@type":"http://schema.org/Organization",name:B.provider},trainName:B.trainName,trainNumber:B.trainNumber}})}return w.length?w:void 0}}).call();