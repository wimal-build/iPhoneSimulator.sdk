// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,n){var a=Scanner.fromMessage(e);a.setLocale(t);for(var r,s,o,g,l,i,c,d,p,m,h,u,T,x,v,S,D,$,k=0;n.confirmations.length>k;k++)if(n.confirmations[k].test(e.subject)){D=a.getSpan().innerCapture(regExpFormatted(/\1/,n.details)),s=D?D.$name:null;break}return n.reminder.test(e.subject)&&(D=a.getSpan().nextTag("table2").nextTag("td2").nextTag("td2").tagContents().innerCapture(/^($<eventName>.*?) <($<eventUrl>.*)>/)),m=D?D.$eventName:null,h=D?D.$eventUrl:null,i=a.getSpan().nextText(n.ticketToken).nextLink(),o=a.getSpan().nextText(n.orderSummary).nextText(n.total).nextTag("td3").tagContents().innerCapture(/([\d,.]+)/,1),D=a.getSpan().nextText(n.aboutThisEvent).nextAnyTag("table"),$=D.getTagNumber(),D=D.allInnerTagsFiltered("td"+$),D.length&&(D[0].allInnerDates().length>0&&(u=D[0].innerDate(),a.getDateDD(u).endIso8601?T=a.getDateDD(u).endIso8601:D[0].allInnerDates().length>1&&(T=D[0].lastInnerDate())),S=D[1].innerAddress(),D=D[1].innerCapture(/^($<place>.*)\n($<address>[\s\S]+)/),D&&(v=D.$place,S&&D.$address&&D.$address.getLength()>S.getLength()&&(S=D.$address))),ASSERT(u,m)?[{"@context":"http://schema.org","@type":"http://schema.org/EventReservation",name:s,totalPrice:o,priceCurrency:g,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l,ticketToken:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:c,seatRow:d,seatSection:p}},reservationFor:{"@type":"http://schema.org/Event",eventStatus:"http://schema.org/Event"+(r||"Confirmed"),name:m,url:h,startDate:u,endDate:T,location:{"@type":"http://schema.org/Place",name:v,telephone:x,address:S}}}]:void 0}}).call();