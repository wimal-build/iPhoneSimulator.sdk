// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,n){var a=Scanner.fromMessage(e);a.setLocale(t);var r,g,i,o,p,s,x,c,l,m,u,C,d,T,h,S,R,E;if(!n.emailTitelConfirmation.test(e.subject)&&!n.emailTitelCancelConfirmation.test(e.subject))return CONTINUE;p=a.getSpan().nextRegExp(n.reservationId).tagContents().innerCapture(n.reservationId,1),r=a.getSpan().nextRegExp(n.guestName).tagContents().innerCapture(n.guestName,1).trim(),0===(""+r).length&&(r=a.getSpan().nextRegExp(n.guestName).tagContents().innerCapture(n.guestName,2).trim()),c=a.getSpan().nextRegExp(n.checkInDate).nextAnyTag("td").tagContents(),x=a.getSpan().nextRegExp(n.checkInTime).nextAnyTag("td").tagContents(),u=a.getSpan().nextRegExp(n.checkOutDate).nextAnyTag("td").tagContents(),m=a.getSpan().nextRegExp(n.checkOutTime).nextAnyTag("td").tagContents(),l=getFuzzyDate(a.getDetachedSpan(c+" "+x).innerDate()),C=getFuzzyDate(a.getDetachedSpan(u+" "+m).innerDate()),R=a.getSpan().nextRegExp(n.modifyUrl).nextLink(),E=a.getSpan().nextRegExp(n.cancelUrl).nextLink();var f=a.getSpan().nextRegExp(n.price).nextAnyTag("td").tagContents();if(i=f.innerCapture(/([\d,.]+)/,1),o=f.innerCapture(/([^\d,.]+)/,1).trim(),T=a.getSpan().nextRegExp(n.hotelInfo).parentTag("table2").nextTag("table3").nextTag("table3").tagContents(),S=a.getSpan().nextRegExp(n.hotelInfo).parentTag("table2").nextTag("table3").nextTag("table3").nextTag("table3").tagContents(),h=a.getSpan().nextRegExp(n.hotelInfo).nextTag("td4").nextPhoneNumber(),n.emailTitelConfirmation.test(e.subject)){if(!ASSERT(r,p,l,C,S))return CONTINUE;s="Confirmed"}if(n.emailTitelCancelConfirmation.test(e.subject)){p=a.getSpan().nextRegExp(n.cancelReservationId).nextAnyTag("td").tagContents();var f=a.getSpan().nextRegExp(n.cancelPrice).nextTag("td7").nextTag("td7").tagContents();if(i=f.innerCapture(/([\d,.]+)/,1),o=f.innerCapture(/([^\d,.]+)/,1).trim(),!ASSERT(r,p,l,C,S))return CONTINUE;s="Cancelled"}return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:g},totalPrice:i,priceCurrency:o,checkinTime:l,checkoutTime:C,modifyReservationUrl:R,cancelReservationUrl:E,reservationStatus:"http://schema.org/Reservation"+(s||"Confirmed"),reservationId:p,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:T,url:d,telephone:h,address:S}}]}}).call();