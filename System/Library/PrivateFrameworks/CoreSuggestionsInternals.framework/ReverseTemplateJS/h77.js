// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var i,n,o,p,g,u,d=[],l=[];for(n=a.getSpan().nextText(r.confirmation).nextRegExp(regExpFormatted(/ ([^\s]*)\n/)).trim(),o=a.getSpan().nextText(r.total).previousTag("td3").previousTag("td3").tagContents(),p=o.innerCapture(regExpFormatted(/([\d\.,]+)/),1),g=o.innerCapture(regExpFormatted(/([A-Z]{3})/),1),u=a.getSpan().nextText(r.information).nextTag("tr2").innerTag("td2").tagContents().innerCapture(regExpFormatted(/\w+\s(.*)/),1),i=a.getSpan().nextText(r.confirmation).nextTag("table2");!i.innerText(r.total).exists();){var m,T={},s=i.nextDate(),x=i.nextTag("tr3").nextTag("tr3").nextTag("tr3").innerTag("td3").nextTag("td3").tagContents().innerCapture(/($<airlineName>.*)\s($<airlineCode>\w{2})($<flightNumber>\d{1,4})/);x&&(T.airlineName=x.$airlineName,T.airlineCode=x.$airlineCode,T.flightNumber=x.$flightNumber),m=i.nextTag("table4"),T.departureAirportFuzzy=m.innerTag("tr4").innerTag("td4").nextTag("td4").nextTag("td4").tagContents(),T.departureTime=getFuzzyDate(a.getDetachedSpan(s+" "+T.departureAirportFuzzy.previousDate())),T.arrivalAirportFuzzy=m.innerTag("tr4").nextTag("tr4").innerTag("td4").nextTag("td4").nextTag("td4").tagContents(),T.arrivalTime=getFuzzyDate(a.getDetachedSpan(s+" "+T.arrivalAirportFuzzy.previousDate())),ASSERT(T.arrivalAirportFuzzy,T.departureAirportFuzzy,T.flightNumber,T.departureTime,T.arrivalTime)&&d.push(T),i=i.nextTag("table2")}for(var h=0;d.length>h;h++){var v=d[h],c={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:v.airlineName,airlineCode:v.airlineCode,flightNumber:v.flightNumber,departureAirportFuzzy:v.departureAirportFuzzy,departureAirportCode:v.departureAirportCode,departureTime:v.departureTime,arrivalAirportFuzzy:v.arrivalAirportFuzzy,arrivalAirportCode:v.arrivalAirportCode,arrivalTime:v.arrivalTime},underName:{"@type":"http://schema.org/Person",name:u},checkinUrl:"",reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:p,priceCurrency:g,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};l.push(c)}return l.length?l:void 0}}).call();