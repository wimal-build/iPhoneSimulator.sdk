// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);if(a.setLocale(t),!a.getSpan().nextText(r.yourItinerary))return CONTINUE;var n;n=a.getSpan().nextText(r.bookingReferencePrefix).parentTag("td3").innerCapture(regExpFormatted(/\1 ($<bookingReference>\w{6})/,r.bookingReferencePrefix),1);var i,g,p=a.getSpan().nextText(r.pricePrefix).nextTag("td4").innerCapture(/($<currency>\w+) ($<price>[\d.,]+)/);p&&(i=p.$price,g=p.$currency);var o=[],x=n.nextText(r.passengersPrefix).parentTag("table4").allInnerTags("td4").filter(function(e){return e&&(""+e.tagContents().trim()).length>0});x=x.slice(1);for(var l=0;x.length>l;l++)o.push({name:x[l].tagContents().trim(),price:i,currency:g});for(var s=[],u=a.getSpan().nextText(r.flightNumberPrefix).parentTag("table5");u.exists()&&u.nextText(r.flightNumberPrefix).exists();){var c=u.nextText(r.flightNumberPrefix).nextTag("td5").tagContents(),m=c.innerCapture(/($<airlineCode>\w{2})($<flightNumber>\d{1,4})/),d=m.$airlineCode,f=m.$flightNumber,T=f.nextTag("td5").nextText(r.departureAirportPrefix).nextTag("td5").tagContents();r.terminal&&T&&(""+T).indexOf(r.terminal)>0&&(T=T.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var h=T.nextTag("td5").nextText(r.arrivalAirportPrefix).nextTag("td5").tagContents();r.terminal&&h&&(""+h).indexOf(r.terminal)>0&&(h=h.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var v,C=u.nextText(r.departureDatePrefix).nextTag("td5").tagContents().allDates();v=1==C.length?C[0]:a.getDetachedSpan(C.map(function(e){return e.trim()}).join("")).firstDate();var b,N=u.nextText(r.arrivalDatePrefix).nextTag("td5").tagContents().allDates();b=1==N.length?N[0]:a.getDetachedSpan(N.map(function(e){return e.trim()}).join("")).firstDate();var P=(u.nextText(r.cabinPrefix).nextTag("td5").tagContents(),u.nextText(r.airlineNamePrefix).nextTag("td5").tagContents());ASSERT(P,d,f,v,T,b,h)&&(s.push({airlineName:P,airlineCode:d,flightNumber:f,departureDate:v,departureAirport:T,arrivalDate:b,arrivalAirport:h,passengers:o}),P=d=f=v=T=b=h=null),u=u.nextTag("table5")}u=null;for(var y=a.getSpan().nextText(r.ticketNumberPrefix).nextTag("td4").tagContents().innerCapture(/([\d-]+)/,1),S=[],l=0;s.length>l;l++){u=s[l];for(var D=0;o.length>D;D++){passenger=o[D];var A={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:u.airlineName,airlineCode:u.airlineCode,flightNumber:u.flightNumber,departureAirportFuzzy:u.departureAirport,departureTime:u.departureDate,arrivalAirportFuzzy:u.arrivalAirport,arrivalTime:u.arrivalDate},underName:{"@type":"http://schema.org/Person",name:passenger.name},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:passenger.price,priceCurrency:passenger.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:y,ticketedSeat:{"@type":"http://schema.org/Seat"}}};S.push(A)}}return S.length?S:void 0}}).call();