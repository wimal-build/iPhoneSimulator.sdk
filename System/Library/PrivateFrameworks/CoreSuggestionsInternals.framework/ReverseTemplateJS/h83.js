// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,g,o,p,s,l,d,m,x,u,c,T,C,b,h,f,v,y,A,N=[],k={};if(a.getSpan().nextRegExp(/Swiss International Air Lines/).exists()){for(n=a.getSpan().nextRegExp(regExpFormatted(/\1/,r.bookingReference)).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1.*? (\w{6})/,r.bookingReference),1),g=a.getSpan().nextText(r.selectedServices).nextTag("td3").tagContents();g.exists()&&g.nextRegExp(r.eticket).exists();)m=g.nextRegExp(r.eticket).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1 (\d+)/,r.eticket),1),u=g.nextTag("td3").nextTag("td3").tagContents().innerCapture(regExpFormatted(/\1/,r.priceCurrency),1),x=r.totalPrice?g.nextText(r.totalPrice).nextAnyTag("td").tagContents():u.nextTag("table4").lastInnerTag("td4").tagContents(),k[""+g]={name:g,ticketNumber:m,priceCurrency:u,totalPrice:x,seats:{},seatingType:{}},g=g.nextTag("table4").nextTag("td3").tagContents();for(l=a.getSpan().firstText(r.flightInformation).nextTag("table4").nextTag("td4").tagContents();l.exists()&&l.nextText(r.selectedServices).exists();){if(c=l.innerCapture(/^($<departureAirport>.+) \(($<departureCode>[A-Z]{3})\) - ($<arrivalAirport>.+) \(($<arrivalCode>[A-Z]{3})\)$/),c&&(h=c.$departureAirport,f=c.$departureCode,y=c.$arrivalAirport,A=c.$arrivalCode),s=l.nextTag("td4").innerDate(),b=combineDateAndTime(s,s.nextTag("td4").innerDate()),v=combineDateAndTime(s,s.nextTag("td4").lastInnerDate()),s.nextTag("td4").innerText("+1").exists()&&(v=modifyDate(v,1)),T=l.nextTag("td5").nextTag("td5").tagContents().innerCapture(/($<code>.*) ($<flightNumber>\d+)/),C=T?T.$code:null,d=T?T.$flightNumber:null,p=d.nextTag("td4").nextTag("td4").tagContents(),valid(d,p)){o=Object.keys(k);for(var S=0;o.length>S;S++)k[o[S]].seatingType[""+d]=p}ASSERT(C,d,b,f,v,A)&&N.push({airlineCode:C,flightNumber:d,departureAirport:h,departureTime:b,departureCode:f,arrivalAirport:y,arrivalTime:v,arrivalCode:A,passengers:k}),l=d.nextTag("table4").nextTag("td4").tagContents()}}else{n=a.getSpan().nextRegExp(regExpFormatted(/\1/,r.bookingReference)).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1.*? (\w{6})/,r.bookingReference),1),o=a.getSpan().nextText(r.selectedServices).nextTag("td3").nextTag("td3").allInnerTags("table6").map(function(e){return e.allInnerTagsFiltered("td6")}).filter(function(e){return e.length>=2&&""+e[0]==r.name});for(var S=0,F=o.length;F>S;S++)m=o[S][1].nextRegExp(r.eticket).nextAnyTag("td").tagContents(),u=o[S][1].nextRegExp(r.priceCurrency).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1/,r.priceCurrency),1),x=u.nextAnyTag("td").tagContents(),k[o[S][1]]={name:o[S][1],ticketNumber:m,totalPrice:x,priceCurrency:u,seats:{},seatingType:{}};c=a.getSpan().nextText(r.flightInformation).nextTag("table3").allInnerTags("td3").map(function(e){return e.allInnerTags("table4")}).filter(function(e){return e.length>=2});for(var $,E=0,F=c.length;F>E;E++)if($=c[E][0],$.innerRegExp(r.dateFormat).exists()){if(s=$.innerDate(),l=$.nextTag("table6").allInnerTagsFiltered("td6"),b=combineDateAndTime(s,l[0].innerDate()),f=l[0].innerCapture(/([A-Z]{3})$/,1),v=combineDateAndTime(s,l[1].innerDate()),A=l[2],T=$.nextTag("table6").nextTag("table6").nextTag("td6").nextTag("td6").tagContents().innerCapture(/($<code>\w+) ($<flightNumber>\d+)/),C=T?T.$code:null,d=T?T.$flightNumber:null,p=$.nextTag("table6").nextTag("table6").nextTag("table6").nextTag("td6").tagContents(),valid(d,p)){o=Object.keys(k);for(var S=0;o.length>S;S++)k[o[S]].seatingType[""+d]=p}ASSERT(C,d,f,b,A,v)&&N.push({airlineCode:C,flightNumber:d,departureCode:f,departureTime:b,arrivalCode:A,arrivalTime:v,passengers:k})}}for(var R,D=[],I=0;N.length>I;I++)for(var P=N[I],z=Object.keys(P.passengers),w=0;z.length>w;w++){var j=P.passengers[z[w]];R={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:P.airlineCode,flightNumber:P.flightNumber,departureAirportFuzzy:P.departureAirport,departureAirportCode:P.departureCode,departureTime:P.departureTime,arrivalAirportFuzzy:P.arrivalAirport,arrivalAirportCode:P.arrivalCode,arrivalTime:P.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:i,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:j.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[P.flightNumber],seatingType:j.seatingType[P.flightNumber]}},totalPrice:j.totalPrice,priceCurrency:j.priceCurrency,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(j.membershipNumber)&&(R.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:"Frequent Flyer"}),D.push(R)}return D.length?D:void 0}}).call();