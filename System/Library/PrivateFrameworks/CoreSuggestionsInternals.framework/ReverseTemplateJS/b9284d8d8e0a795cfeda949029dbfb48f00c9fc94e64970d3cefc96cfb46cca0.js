// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("expedia.com-flight-changes-en",function(e){return/^Changes have been made to your .*? flight/.test(e.subject)},function(e){if(/^Changes have been made to your .*? flight/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,s,p,o,l,u,m,g,h,d,c,f=[],v={};if(t=r.getSpan().nextText("Passenger(s):").parentAnyTag("td").tagContents().innerCapture(/\bPassenger\(s\): (.*)/,1),not(t))return CONTINUE;t=t.split(",").map(function(e){return e.trim()});for(var C=0;t.length>C;C++)v[""+t[C]]={name:t[C],seats:{},seatingType:{}};s=r.getSpan().nextText("Your updated flight itinerary is below").nextText("Flight Details").parentAnyTag("table");var T=s.getTagNumber();s=s.withStart(r.getSpan().nextText("Your updated flight itinerary is below").getEnd()).allInnerTags("tr"+T).map(function(e){return e.allInnerTagsFiltered("td"+T)}).filter(function(e){return e.length>0});for(var b=0;s.length>b;b++)if(a=s[b],a[0].innerCapture(/^Flight(?: Change)? Details/)&&a[1])g=a[1];else if(a[1]&&a[1].innerCapture(/^Flight Number:/))o=a[0],p=a[1].innerCapture(/^Flight Number: ($<code>\w{2})($<flightNumber>\d+)/),l=p?p.$code:null,u=p?p.$flightNumber:null,r.getSpan().nextText(""+o+" confirmation code:").exists()&&(n=r.getSpan().innerCapture(RegExp(regExpEscape(""+o)+" confirmation code: (.*)\\s"),1));else if(a[0].innerCapture(/^From:/)&&a[1])h=a[0].innerCapture(/^From: \(([A-Z]{3})\)/,1);else if(a[0].innerCapture(/^To:/)&&a[1])c=a[0].innerCapture(/^To: \(([A-Z]{3})\)/,1),nextDay=a[1].innerCapture(/^Arrive: .* \+1 day$/),d=combineDateAndTime(g,a[1].lastInnerDate()),not(nextDay)||(d=modifyDate(d,1));else if(a[1]&&a[1].innerCapture(/^Class:/))seatingType=a[1].innerCapture(/^Class: (.*)/,1);else if(a[0].innerCapture(/^Equipment:/)){if(a[1]&&a[1].innerCapture(/^Seats:/)&&(i=a[1].innerCapture(/^Seats: (.*)/,1).split(",").map(function(e){return e.trim()})),valid(u)){t=Object.keys(v);for(var C=0;t.length>C;C++)valid(i)&&(v[t[C]].seats[""+u]=i[C]),valid(seatingType)&&(v[t[C]].seatingType[""+u]=seatingType)}ASSERT(l,u,g,h,d,c)&&f.push({airlineName:o,airlineCode:l,flightNumber:u,departureTime:g,departureCode:h,arrivalTime:d,arrivalCode:c,reservationId:n,passengers:v}),p=o=l=u=m=g=h=d=c=seatingType=i=n=null}for(var y,N=[],b=0;f.length>b;b++){y=f[b];for(var x=Object.keys(y.passengers),S=0;x.length>S;S++){var A=y.passengers[x[S]],F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:y.airlineName,airlineCode:y.airlineCode,flightNumber:y.flightNumber,departureAirportFuzzy:y.departureAirport,departureAirportCode:y.departureCode,departureTime:y.departureTime,arrivalAirportFuzzy:y.arrivalAirport,arrivalAirportCode:y.arrivalCode,arrivalTime:y.arrivalTime},underName:{"@type":"http://schema.org/Person",name:A.name},checkinUrl:y.checkinUrl,reservationId:y.reservationId,reservationStatus:"http://schema.org/Reservation"+(y.reservationStatus||"Confirmed"),totalPrice:A.price,priceCurrency:A.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:A.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:A.seats[y.flightNumber],seatingType:A.seatingType[y.flightNumber]}}};valid(A.membershipNumber,A.programName)&&(F.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:A.membershipNumber,programName:A.programName}),N.push(F)}}if(N.length)return N}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/553/554","SG7272f80d")]);