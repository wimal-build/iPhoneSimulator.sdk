// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o,p,s,c,d,m,g,l,h,u,T,v,C,x,f,N,y,b,k,S,A,D,F,P,R,E,$,U,I,z,w,L=[],O=[],M=[],j={},q=[],B=function(e){return p=e.tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.car.name),1),l=e.tagContents().innerCapture(regExpFormatted(/\s+\1:\s*(.*)/,r.car.reservationId),1),C=l.nextText(r.car.driver).nextTag("td5").tagContents().innerCapture(/(.*?):/,1),d=e.nextText(r.car.totalPrice).nextTag("td5").tagContents(),s=d.innerCapture(/([\d,.]+)/,1),c=d.innerCapture(/([^\d,.]+)/,1),h=e.nextText(r.car.pickupTime).tagContents().nextDate(),T=h.nextDate(),x=h.parentTag("td5").tagContents().innerCapture(regExpFormatted(/(.*)\s+\1/,""+C),1),u=T.nextText(r.car.loc).parentTag("td6").tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.car.loc),1),v=u,ASSERT(p,h,u,x)?{name:p,reservationId:l,priceCurrency:c,totalPrice:s,pickupTime:h,pickupAddress:u,dropoffTime:T,dropoffAddress:v,brand:C,provider:x}:void 0},G=function(e){return f=e.nextText(r.event.ticketNr).parentTag("td4").tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.event.ticketNr),1),N=e.nextTag("table6").nextText(r.event.price).nextTag("td6"),y=N.nextTag("td6"),b=y.nextTag("td6"),y=y.innerDate(),d=b.nextTag("td6").nextTag("td6").tagContents(),s=d.innerCapture(/([\d,.]+)/,1),c=d.innerCapture(/([^\d,.]+)/,1),b=b.innerLink(),ASSERT(y,N)?{ticketNumber:f,eventName:N,startDate:y,totalPrice:s,priceCurrency:c,eventUrl:b}:void 0},H=function(e){for(k=e.nextText(r.flight.summary).nextTag("table5"),d=e.nextText(r.flight.price).nextTag("td5").tagContents(),s=d.innerCapture(/([\d,.]+)/,1),c=d.innerCapture(/([^\d,.]+)/,1),l=e.nextTag("table5").nextTag("table5").nextTag("tr5").nextTag("td5").tagContents().innerCapture(regExpFormatted(/\1:\s+(.*)/,r.flight.reservationId),1),_=e.nextText(r.flight.passenger);!_.nextTag("tr5").innerText(r.flight.taxes).exists();)_=_.nextTag("tr5"),p=_.nextTag("td5").tagContents(),j[""+p]={name:p,totalPrice:s,priceCurrency:c,seats:{},seatingType:{},ticketNumber:f};for(;k.innerDate().exists();)m=k.nextDate(),D=m.nextTag("td5").nextTag("td5"),I=D.tagContents().innerCapture(/($<departureAirport>.*)\(($<departureCode>.*)\)/),S=I.$departureCode,I=I.$departureAirport,A=a.getDetachedSpan(""+m+" "+D.firstDate()).innerDate(),F=D.nextTag("td5").nextTag("td5"),U=F.tagContents().innerCapture(/($<arrivalAirport>.*)\(($<arrivalCode>.*)\)/),P=U.$arrivalCode,U=U.$arrivalAirport,R=a.getDetachedSpan(""+m+" "+F.firstDate()).innerDate(),E=F.nextTag("td5").nextTag("td5"),E=E.tagContents().innerCapture(regExpFormatted(/^($<airlineCode>.*)\s+($<airline>.*)\nFlight: ($<flightNr>\w+)/,r.flightName)),z=E.$airline,w=E.$flightNr,$=E.$airlineCode,ASSERT(z,w,A,S,R,P)&&q.push({airlineName:z,airlineCode:$,flightNumber:w,reservationId:l,departureAirport:I,departureCode:S,departureTime:A,arrivalAirport:U,arrivalCode:P,arrivalTime:R,passengers:j}),k=k.nextTag("table5")};switch(n=a.getSpan().nextText(r.bookedItems),i=n.nextTag("table4"),o=""+i.tagContents().innerCapture(/(\w+):/,1)){case r.carName:O.push(B(i));break;case r.eventName:M.push(G(i));break;case r.flightName:H(i)}for(var J,K=0;O.length>K;K++)J=O[K],g={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:J.totalPrice,priceCurrency:J.priceCurrency,reservationId:J.reservationId,reservationStatus:"http://schema.org/Reservation"+(J.reservationStatus||"Confirmed"),checkinUrl:J.checkinUrl,modifyReservationUrl:J.modifyReservationUrl,cancelReservationUrl:J.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:J.name,email:J.email},provider:{"@type":"http://schema.org/Organization",name:J.provider},pickupTime:J.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:J.pickupName,telephone:J.pickupTelephone,address:J.pickupAddress},dropoffTime:J.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:J.dropoffName,telephone:J.dropoffTelephone,address:J.dropoffAddress}},J.brand&&(g.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:J.brand},license:J.license,color:J.color}),L.push(g);for(var Q,V=0;M.length>V;V++)Q=M[V],g={"@context":"http://schema.org","@type":"http://schema.org/EventReservation",name:Q.name,totalPrice:Q.totalPrice,priceCurrency:Q.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Q.ticketNumber,ticketToken:Q.ticketToken,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Q.seat,seatRow:Q.seatRow,seatSection:Q.seatSection}},reservationFor:{"@type":"http://schema.org/Event",eventStatus:"http://schema.org/Event"+(Q.eventStatus||"Confirmed"),name:Q.eventName,url:Q.eventUrl,startDate:Q.startDate,endDate:Q.endDate,location:{"@type":"http://schema.org/Place",name:Q.place,telephone:Q.phoneNumber,address:Q.address}}},L.push(g);for(var W,X=0;q.length>X;X++){W=q[K];for(var Y=Object.keys(W.passengers),Z=0;Y.length>Z;Z++){var _=W.passengers[Y[Z]],g={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:W.airlineName,airlineCode:W.airlineCode,flightNumber:W.flightNumber,departureAirportFuzzy:W.departureAirport,departureAirportCode:W.departureCode,departureTime:W.departureTime,arrivalAirportFuzzy:W.arrivalAirport,arrivalAirportCode:W.arrivalCode,arrivalTime:W.arrivalTime},underName:{"@type":"http://schema.org/Person",name:_.name},checkinUrl:W.checkinUrl,reservationId:W.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:_.totalPrice,priceCurrency:_.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:_.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:_.seats[W.flightNumber],seatingType:_.seatingType[W.flightNumber]}}};valid(_.membershipNumber,_.programName)&&(g.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:_.membershipNumber,programName:_.programName}),L.push(g)}}return L.length?L:void 0}}).call();