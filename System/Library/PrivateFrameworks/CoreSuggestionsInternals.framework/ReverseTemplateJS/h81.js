// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){if(int(e.epoch)<1388534400)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,p,l,o,u,s,m,g,c,d,h,T,v,C,b,f,y,N,A,$=[],x={};i=a.getSpan().nextText(t.reservationId).nextAnyTag("td").tagContents(),l=a.getSpan().nextText(t.flightDetails).nextText(t.passengers).parentTag("table5").allInnerTags("table6").map(function(e){return e.allInnerTagsFiltered("td6").filter(function(e,r){return 0==r})}),m=a.getSpan().nextText(t.pricing).nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+) ($<priceCurrency>[A-Z]{3})/),g=m?m.$totalPrice:null,c=m?m.$priceCurrency:null;for(var S=0;l.length>S;S++)x[""+l[S][0]]={name:l[S][0],seats:{},seatingType:{},totalPrice:g,priceCurrency:c};u=a.getSpan().nextText(t.flightDetails).parentTag("table4").allInnerTags("table5").map(function(e){return e.allInnerTagsFiltered("td5")}).filter(function(e){return 6==e.length});for(var D=0;u.length>D;D++)o=u[D],d=o[0].innerCapture(/\(($<code>[A-Z]+)\s*($<flightNumber>\d+)\)$/),h=d?d.$code.trim():null,s=d?d.$flightNumber:null,T=o[1].innerCapture(/\(($<code>[A-Z]{3})\)\s+($<airport>.*)/),b=T?T.$code:null,C=T?T.$airport:null,f=o[2].innerCapture(/\(($<code>[A-Z]{3})\)\s+($<airport>.*)/),A=f?f.$code:null,N=f?f.$airport:null,v=combineDateAndTime(o[3].innerDate(),a.getDetachedSpan(""+o[3].innerCapture(/\d{2}:\d{2}/))),y=combineDateAndTime(o[4].innerDate(),a.getDetachedSpan(""+o[4].innerCapture(/\d{2}:\d{2}/))),ASSERT(h,s,b,v,A,y)&&$.push({airlineCode:h,flightNumber:s,departureCode:b,departureAirport:C,departureTime:v,arrivalCode:A,arrivalAirport:N,arrivalTime:y,passengers:x});for(var F=[],D=0;$.length>D;D++)for(var I=$[D],P=Object.keys(I.passengers),k=0;P.length>k;k++){var z=I.passengers[P[k]],Z={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:I.airlineName,airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},checkinUrl:p,reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:z.totalPrice,priceCurrency:z.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[""+I.airlineCode+(""+I.flightNumber)],seatingType:z.seatingType[I.flightNumber]}}};valid(z.membershipNumber,z.programName)&&(Z.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:z.programName}),F.push(Z)}return F.length?F:void 0}}).call();