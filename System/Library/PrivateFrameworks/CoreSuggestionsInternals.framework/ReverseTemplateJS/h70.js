// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,o,s,l,u,g,d,m,v,h,c=[],x=[],y=[];n=regExpFormatted(/\1\s*(.*)/,r.reservationId).exec(e.subject)[1];var A="easyjet";s=a.getSpan().next(r.itinerary),m=a.getSpan().next(r.payment).nextAnyTag("table").nextAnyTag("td").nextAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1\s*(.*)\s\2\s/,r.paymentPreFix,r.paymentPostFix),1),v=m.innerCapture(/([\d,.]+)/,1),h=m.innerCapture(/([^\d,.]+)/,1).trim(),p=s.next(r.passengers).parentAnyTag("table").allInnerTags("td5");for(var C=1;p.length>C;C++)o={},o.name=p[C].tagContents(),x.push(o);for(u=s.next(r.arrival);u.exists();)g={},l=u.previous(r.departure),d=l.previousAnyTag("td").previousAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<departure>.*) \1 ($<arrival>\w+)/,r.arrivalAirport)),g.departureAirport=d.$departure.trim(),g.arrivalAirport=(""+d.$arrival).replace("(Flexible)","").trim(),g.departureDate=l.nextDate(),g.arrivalDate=u.nextDate(),g.flightNumber=u.next(r.flight).parentAnyTag("td").tagContents().innerCapture(/(\d+)/,1),g.seats=(""+u.next(r.seat).nextAnyTag("td").tagContents()).split(", "),u=u.next(r.arrival),ASSERT(g.flightNumber,g.departureDate,g.departureAirport,g.arrivalDate,g.arrivalAirport)&&y.push(g);for(var T=0;y.length>T;T++){g=y[T];for(var f=0;x.length>f;f++){o=x[f];var F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:A,airlineCode:g.airlineCode,flightNumber:g.flightNumber,departureAirportFuzzy:g.departureAirport,departureTime:g.departureDate,arrivalAirportFuzzy:g.arrivalAirport,arrivalTime:g.arrivalDate},underName:{"@type":"http://schema.org/Person",name:o.name},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:v,priceCurrency:h,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:g.seats[f]}}};c.push(F)}}return c.length?c:void 0}}).call();