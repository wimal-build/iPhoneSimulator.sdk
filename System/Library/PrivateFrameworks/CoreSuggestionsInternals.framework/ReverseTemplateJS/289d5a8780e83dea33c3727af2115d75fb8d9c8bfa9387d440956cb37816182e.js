// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("apple.com-travel.res.APAC",function(e){return/^My Trip Ticketed/.test(e.subject)},function(e){if(/^My Trip Ticketed/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,p,s,l,c,m,d,g,h,u,T,y,v,x,C,f,A,b,k,N,R,S,$,P,I,U,D,F,E,z,w,L,M=[],O=[],Z={},j=[],H=[];n=t.getSpan().innerCapture(/Travel Itinerary for\s+(.+?)\n/,1),Z[""+n]={name:n,seats:{},seatingType:{}},l=t.getSpan().allInnerCapture(/Reference #/);for(var q=0;l.length>q;q++)s=l[q][0].withStart(l[q][0].previousText("Airline").getStart()).withEnd(l[q][0].nextText("Flight time").getEnd()),d=s.previousText("Flight").parentAnyTag("td").tagContents().innerCapture(/Flight ($<code>\D+)($<flightNumber>\d+)/),g=d?d.$code:null,c=d?d.$flightNumber:null,p=s.innerText("Reference #").nextAnyTag("td").tagContents(),h=p.nextTag("table1").nextText("From").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),T=h?h.$airport:null,y=h?h.$code:null,v=p.nextTag("table1").nextTag("table1").nextText("To").nextAnyTag("td").tagContents().innerCapture(/($<airport>.+) \(($<code>[A-Z]{3})\)/),C=v?v.$airport:null,f=v?v.$code:null,u=s.innerText("Departs").nextAnyTag("td").innerDate(),x=s.innerText("Arrives").nextAnyTag("td").innerDate(),valid(c)&&(Z[""+n].seats[""+c]=s.innerText("Seat #").nextAnyTag("td").tagContents()),m=s.innerText("Frequent flier #").nextAnyTag("td").innerCapture(/($<programName>\D+)\s*($<membershipNumber>\d+)/),m&&(Z[""+n].programName=m?m.$programName:null,Z[""+n].membershipNumber=m?m.$membershipNumber:null),ASSERT(p,g,c,u,y,x,f)&&O.push({reservationId:p,airlineCode:g,flightNumber:c,departureTime:u,departureCode:y,departureAirport:T,arrivalTime:x,arrivalCode:f,arrivalAirport:C,passengers:Z});N=t.getSpan().allInnerCapture(/Check-in/);for(var q=0;N.length>q;q++)k=N[q][0].withStart(N[q][0].previousText("Hotel").previousText("Hotel").getStart()).withEnd(N[q][0].nextText("Confirmation #").getEnd()),R=k.innerText("Address").previousAnyTag("td").tagContents(),$=k.innerText("Address").nextAnyTag("td").tagContents().innerCapture(/(.+?) </,1),S=k.innerText("Telephone").nextAnyTag("td").tagContents(),A=k.innerText("Check-in").nextAnyTag("td").innerDate(),b=k.innerText("Check-out").nextAnyTag("td").innerDate(),a=k.innerText("Rate").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+)($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,p=k.innerText("Confirmation #").nextAnyTag("td").tagContents(),ASSERT(n,p,R,$,A,b)&&j.push({name:n,reservationId:p,hotelName:R,hotelAddress:$,hotelPhone:S,checkInDateTime:A,checkOutDateTime:b,totalPrice:i,priceCurrency:o});I=t.getSpan().allInnerCapture(/Rental location/);for(var q=0;I.length>q;q++)P=I[q][0].withEnd(I[q][0].nextText("Confirmation #").getEnd()),a=P.innerText("Approximate Total Price").nextAnyTag("td").tagContents().innerCapture(/($<totalPrice>[\d,.]+) ($<priceCurrency>[A-Z]{2,3})/),i=a?a.$totalPrice:null,o=a?a.$priceCurrency:null,D=P.innerText("Rental company").nextAnyTag("td").tagContents(),L=P.innerText("Pick-up").nextAnyTag("td").innerDate(),z=P.innerText("Rental location").nextAnyTag("td").tagContents(),w=P.innerText("Telephone").nextAnyTag("td").tagContents(),E=P.innerText("Drop-off").nextAnyTag("td").innerDate(),F=P.innerText("Return location").nextAnyTag("td").tagContents(),p=P.innerText("Confirmation #").nextAnyTag("td").tagContents(),U=P.innerText("Type of car").nextAnyTag("td").tagContents(),ASSERT(n,p,U,L,z,D)&&H.push({reservationId:p,name:n,totalPrice:i,priceCurrency:o,provider:D,pickupTime:L,pickupAddress:z,pickupTelephone:w,dropoffTime:E,dropoffAddress:F,brand:U});for(var q=0;O.length>q;q++)for(var B=O[q],G=Object.keys(B.passengers),_=0;G.length>_;_++){var J=B.passengers[G[_]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:B.airlineName,airlineCode:B.airlineCode,flightNumber:B.flightNumber,departureAirportFuzzy:B.departureAirport,departureAirportCode:B.departureCode,departureTime:B.departureTime,arrivalAirportFuzzy:B.arrivalAirport,arrivalAirportCode:B.arrivalCode,arrivalTime:B.arrivalTime},underName:{"@type":"http://schema.org/Person",name:J.name},checkinUrl:B.checkinUrl,reservationId:B.reservationId,reservationStatus:"http://schema.org/Reservation"+(B.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:J.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:J.seats[B.flightNumber],seatingType:J.seatingType[B.flightNumber]}},totalPrice:J.totalPrice,priceCurrency:J.currency},valid(J.membershipNumber,J.programName)&&(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:J.membershipNumber,programName:J.programName}),M.push(r)}for(var P,q=0;H.length>q;q++)P=H[q],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:P.totalPrice,priceCurrency:P.priceCurrency,reservationId:P.reservationId,reservationStatus:"http://schema.org/Reservation"+(P.reservationStatus||"Confirmed"),checkinUrl:P.checkinUrl,modifyReservationUrl:P.modifyReservationUrl,cancelReservationUrl:P.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:P.name,email:P.email},provider:{"@type":"http://schema.org/Organization",name:P.provider},pickupTime:P.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:P.pickupName,telephone:P.pickupTelephone,address:P.pickupAddress},dropoffTime:P.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:P.dropoffName,telephone:P.dropoffTelephone,address:P.dropoffAddress}},P.brand&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:P.brand},license:P.license,color:P.color}),M.push(r);for(var k,q=0;j.length>q;q++)k=j[q],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:k.name,email:k.email},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency,checkinTime:k.checkInDateTime,checkoutTime:k.checkOutDateTime,modifyReservationUrl:k.modifyReservationUrl,cancelReservationUrl:k.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(k.reservationStatus||"Confirmed"),reservationId:k.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:k.hotelName,url:k.hotelUrl,telephone:k.hotelPhone,address:k.hotelAddress}},M.push(r);if(M.length)return M}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/578/579","SG3600c401")]);