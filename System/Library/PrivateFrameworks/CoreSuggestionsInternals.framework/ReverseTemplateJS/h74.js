// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o={},l=[],g={};n=a.getSpan().innerCapture(regExpFormatted(/\1: (.*?) /,r.bookingCode),1);var s=a.getSpan().firstText(r.passengersHeader).nextTag("table9").allInnerTags("tr9");if(s){nbPassengers=s.length-1;for(var p=1;nbPassengers+1>p;p++){var d=s[p].allInnerTags("td9"),m=(""+d[0].tagContents()).trim(),u=regExpFormatted(/\1/,r.child.toLowerCase()).test(m.toLowerCase())?"child":"adult";m=m.replace(/\(.*\)/,"").trim();var c=""+d[1].tagContents();c==r.withoutCard&&(c=""),ticket=""+d[2].tagContents(),o[m]={ticketNumber:ticket,membershipNumber:c,ageCategory:u}}}var h=a.getSpan().firstText(r.reservationDetails).nextText(r.flightDetails).nextTag("table8").allInnerTags("table9");if(h){for(var v={},p=0,C=h.length;C>p;p++)regExpFormatted(/\1.*\2/,r.departure,r.arrival).test(""+h[p])&&(v[p]=1);for(var p in v){var T,x=""+h[p].nextTag("tr9").nextTag("td9").nextTag("td9").tagContents(),f=h[p].nextTag("tr9").nextTag("tr9").allInnerTags("td9"),b="Iberia",y="IB";regExpFormatted(/\1/,r.codesharePrefix).test(f[0].tagContents())&&(T=(""+f[0].tagContents()).replace(r.codesharePrefix,"").replace(".","").trim(),b=T,y="");{var F=getFuzzyDate(f[1]),A=f[1].tagContents().innerCapture(/\n($<name>.*) \(($<code>[A-Z]{3})\)/),N=A?A.$name:null,k=A?A.$code:null,S=getFuzzyDate(f[2]),z=f[2].tagContents().innerCapture(/\n($<name>.*) \(($<code>[A-Z]{3})\)/),I=z?z.$name:null,$=z?z.$code:null;""+f[4].tagContents()}ASSERT(b,x,k,F,$,S)&&l.push({airlineName:b,airlineCode:y,flightNumber:x,departureAirport:N,departureCode:k,departureTime:F,arrivalAirport:I,arrivalCode:$,arrivalTime:S})}}var E=a.getSpan().firstText(r.priceHeader).nextTag("table8").nextTag("table9").allInnerTags("tr9");if(E){i=""+a.getSpan().firstText(r.totalPrice).nextTag("td9").tagContents().trim(),i=i.charAt(i.length-1);for(var P=E.length-1,p=1;P+1>p;p++){var D,d=E[p].allInnerTags("td9"),D=regExpFormatted(/\1/,r.adult).test(""+d[0])?"adult":regExpFormatted(/\1/,r.child).test(""+d[0])?"child":null;valid(D)&&(g[D]=""+d[5].tagContents())}}var w=[];for(p=0;l.length>p;p++)for(var L=l[p],R=Object.keys(o),H=0;R.length>H;H++){var Z=o[R[H]],j=g[Z.ageCategory],B={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:L.airlineName,airlineCode:L.airlineCode,flightNumber:L.flightNumber,departureAirportFuzzy:L.departureAirport,departureAirportCode:L.departureCode,departureTime:L.departureTime,arrivalAirportFuzzy:L.arrivalAirport,arrivalAirportCode:L.arrivalCode,arrivalTime:L.arrivalTime},underName:{"@type":"http://schema.org/Person",name:R[H],email:""},checkinUrl:"",reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:j,priceCurrency:i,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Z.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};w.push(B)}return w.length?w:void 0}}).call();