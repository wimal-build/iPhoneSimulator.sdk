// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("orbitz.com-itinerary-en",function(){return!0},function(e){function r(){hr||ASSERT(C,g,N,x,P,$)&&(nr.push({startOfLeg:dr,airlineName:C,flightNumber:g,reservationId:l,reservationStatus:p,departureAirport:A,departureCode:N,departureTime:x,arrivalAirport:S,arrivalCode:P,arrivalTime:$,passengers:ar}),y=C=g=dr=k=A=N=x=R=S=P=$=m=c=l=null),hr=!1}if(int(e.epoch)<1335657600)return CONTINUE;var t=Scanner.fromMessage(e);t.setLocale("en_US");var n,a,i,o,s,l,p,m,c,u,d,h,g,f,v,T,b,y,C,k,x,A,N,R,$,S,P,I,D,U,O,z,E,F,L,j,M,H,w,B,Z,G,Y,_,q,J,K,Q,V,W,X,er,rr,tr=[],nr=[],ar={},ir=[],or=[];if(s=t.getSpan().nextText("Total due at booking").nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),t.getSpan().nextRegExp(/Flight [Ii]tinerary/).exists()){o=t.getSpan().nextText("Traveler information").parentTag("table3").allInnerTags("table4").map(function(e){return e.allInnerTags("tr4")}),p="Confirmed",/^Your reservation confirmation/.test(e.subject)?p="Pending":/\bCancellation/.test(e.subject)&&(p="Cancelled");for(var sr,lr,pr=0;o.length>pr;pr++){i=o[pr];for(var sr,lr,mr=0;i.length>mr;mr++)sr=i[mr].innerTag("th4").tagContents(),lr=i[mr].innerTag("td4").tagContents(),sr.innerCapture(/^Traveler/)?a=lr:sr.innerCapture(/^Airline Ticket Number:/)?f=lr.innerCapture(/(\d+)/,1):sr.innerCapture(/^Loyalty Programs:/)&&(v=lr.innerCapture(/($<name>.*?) ($<number>\d+)/),T=v?v.$name:null,b=v?v.$number:null);valid(a)&&(ar[""+a]={name:a,ticketNumber:f,programName:T,membershipNumber:b,totalPrice:s,seats:{},seatingType:{}}),a=f=T=b=null}var cr=t.getSpan().nextText("Flight itinerary").nextTag("table5");h=cr.allInnerTags("tr5").map(function(e){return e.allInnerTagsFiltered("td5")});for(var ur,dr,hr=!0,gr=0;h.length>gr;gr++)if(d=h[gr],d.length)if(ur=""+d[0],"Leave"==ur)dr=!0,u=d[1];else if("Depart"==ur){if(r(),y=d[2].innerCapture(/($<name>.*) ($<flightNumber>\d+)\s+(?:($<seatingType>.*) )?\|/),C=y?y.$name:null,g=y?y.$flightNumber:null,c=y?y.$seatingType:null,l=cr.innerCapture(RegExp(regExpEscape(C)+" record locator: (.*)\\s"),1).trim(),valid(g,c)){i=Object.keys(ar);for(var mr=0;i.length>mr;mr++)ar[i[mr]].seatingType[g]=c}}else if(d[0].innerCapture(/\d{1,2}:\d{2} [AP]M/))not(x)?(x=combineDateAndTime(u,d[0]),k=d[1].innerCapture(/\b($<airport>.*) \(($<code>[A-Z]{3})\)/),A=k?k.$airport:null,N=k?k.$code:null):($=combineDateAndTime(u,d[0]),R=d[1].innerCapture(/\b($<airport>.*) \(($<code>[A-Z]{3})\)/),S=R?R.$airport:null,P=R?R.$code:null);else if(/Seats:/.test(d[0])){if(m=d[0].innerCapture(/\bSeats: (.*?) \|/,1).split(",").map(function(e){return e.trim()}),m.length){var i=Object.keys(ar),fr=Math.floor(m.length/i.length)-1;if(nr.length>fr)for(var vr,Tr=0;fr>Tr;Tr++){vr=nr[nr.length-fr+Tr];for(var mr=0;i.length>mr;mr++)ar[i[mr]].seats[vr.flightNumber]=m[Tr*i.length+mr]}if(g)for(var mr=0;i.length>mr;mr++)ar[i[mr]].seats[g]=m[fr+mr]}}else if(/^Overnight flight/.test(d[0])){if($>x){x=modifyDate(x,1);for(var vr,Tr=nr.length-1;Tr>=0;Tr--){if(vr=nr[Tr],!(vr.arrivalTime>vr.departureTime)){vr.arrivalTime=modifyDate(vr.arrivalTime,1);break}if(vr.startOfLeg||(vr.departureTime=modifyDate(vr.departureTime,1)),vr.arrivalTime=modifyDate(vr.arrivalTime,1),vr.startOfLeg)break}}$=modifyDate($,1)}else"Return"==ur&&(u=d[1],dr=!0);r()}t.getSpan().nextRegExp(/Hotel [Ii]nformation/).exists()&&(a=t.getSpan().nextRegExp(/Hotel reservations? under/).nextAnyTag("td").tagContents().innerCapture(/([^*]+)/,1).trim(),valid(a)&&(p="Confirmed",/\bCancellation/.test(e.subject)&&(p="Cancelled"),o=t.getSpan().nextText("Hotel Information").parentAnyTag("table"),D=o.innerText("Check-in:").nextDate(),z=o.innerText("Check-out:").nextDate(),w=o.innerCapture(/Hotel check-in\/check-out: ($<checkIn>\d{1,2}:?\d{2}(?: [AP]M)?)\s+($<checkOut>\d{1,2}:?\d{2}(?: [AP]M)?)/),I=w?w.$checkIn:null,O=w?w.$checkOut:null,U=combineDateAndTime(D,I),E=combineDateAndTime(z,O),F=o.innerText("Date and time:").previousAnyTag("td"),n=F.innerCapture(/\bHotel\s+($<name>.*) hotel details <($<url>.*)>/),j=n?n.$name:null,L=n?n.$url:null,H=F.innerAddress(),M=F.innerPhoneNumber(),l=F.innerCapture(/\bHotel confirmation number: (\w+)/,1),ASSERT(a,j,H,U,E)&&ir.push({name:a,reservationId:l,reservationStatus:p,totalPrice:s,hotelName:j,hotelAddress:H,hotelUrl:L,hotelPhone:M,checkInDateTime:U,checkOutDateTime:E,modifyReservationUrl:B,cancelReservationUrl:Z}))),t.getSpan().nextRegExp(/Car [Ii]nformation/).exists()&&(a=t.getSpan().nextRegExp(/Car reservations? under/).nextAnyTag("td").tagContents().innerCapture(/([^*]+)/,1).trim(),valid(a)&&(p="Confirmed",/\bCancellation/.test(e.subject)&&(p="Cancelled"),o=t.getSpan().nextRegExp(/Car [Ii]nformation/).parentAnyTag("table"),n=o.innerText("Rental:").parentAnyTag("td").innerCapture(/\b($<provider>.*) Booking Reference: ($<reservationId>.*)\s+($<brand>.*)/),Y=n?n.$provider:null,l=n?n.$reservationId:null,G=n?n.$brand:null,V=o.innerText("Pick-up:").parentAnyTag("td"),rr=getFuzzyDate(V),W=V.innerCapture(/\s.*?\|.*?\|(.*?)\|/,1).trim(),X=V.innerAddress(),not(X)&&(X=V.innerCapture(/\s.*?\|.*?\|.*?\|.*\s+([^]+)\s+Phone:/,1).trim()),er=V.innerPhoneNumber(),_=o.innerText("Drop-off:").parentAnyTag("td"),Q=getFuzzyDate(_),J=_.innerAddress().result()||X,q=_.innerCapture(/\s.*?\|.*?\|(.*?)\|/,1).trim().result()||W,K=_.innerPhoneNumber().result()||er,s=t.getSpan().nextRegExp(/\bTotal (?:due at booking|car rental estimate:)/).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),valid(a,rr,Y,l,OR(X,W))&&or.push({name:a,brand:G,pickupTime:rr,pickupName:W,pickupAddress:X,pickupTelephone:er,dropoffTime:Q,dropoffName:q,dropoffAddress:J,dropoffTelephone:K,provider:Y,reservationId:l,reservationStatus:p,totalPrice:s})));for(var gr=0;nr.length>gr;gr++)for(var br=nr[gr],yr=Object.keys(br.passengers),Tr=0;yr.length>Tr;Tr++){var Cr=br.passengers[yr[Tr]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:br.airlineName,airlineCode:br.airlineCode,flightNumber:br.flightNumber,departureAirportFuzzy:br.departureAirport,departureAirportCode:br.departureCode,departureTime:br.departureTime,arrivalAirportFuzzy:br.arrivalAirport,arrivalAirportCode:br.arrivalCode,arrivalTime:br.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Cr.name},checkinUrl:br.checkinUrl,reservationId:br.reservationId,reservationStatus:"http://schema.org/Reservation"+(br.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Cr.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Cr.seats[br.flightNumber],seatingType:Cr.seatingType[br.flightNumber]}},totalPrice:Cr.totalPrice,priceCurrency:Cr.currency},not(Cr.membershipNumber)||(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Cr.membershipNumber,programName:Cr.programName}),tr.push(schema)}for(var kr,gr=0;or.length>gr;gr++)kr=or[gr],schema={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:kr.totalPrice,priceCurrency:kr.priceCurrency,reservationId:kr.reservationId,reservationStatus:"http://schema.org/Reservation"+(kr.reservationStatus||"Confirmed"),checkinUrl:kr.checkinUrl,modifyReservationUrl:kr.modifyReservationUrl,cancelReservationUrl:kr.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:kr.name,email:kr.email},provider:{"@type":"http://schema.org/Organization",name:kr.provider},pickupTime:kr.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:kr.pickupName,telephone:kr.pickupTelephone,address:kr.pickupAddress},dropoffTime:kr.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:kr.dropoffName,telephone:kr.dropoffTelephone,address:kr.dropoffAddress}},kr.brand&&(schema.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:kr.brand},license:kr.license,color:kr.color}),tr.push(schema);for(var F,gr=0;ir.length>gr;gr++)F=ir[gr],schema={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:F.name,email:F.email},totalPrice:F.totalPrice,priceCurrency:F.priceCurrency,checkinTime:F.checkInDateTime,checkoutTime:F.checkOutDateTime,modifyReservationUrl:F.modifyReservationUrl,cancelReservationUrl:F.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(F.reservationStatus||"Confirmed"),reservationId:F.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:F.hotelName,url:F.hotelUrl,telephone:F.hotelPhone,address:F.hotelAddress}},tr.push(schema);return tr},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/656/657","SG7b7d1f3e")]);