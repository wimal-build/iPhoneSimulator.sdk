// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("virginamerica.com-confirmation-and-checkin-en",function(e){return/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)},function(e){if(/^Virgin America Reservation [A-Z]{6}/.test(e.subject)||/^It's Time to Check In/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,s,o,p,m,l,g,u,d,h,c,v,C,T,b,f,A,y,x=[],N={};if(t=r.getSpan().innerCapture(/\bYour Confirmation Code: ([A-Z]{6})/,1),a=t.nextLink(),i=r.getSpan().nextRegExp(/Who['\u2019]s Flying/).nextAnyTag("table"),i.exists()){var $=i.getTagNumber();i=i.allInnerTags("tr"+$);for(var S,F=1;S=i[F++];)u=S.allInnerTags("td"+$),n=u[0].tagContents(),N[""+n]={name:n,membershipNumber:""+u[1].tagContents(),seatList:u[2]&&u[2].tagContents().split(/(?:\s+|,)(?:\/\s+)?/g).filter(function(e){return"Not"!=e}).map(function(e){return"Selected"==e||"N/A"==e?"":e})}}if(p=r.getSpan().nextRegExp(/Where You['\u2019]re Going/).nextAnyTag("table"),p.exists()){var $=p.getTagNumber();p=p.allInnerTags("tr"+$);for(var F=1;o=p[F];F++)if(o=o.allInnerTags("td"+$),o.length>=4&&(s=o[0].innerDate(),d=o[1].tagContents().innerCapture(/($<code>.*?)\s*($<flightNumber>\d{1,4})/g),h=d?d.$code:null,m=d?d.$flightNumber:null,c=o[2].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),C=c?c.$airport:null,T=c?c.$code:null,v=combineDateAndTime(s,o[2].tagContents().innerDate()),b=o[3].tagContents().innerCapture(/($<airport>.*)\s\(($<code>[A-Z]{3})\)/),A=b?b.$airport:null,y=b?b.$code:null,f=combineDateAndTime(s,o[3].tagContents().innerDate()),v>f&&(f=modifyDate(f,1)),ASSERT(h,m,T,v,y,f))){for(var k=Object.keys(N),D=0;n=k[D++];)N[n].seats||(N[n].seats={}),N[n].seatList.length>=F&&(N[n].seats[m]=N[n].seatList[F-1]);x.push({airlineCode:h,flightNumber:m,departureAirport:C,departureCode:T,departureTime:v,arrivalAirport:A,arrivalCode:y,arrivalTime:f,passengers:N})}}g=r.getSpan().firstText("What It Costs").nextTag("table3").innerCapture(/This total is for [0-9][\d]* Traveler\(s\) in (.*):/,1),l=r.getSpan().nextText("Grand Total:").nextTag("td4").tagContents().innerCapture(/([\d,.]+)/,1);for(var R=[],F=0;x.length>F;F++){var I=x[F];if(I.passengers)for(var k=Object.keys(I.passengers),D=0;k.length>D;D++){var z=I.passengers[k[D]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:z.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:z.seats[I.flightNumber]}},checkinUrl:a,reservationId:t,totalPrice:l,priceCurrency:g,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(z.membershipNumber)&&(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:z.membershipNumber,programName:"Frequent Flyer"}),R.push(schema)}}if(R.length)return R}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/112/309/310","SG5aee4c8a"),new ReverseTemplate("virginamerica.com-reservation-en",function(e){return/^Virgin America Reservation/.test(e.subject)},function(e){if(/^Virgin America Reservation/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,s,o,p,m,l,g,u,d,h,c,v,C,T,b,f,A,y,x=[],N={};if(t=r.getSpan().innerCapture(/\bYour Confirmation Code: ([A-Z]{6})/,1),a=t.nextLink(),u=r.getSpan().nextText("TOTAL").nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),i=r.getSpan().allInnerCapture(/Traveler \d{1,}:/),i.length)for(var $=0,S=i.length;S>$;$++)n=i[$][0].parentAnyTag("td").tagContents().innerCapture(/Traveler \d{1,}: (.*)/,1),h=n.parentTag("table3"),g=h.innerText("Frequent Flyer:").nextAnyTag("td").tagContents(),not(int(g))&&(g=null),s=h.innerText("Seats:").nextAnyTag("td").tagContents().innerCapture(/(.*?) </,1),s=s.split(" ").map(function(e){return/\d{1,2}[A-Z]/.test(""+e)?e:null}),N[""+n]={name:n,membershipNumber:g,totalPrice:u,seats:{},seatingType:{},seatList:s};var F=concatRegExp(/($<departureAirport>.+?) \(($<departureCode>[A-Z]{3})\) to /,/($<arrivalAirport>.+?) \(($<arrivalCode>[A-Z]{3})\)/);if(m=r.getSpan().allInnerCapture(F),m.length)for(var k=0,S=m.length;S>k;k++)if(p=m[k],T=p.$departureAirport,b=p.$departureCode,A=p.$arrivalAirport,y=p.$arrivalCode,o=p[0].nextText("Date:").nextTag("td4").tagContents(),not(o.innerDate())&&(o=o.innerCapture(/($<day>\d+)($<month>\D+)($<year>\d+)/),o&&(o=r.getDetachedSpan(""+o.$day+" "+o.$month+" "+o.$year))),o=o.innerDate(),c=p[0].nextText("Flight:").nextAnyTag("td").tagContents().innerCapture(/($<code>\w+) ($<flightNumber>\d+)/),v=c?c.$code:null,l=c?c.$flightNumber:null,valid(o)&&(C=combineDateAndTime(o,p[0].nextText("Depart:").nextDate()),f=combineDateAndTime(o,p[0].nextText("Arrive:").nextDate())),ASSERT(v,l,C,b,f,y)){i=Object.keys(N);for(var $=0;i.length>$;$++)N[i[$]].seats[""+l]=N[i[$]].seatList[x.length];x.push({airlineCode:v,flightNumber:l,departureTime:C,departureCode:b,departureAirport:T,arrivalTime:f,arrivalCode:y,arrivalAirport:A,passengers:N})}for(var D,R=[],k=0;x.length>k;k++){var I=x[k];if(I.passengers)for(var z=Object.keys(I.passengers),L=0;z.length>L;L++){var j=I.passengers[z[L]];D={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:I.airlineCode,flightNumber:I.flightNumber,departureAirportFuzzy:I.departureAirport,departureAirportCode:I.departureCode,departureTime:I.departureTime,arrivalAirportFuzzy:I.arrivalAirport,arrivalAirportCode:I.arrivalCode,arrivalTime:I.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},reservedTicket:{"@type":"http://schema.org/Ticket",ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[I.flightNumber]}},checkinUrl:a,reservationId:t,totalPrice:u,priceCurrency:d,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(j.membershipNumber)&&(D.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:"Frequent Flyer"}),R.push(D)}}if(R.length)return R}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/112/309/312","SGa2918905")]);