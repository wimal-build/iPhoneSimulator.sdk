// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,o,m,u,d,s=[];n=a.getSpan().nextText(r.passenger).nextTag("tr4").nextTag("tr4").nextTag("tr4").innerTag("td4").nextTag("td4").tagContents().innerCapture(regExpFormatted(/\.(.*)/),1).trim(),m=a.getDetachedSpan(e.subject).innerCapture(regExpFormatted(/(\w+)$/),1),u=a.getSpan().nextText(r.totalPayment).previousText(r.total).nextTag("td4").tagContents(),i=u.innerCapture(regExpFormatted(/([\d\.,\s]+)/),1).trim(),p=u.innerCapture(regExpFormatted(/([^\d\.,\s]+)/),1).trim(),g=m,d=a.getSpan().nextText(r.flightData).parentTag("table4").allInnerTagsFiltered("tr4");for(var l=1;d.length>l;l+=2){var T={},h=d[l],c=d[l+1];T.flightNumber=h.innerCapture(regExpFormatted(/\1 (.+?):/,r.number),1),T.departureAirport=c.nextTag("tr5").innerTag("td5").tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),T.departureTime=getFuzzyDate(a.getDetachedSpan(h.innerDate()+" "+c.firstDate())),T.arrivalAirport=c.nextTag("tr5").innerTag("td5").nextTag("td5").tagContents().innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),T.arrivalTime=a.getDetachedSpan(h.innerDate()+" "+c.firstDate().nextDate()),T.seatingNumber=c.innerCapture(regExpFormatted(/\1: (.+)/,r.seat),1),ASSERT(T.departureTime,T.arrivalTime,T.departureAirport,T.arrivalAirport,T.flightNumber)&&s.push(T)}for(var x=[],l=0;s.length>l;l++){var T=s[l],v={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Germanwings",airlineCode:"4U",flightNumber:T.flightNumber,departureAirportFuzzy:T.departureAirport,departureAirportCode:T.departureIata,departureTime:T.departureTime,arrivalAirportFuzzy:T.arrivalAirport,arrivalAirportCode:T.arrivalIata,arrivalTime:T.arrivalTime},underName:{"@type":"http://schema.org/Person",name:n},checkinUrl:o,reservationId:m,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:i,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:g,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:T.seatingType,seatNumber:T.seatingNumber}}};x.push(v)}return x.length?x:CONTINUE}}).call();