// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,n){if(!e||!t||!n)return CONTINUE;var r=Scanner.fromMessage(e);r.setLocale(t);var a,i,o,p,g,d,m,x,s,c,h,u,S,l,T;if("html"===n.version)p=r.getSpan().innerCapture(regExpFormatted(/\1 (\d+)/,n.confirmationNumber),1),s=getFuzzyDate(r.getSpan().nextText(n.checkin).withEnd(r.getSpan().nextText(n.checkout).getStart())),h=getFuzzyDate(r.getSpan().nextText(n.checkout).withEnd(r.getSpan().nextText(n.checkout).parentAnyTag("td").getEnd())),d=r.getSpan().nextText(n.modifyReservationUrl).nextLink(),m=d,u=r.getSpan().nextText(n.hotelUrl).nextLink(),g=r.getSpan().nextText(n.reservationDetails).withEnd(r.getSpan().nextText(n.summary).getStart()),S=g.innerCapture(regExpFormatted(/\1 (.*)\s/,n.hotelName),1),a=g.innerCapture(regExpFormatted(/\1 (.*)\s/,n.name),1),i=r.getSpan().nextText(n.totalPrice).nextTag("td1").tagContents(),o=r.getSpan().innerCapture(regExpFormatted(/\1 \(([A-Z]{2,3})/,n.priceCurrency),1),g=r.getSpan().withEnd(r.getSpan().nextTag("table1").getStart()),l=g.innerCapture(regExpFormatted(/\1 (.+?) \2/,n.phone,n.fax),1),valid(S,l,g)&&(T=g.withStart(S.getLength()).withEnd(g.innerText(n.phone).getStart()).trim(),g.innerAddress().getLength()>=T.getLength()&&(T=g.innerAddress()));else if("txt"===n.version&&(g=r.getSpan().nextText(n.reservationDetails).withEnd(r.getSpan().nextText(n.planningYourTrip).getStart()),valid(g))){p=g.innerCapture(regExpFormatted(/\1 (\d+)\n/,n.confirmationNumber),1),x=g.innerCapture(regExpFormatted(/\1 ($<date>.*) \(($<time>.*?)\)\n/,n.checkin)),x&&(s=combineDateAndTime(x.$date,x.$time)),c=g.innerCapture(regExpFormatted(/\1 ($<date>.*) \(($<time>.*?)\)\n/,n.checkout)),c&&(h=combineDateAndTime(c.$date,c.$time)),a=g.innerCapture(regExpFormatted(/\1 (.*)\n/,n.guestName),1).trim();var E=r.getSpan().innerCapture(regExpFormatted(/^($<name>.*)\n($<address>[^]+)\n\1 ($<phone>.*)\n/,n.phone));E&&(S=E.$name,T=E.$address,l=E.$phone),u=r.getSpan().nextText(n.hotelUrl).nextLink(),d=g.innerText(n.modifyUrl).nextLink(),m=d,i=g.innerCapture(regExpFormatted(/\1 .* - ([\d,.]+)/,n.totalPrice),1),o=g.innerCapture(regExpFormatted(/\1 \(([A-Z]{3})\)/,n.priceCurrency),1)}return ASSERT(s,h,T)?[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:a},totalPrice:i,priceCurrency:o,checkinTime:s,checkoutTime:h,modifyReservationUrl:d,cancelReservationUrl:m,reservationStatus:"http://schema.org/ReservationConfirmed",reservationId:p,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:S,url:u,telephone:l,address:T}}]:void 0}}).call();