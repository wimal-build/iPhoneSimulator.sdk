// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("travelocity.com-flight-cancellation-en",function(){return!1},function(e){return/^Your flight itinerary is canceled$/.test(e.subject)?STOP:void 0},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/617/621","SGdb24e27a"),new ReverseTemplate("travelocity.com-flight-confirmation-en",function(e){return/^Travelocity travel confirmation/.test(e.subject)},function(e){if(/Travelocity travel confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);if(t.setLocale("en_US"),t.getSpan().nextText("Airline Rules & Regulations").exists()){var r,n,a,i,o,s,l,c,p,u,g,m,d,h,T,v,f,C=[],x={};a=t.getSpan().nextText("Traveler Information").nextTag("table6").allInnerTags("tr6").map(function(e){return e.allInnerTagsFiltered("td6")}),i=t.getSpan().nextText("Price Summary").nextText("Total:").parentTag("td5").tagContents().innerCapture(/([\d,.]+)/,1),o=t.getSpan().nextText("All prices quoted in").parentTag("td5").tagContents().innerCapture(/All prices quoted in (.*)\./,1);for(var y=0;a.length>y;y++)a[y].length>=3&&(n=a[y][0].innerCapture(/(.*)\s/,1).trim(),g=a[y][1].innerCapture(/^(No frequent flyer details)/,1).exists()?null:a[y][1],x[""+n]={name:n,programName:"Frequent Flyer",membershipNumber:g,ticketNumber:a[y][2].innerCapture(/Ticket #\s+(\d+)/,1),totalPrice:i,priceCurrency:o,seats:{},seatingType:{}});p=t.getSpan().nextText("Traveler Information").parentTag("table5").allInnerTags("table6").map(function(e){return e.allInnerTags("td6").map(function(e){return e.tagContents()})});for(var b=1;p.length>b;b++){c=p[b],l=c[0].previousTag("td5").previousTag("td5").innerDate();for(var S=0;c.length>S;S++)if(r=c[S],r.innerCapture(/^([A-Z]{3})/))not(T)?(T=r.innerCapture(/([A-Z]{3})/,1),h=combineDateAndTime(l,r.innerDate())):(f=r.innerCapture(/([A-Z]{3})/,1),v=combineDateAndTime(l,r.innerDate()));else if(r.innerCapture(/^[A-Za-z ]+\s+\d+/))m=r.innerCapture(/^($<name>[A-Za-z ]+)\s+($<flightNumber>\d+)/),d=m?m.$name:null,u=m?m.$flightNumber:null,not(d)||(s=t.getSpan().nextText("Important Information").nextText(""+d).nextTag("td5").tagContents());else if(r.innerCapture(/^.* \| .*$/)&&(seatingType=r.innerCapture(/^(.*) \| .*$/,1),valid(u))){a=Object.keys(x);for(var y=0;a.length>y;y++)x[a[y]].seatingType[""+u]=seatingType}ASSERT(d,u,T,h,f,v)&&C.push({airlineName:d,flightNumber:u,reservationId:s,departureCode:T,departureTime:h,arrivalCode:f,arrivalTime:v,passengers:x}),m=d=u=T=h=f=v=seatingType=s=null}for(var N,k=[],b=0;C.length>b;b++)for(var A=C[b],$=Object.keys(A.passengers),R=0;$.length>R;R++){var I=A.passengers[$[R]];N={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:A.airlineName,airlineCode:A.airlineCode,flightNumber:A.flightNumber,departureAirportFuzzy:A.departureAirport,departureAirportCode:A.departureCode,departureTime:A.departureTime,arrivalAirportFuzzy:A.arrivalAirport,arrivalAirportCode:A.arrivalCode,arrivalTime:A.arrivalTime},underName:{"@type":"http://schema.org/Person",name:I.name},checkinUrl:A.checkinUrl,reservationId:A.reservationId,reservationStatus:"http://schema.org/Reservation"+(A.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:I.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:I.seats[A.flightNumber],seatingType:I.seatingType[A.flightNumber]}},totalPrice:I.totalPrice,priceCurrency:I.priceCurrency},not(I.membershipNumber)||(N.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:I.membershipNumber,programName:I.programName}),k.push(N)}if(k.length)return k}}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/617/622","SG6a22fa57"),new ReverseTemplate("travelocity.com-hotel-cancellation-en",function(e){return/^Travelocity Hotel Cancellation Confirmation/.test(e.subject)},function(e){if(/^Travelocity Hotel Cancellation Confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,l,c,p,u,g,m,d,h,T;if(r=t.getSpan().nextText("Reserved for").nextTag("td9").nextTag("td9").tagContents().innerCapture(/(.*)\s/,1).trim(),currentDate=t.getSpan().nextTag("table6").nextTag("td6").tagContents().innerCapture(/($<checkIn>\w+\/\d{1,2}\/\d{4}) - \w{3} ($<checkOut>\w+\/\d{1,2}\/\d{4})/),currentDate&&(p=t.getDetachedSpan((""+currentDate.$checkIn).split("/").join(" ")),u=t.getDetachedSpan((""+currentDate.$checkOut).split("/").join(" "))),a=t.getSpan().nextTag("table9").lastInnerTag("td9").tagContents(),g=a.innerCapture(/($<name>.*)\s+($<address>.*)/),d=g?g.$name:null,T=g?g.$address:null,a.innerAddress().getLength()>=T.getLength()&&(T=a.innerAddress()),s=t.getSpan().innerCapture(/Travelocity Itinerary number: (\d+)/,1),ASSERT(r,d,T,p,u))return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:n},totalPrice:i,priceCurrency:o,checkinTime:p,checkoutTime:u,modifyReservationUrl:l,cancelReservationUrl:c,reservationStatus:"http://schema.org/ReservationCancelled",reservationId:s,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:d,url:m,telephone:h,address:T}}]}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/617/623","SGbfb3515a"),new ReverseTemplate("travelocity.com-hotel-confirmation-en",function(e){return/^Travelocity travel confirmation/.test(e.subject)},function(e){if(/^Travelocity travel confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);if(t.setLocale("en_US"),t.getSpan().nextText("View hotel details").exists()){var r,n,a,i,o,s,l,c,p,u,g,m,d,h,T,v,f;if(d=t.getSpan().nextTag("table5").nextTag("td5").tagContents(),currentDate=d.nextTag("td5").tagContents().innerCapture(/($<checkIn>\w+\/\d{1,2}\/\d{4}) - \w{3} ($<checkOut>\w+\/\d{1,2}\/\d{4})/),currentDate&&(l=t.getDetachedSpan((""+currentDate.$checkIn).split("/").join(" ")),p=t.getDetachedSpan((""+currentDate.$checkOut).split("/").join(" "))),s=d.nextTag("td5").tagContents().innerCapture(/\bItinerary # (\d+)/,1),a=t.getSpan().nextText("View hotel details").parentTag("td8"),g=a.innerCapture(/\bView hotel details <($<hotelUrl>.*?)>\s+($<address>.*?) </),m=g?g.$hotelUrl:null,T=g?g.$address:null,a.innerAddress().getLength()>=T.getLength()&&(T=a.innerAddress()),h=a.innerPhoneNumber(),a=a.nextTag("table8"),a.innerText("Check-in time starts").exists()&&(c=combineDateAndTime(l,a.innerText("Check-in time starts").nextDate())),not(c)&&(c=l),not(u)&&(u=p),i=t.getSpan().nextText("Price Summary").nextText("Total").nextTag("td7").tagContents().innerCapture(/([\d,.]+)/,1),o=t.getSpan().innerCapture(/All prices quoted in (\w+)\./,1),r=t.getSpan().nextText("Reserved for").nextTag("td8").nextTag("td8").tagContents().innerCapture(/(.*)\s/,1),ASSERT(r,d,T,c,u))return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:n},totalPrice:i,priceCurrency:o,checkinTime:c,checkoutTime:u,modifyReservationUrl:v,cancelReservationUrl:f,reservationStatus:"http://schema.org/ReservationConfirmed",reservationId:s,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:d,url:m,telephone:h,address:T}}]}}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/617/624","SGe3435f47")]);