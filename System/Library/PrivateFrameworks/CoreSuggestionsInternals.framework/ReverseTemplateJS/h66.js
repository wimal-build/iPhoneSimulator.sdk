// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);if(a.setLocale(t),!a.getSpan().nextText(r.yourItinerary))return CONTINUE;var n;n=a.getSpan().nextText(r.bookingReferencePrefix).parentTag("td3").innerCapture(regExpFormatted(/\1 ($<bookingReference>\w{6})/,r.bookingReferencePrefix),1);var i,g,o=a.getSpan().next(r.pricePrefix).nextTag("td4").innerCapture(/($<currency>\w+) ($<price>[\d.,]+)/);o&&(i=o.$price,g=o.$currency);var p=[],x=n.nextText(r.passengersPrefix).parentTag("table4").allInnerTags("td4").filter(function(e){return e&&(""+e.tagContents().trim()).length>0});x=x.slice(1);for(var l=0;x.length>l;l++)p.push({name:x[l].tagContents().trim(),price:i,currency:g});for(var u=[],s=a.getSpan().nextText(r.flightNumberPrefix).parentTag("table5");s.exists()&&s.nextText(r.flightNumberPrefix).exists();){var c=s.nextText(r.flightNumberPrefix).nextTag("td5").tagContents(),m=c.innerCapture(/($<airlineCode>\w{2})($<flightNumber>\d{1,4})/),d=m.$airlineCode,f=m.$flightNumber,h=f.nextTag("td5").nextText(r.departureAirportPrefix).nextTag("td5").tagContents();r.terminal&&h&&(""+h).indexOf(r.terminal)>0&&(h=h.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var T=h.nextTag("td5").nextText(r.arrivalAirportPrefix).nextTag("td5").tagContents();r.terminal&&T&&(""+T).indexOf(r.terminal)>0&&(T=T.innerCapture(regExpFormatted(/(.*) \1/,r.terminal),1));var v,C=s.nextText(r.departureDatePrefix).nextTag("td5").tagContents().allDates();v=1===C.length?C[0]:a.getDetachedSpan(C.map(function(e){return e.trim()}).join("")).firstDate();var b,N=s.nextText(r.arrivalDatePrefix).nextTag("td5").tagContents().allDates();b=1===N.length?N[0]:a.getDetachedSpan(N.map(function(e){return e.trim()}).join("")).firstDate();var P=(s.nextText(r.cabinPrefix).nextTag("td5").tagContents(),s.nextText(r.airlineNamePrefix).nextTag("td5").tagContents());ASSERT(P,d,f,v,h,b,T)&&(u.push({airlineName:P,airlineCode:d,flightNumber:f,departureDate:v,departureAirport:h,arrivalDate:b,arrivalAirport:T,passengers:p}),P=d=f=v=h=b=T=null),s=s.nextTag("table5")}s=null;for(var y=a.getSpan().nextText(r.ticketNumberPrefix).nextTag("td4").tagContents().innerCapture(/([\d-]+)/,1),S=[],l=0;u.length>l;l++){s=u[l];for(var D=0;p.length>D;D++){var A=p[D],F={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:s.airlineName,airlineCode:s.airlineCode,flightNumber:s.flightNumber,departureAirportFuzzy:s.departureAirport,departureTime:s.departureDate,arrivalAirportFuzzy:s.arrivalAirport,arrivalTime:s.arrivalDate},underName:{"@type":"http://schema.org/Person",name:A.name},reservationId:n,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:A.price,priceCurrency:A.currency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:y,ticketedSeat:{"@type":"http://schema.org/Seat"}}};S.push(F)}}return S.length?S:void 0}}).call();