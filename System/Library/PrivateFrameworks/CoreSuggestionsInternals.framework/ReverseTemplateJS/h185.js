// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,o,p,s,m,l,g,d,c,h,u,v,T,x,f,C,y,b,A,S,N,k,F,P,R,I,E,D,U=[],$=[],z={},L=[],O=[];if(m=a.getSpan().innerCapture(regExpFormatted(/\b\1 (\d+)/,r.reservationId),1),s=a.getSpan().nextText(r.totalPrice).nextTag("td8").tagContents().innerCapture(/([\d,.]+)/,1),a.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).exists()){i=a.getSpan().innerCapture(regExpFormatted(/\1 (.*)\s/,r.flight.names),1),i=i.split(", ");for(var M=0,j=i.length;j>M;M++)z[""+i[M]]={name:i[M],seats:{},seatingType:{},totalPrice:s};if(Object.keys(z).length){p=a.getSpan().nextRegExp(regExpFormatted(/\1/,r.flight.names)).previousAnyTag("table"),o=p.getTagNumber(),p=p.nextTag("table"+o),p.innerText(r.taxes).exists()&&(p=p.nextTag("table"+o)),p=p.allInnerTags("tr"+o).map(function(e){return e.allInnerTagsFiltered("td"+o)}).filter(function(e){return e.length>=4});for(var M=0,j=p.length;j>M;M++)g=p[M],d=g[0].innerCapture(regExpFormatted(/($<departureAirport>.*) \(($<departureCode>[A-Z]{3})\) \1 ($<arrivalAirport>.*) \(($<arrivalCode>[A-Z]{3})\)/,r.flight.to)),d&&(T=d.$departureAirport,x=d.$departureCode,C=d.$arrivalAirport,y=d.$arrivalCode),l=g[1].innerDate(),times=a.getDateDD(g[2].innerDate()),times.endIso8601&&(v=combineDateAndTime(l,times.iso8601),f=combineDateAndTime(l,times.endIso8601)),c=g[3].innerCapture(/($<name>.*) ($<flightNumber>\w+)/),h=c?c.$name:null,u=c?c.$flightNumber:null,ASSERT(h,u,v,x,f,y)&&$.push({airlineName:h,flightNumber:u,reservationId:m,departureAirport:T,departureCode:x,departureTime:v,arrivalAirport:C,arrivalCode:y,arrivalTime:f,passengers:z})}}if(a.getSpan().nextText(r.hotel.name).exists()){n=a.getSpan().innerCapture(regExpFormatted(/\b\1 (.*) -/,r.hotel.name),1),not(s)&&(s=a.getSpan().nextText(r.hotel.totalPrice).nextTag("td8").tagContents().innerCapture(/([\d,.]+)/,1)),p=n.nextAnyTag("table"),o=p.getTagNumber(),p.innerText(r.taxes).exists()&&(p=p.nextTag("table"+o)),p=p.allInnerTagsFiltered("td"+o),S=p[0],k=s.nextTag("table7").innerAddress(),N=s.nextTag("table7").innerPhoneNumber();for(var Z,w="",B=1;p.length>B;B++)if(p[B].innerCapture(regExpFormatted(/^\1/,r.hotel.telephone))){for(var q=B-1;q>0;q--)w=p[q]+"\n"+w;(not(k)||w.length>k.getLength())&&(k=w),Z=p[B].innerCapture(regExpFormatted(/^\1 (.*)/,r.hotel.telephone),1),valid(Z)&&(not(N)||valid(N)&&Z.getLength()>N.getLength())&&(N=Z)}else p[B].innerCapture(regExpFormatted(/^\1/,r.hotel.checkin))?b=p[B].innerDate():p[B].innerCapture(regExpFormatted(/^\1/,r.hotel.checkout))&&(A=p[B].innerDate());ASSERT(k,b,A)&&L.push({name:n,reservationId:m,totalPrice:s,hotelName:S,hotelAddress:k,hotelPhone:N,checkInDateTime:b,checkOutDateTime:A})}a.getSpan().nextText(r.car.name).exists()&&(n=a.getSpan().nextText(r.car.name).parentAnyTag("td").innerCapture(regExpFormatted(/\b\1 (.*)\s/,r.car.name),1),s=a.getSpan().nextText(r.car.totalPrice).nextAnyTag("td").tagContents().innerCapture(/([\d,.]+)/,1),P=a.getSpan().nextText(r.car.provider).parentAnyTag("td").tagContents().innerCapture(regExpFormatted(/\1 (.*?),/,r.car.provider),1),F=a.getSpan().nextText(r.car.totalPrice).nextTag("table7").allInnerTagsFiltered("td7")[0],D=getFuzzyDate(a.getSpan().nextText(r.car.pickup).parentAnyTag("td")),E=a.getSpan().nextText(r.car.pickup).parentAnyTag("td").tagContents().innerCapture(/(.*)$/,1),I=getFuzzyDate(a.getSpan().nextText(r.car.dropoff).parentAnyTag("td")),R=a.getSpan().nextText(r.car.dropoff).parentAnyTag("td").tagContents().innerCapture(/(.*)$/,1),ASSERT(n,D,E,F,P)&&O.push({name:n,reservationId:m,totalPrice:s,pickupTime:D,pickupAddress:E,dropoffTime:I,dropoffAddress:R,brand:F,provider:P}));for(var G,H,M=0;$.length>M;M++){H=$[M];for(var J=Object.keys(H.passengers),K=0;J.length>K;K++){var Q=H.passengers[J[K]];G={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:H.airlineName,airlineCode:H.airlineCode,flightNumber:H.flightNumber,departureAirportFuzzy:H.departureAirport,departureAirportCode:H.departureCode,departureTime:H.departureTime,arrivalAirportFuzzy:H.arrivalAirport,arrivalAirportCode:H.arrivalCode,arrivalTime:H.arrivalTime},underName:{"@type":"http://schema.org/Person",name:Q.name},checkinUrl:H.checkinUrl,reservationId:H.reservationId,reservationStatus:"http://schema.org/Reservation"+(H.reservationStatus||"Confirmed"),totalPrice:Q.totalPrice,priceCurrency:Q.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:Q.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:Q.seats[H.flightNumber],seatingType:Q.seatingType[H.flightNumber]}}},valid(Q.membershipNumber,Q.programName)&&(G.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:Q.membershipNumber,programName:Q.programName}),U.push(G)}}for(var V,M=0;O.length>M;M++)V=O[M],G={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:V.totalPrice,priceCurrency:V.priceCurrency,reservationId:V.reservationId,reservationStatus:"http://schema.org/Reservation"+(V.reservationStatus||"Confirmed"),checkinUrl:V.checkinUrl,modifyReservationUrl:V.modifyReservationUrl,cancelReservationUrl:V.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:V.name,email:V.email},provider:{"@type":"http://schema.org/Organization",name:V.provider},pickupTime:V.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:V.pickupName,telephone:V.pickupTelephone,address:V.pickupAddress},dropoffTime:V.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:V.dropoffName,telephone:V.dropoffTelephone,address:V.dropoffAddress}},V.brand&&(G.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:V.brand},license:V.license,color:V.color}),U.push(G);for(var W,M=0;L.length>M;M++)W=L[M],G={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:W.name,email:W.email},totalPrice:W.totalPrice,priceCurrency:W.priceCurrency,checkinTime:W.checkInDateTime,checkoutTime:W.checkOutDateTime,modifyReservationUrl:W.modifyReservationUrl,cancelReservationUrl:W.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(W.reservationStatus||"Confirmed"),reservationId:W.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:W.hotelName,url:W.hotelUrl,telephone:W.hotelPhone,address:W.hotelAddress}},U.push(G);return U.length?U:void 0}}).call();