// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){if(int(e.epoch)<1356998400)return STOP;var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,l,p,o,m,s,u,g,c,h,d,v,f,b,T,y,C,N,A,x=[],F={};i=a.getSpan().innerCapture(regExpFormatted(/\1 (.*?)\s/,t.bookingReference),1),t.checkinUrl&&(l=a.getSpan().nextText(t.checkinUrl).nextLink()),d=a.getSpan().innerCapture(regExpFormatted(/\1 ($<priceCurrency>[A-Z]{3}) ($<totalPrice>[\d,. ]+)/,t.totalFare));var S=d?d.$totalPrice.trim():null,k=d?d.$priceCurrency:null;o=a.getSpan().nextText(t.passengers).nextTag("table4").allInnerTags("tr4").map(function(e){return e.allInnerTagsFiltered("td4")}).filter(function(e){return e.length>=4});for(var $=0;o.length>$;$++){f=o[$],p=f[0],F[""+p]={name:p,seats:{},seatingType:{},programName:"Frequent Flyer",membershipNumber:""+f[1]!=t.NA&&f[1]||null,totalPrice:S,priceCurrency:k},s=f[3].split("\n");for(var D,P=0;s.length>P;P++)D=s[P].split("/ "),m=D[1]&&D[1].innerCapture(/(\d+[A-Z])/,1),valid(m)&&(F[""+p].seats[""+D[0]]=m)}c=a.getSpan().nextText(t.itineraryDetails).nextTag("table4").allInnerTags("tr4").map(function(e){return e.allInnerTagsFiltered("td4")}).filter(function(e){return e.length>=8});for(var z=0;c.length>z;z++){g=c[z],u=g[0].innerDate(),b=g[1].innerCapture(/($<code>\D+)($<flightNumber>\d+)/),T=b?b.$code:null,h=b?b.$flightNumber:null,C=g[3].innerCapture(/([A-Z]{3}) </,1),y=combineDateAndTime(u,g[3].innerDate()),A=g[4].innerCapture(/([A-Z]{3}) </,1),v=g[4].innerCapture(/(\+1)$/,1).exists(),v&&(u=modifyDate(u,1)),N=combineDateAndTime(u,g[4].innerDate());var I=g[g.length-1];if(valid(h,I)){o=Object.keys(F);for(var $=0;o.length>$;$++)F[""+o[$]].seatingType[""+h]=I}ASSERT(T,h,y,C,N,A)&&x.push({airlineCode:T,flightNumber:h,departureTime:y,departureCode:C,arrivalTime:N,arrivalCode:A,passengers:F})}for(var R=[],z=0;x.length>z;z++)for(var U=x[z],Z=Object.keys(U.passengers),E=0;Z.length>E;E++){var M=U.passengers[Z[E]],O={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:U.airlineName,airlineCode:U.airlineCode,flightNumber:U.flightNumber,departureAirportFuzzy:U.departureAirport,departureAirportCode:U.departureCode,departureTime:U.departureTime,arrivalAirportFuzzy:U.arrivalAirport,arrivalAirportCode:U.arrivalCode,arrivalTime:U.arrivalTime},underName:{"@type":"http://schema.org/Person",name:M.name},checkinUrl:l,reservationId:i,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:M.totalPrice,priceCurrency:M.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:n,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:M.seats[""+U.airlineCode+(""+U.flightNumber)],seatingType:M.seatingType[U.flightNumber]}}};valid(M.membershipNumber,M.programName)&&(O.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:M.membershipNumber,programName:M.programName}),R.push(O)}return R.length?R:void 0}}).call();