// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("ticketmaster.com-1",function(e){return/^Your/.test(e.subject)||/^Event Reminder/.test(e.subject)?!0:void 0},function(e){if(/ticketmaster\.ca/.test(e.plain)||/^Your Ticketmaster Order for/.test(e.subject))return CONTINUE;if(/your ticket/i.test(e.subject)||/^Event Reminder/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,s,i,c,o,p,u,d,m,g,S,h,$,b,l;if(startsWith(e.subject,"Event Reminder"))r=t.getSpan().innerCapture(/Hi (.*?)[.,]/,1),m=r.nextLink(),d=m.parentAnyTag("td").tagContents().innerCapture(/\b(.*) <.*?>/,1),g=t.getSpan().nextText("When:").nextDate(),not(g)&&(g=getFuzzyDate(d.nextTag("table3"))),l=t.getSpan().nextText("Where:").nextTag("td7").tagContents().innerCapture(/\b($<place>.*) <(?:.*)>\s($<address>[\s\S]+?)</),l&&($=l.$place,b=g.nextAddress(),(""+b).length<(""+l.$address.trim()).length&&(b=l.$address.trim())),not(b)&&(b=d.nextTag("table3").nextTag("table3").innerAddress(),$=b.parentTag("td3").tagContents().innerCapture(/\b(.*) <.*?>/,1)),i=t.getSpan().nextText("View Your Tickets").nextLink();else if(startsWith(e.subject,"Your Ticketmaster Order")){s=t.getSpan().innerCapture(/Your order number for this purchase is (.*?)\./,1);var x=["PRINT YOUR TICKETS","Print my tickets"];for(var v in x)if(t.getSpan().nextText(x[v]).exists()){i=t.getSpan().innerCapture(RegExp(regExpEscape(x[v])+" <(.*)>"),1);break}i||(i=t.getSpan().innerCapture(/Show complete order detail <(.*)>/,1)),g=t.getSpan().nextRegExp(/You purchased (.*) to:/).nextDate();var T=RegExp("You purchased ($<numSeats>.*) to:(?:[\\s_]+)\\b($<eventName>.*)\\s\\b($<address>.*)\\s(?:[\\s\\S]+)\\bOrder for: ($<name>.*)\\s\\bSeat location:(?: section ($<seatSection>.*?),?)?(?: row ($<seatRow>.*?),?)?(?: seats ($<seat>.*?))?\\s\\bTotal Charge: ($<priceCurrency>\\w+)?(.*?)($<price>[\\d.,]+)\\s");l=t.getSpan().innerCapture(T),l&&(c=l.$numSeats,d=l.$eventName,b=l.$address,r=l.$name,u=l.$seatSection,p=l.$seatRow,o=l.$seat,n=l.$price,a=l.$priceCurrency)}else{if(!startsWith(e.subject,"Your tickets have been printed!"))return CONTINUE;r=t.getSpan().innerCapture(/Hello (\w+),/,1),s=t.getSpan().innerCapture(/Order Number: (.*)\s/,1),g=s.nextDate(),b=g.nextAddress(),l=g.super(b),l=l.innerCapture(/\b($<eventName>.*) <($<eventUrl>.*)>/),l&&(d=l.$eventName,m=l.$eventUrl)}if(ASSERT(g,d))return[{"@context":"http://schema.org","@type":"http://schema.org/EventReservation",name:r,totalPrice:n,priceCurrency:a,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:s,ticketToken:i,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:o,seatRow:p,seatSection:u}},reservationFor:{"@type":"http://schema.org/Event",eventStatus:"http://schema.org/EventConfirmed",name:d,url:m,startDate:g,endDate:S,location:{"@type":"http://schema.org/Place",name:$,telephone:h,address:b}}}]}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/779/827/831","SGa43ce21a")]);