// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline.com-itinerary-2012-2013-en",function(e){return/^Your( priceline(?:\.com)?)? [Ii]tinerary for/.test(e.subject)||/^priceline\.com Hotel Confirmation for/.test(e.subject)},function(e){if(/^Your( priceline(?:\.com)?)? [Ii]tinerary for/.test(e.subject)||/^priceline\.com Hotel Confirmation for/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,m,l,g,c,h,d,u,T,f,C,v,x,y,b,N,S,$,k,R,A,I,P,D=[],F=[],U={},L=[],O=[];if(t.getSpan().nextText("Flight Confirmation").exists()){a=t.getSpan().nextText("AIRLINE CONFIRMATION").parentTag("td3").tagContents();for(var E,z={},j=/\s\b($<name>.*): ($<code>.*)/;a.innerCapture(j);)E=a.innerCapture(j),z[""+E.$name]=E.$code,a=a.withStart(E.$code.getEnd());d=t.getSpan().innerCapture(/\bAIRLINE CONFIRMATION #\s+($<name>.*): ($<confirmation>.*)\s/),p=d?d.$confirmation:null,u=d?d.$name:null,i=t.getSpan().nextText("Total Trip Cost:").nextTag("td3").tagContents(),o=i.innerCapture(/([\d,.]+)/,1);var w=i.nextTag("td3").tagContents().innerCapture(/\(All prices are in (.*)\)/,1);if(n=t.getSpan().nextText("Passenger and Ticket Information").parentTag("table4").allInnerTags("tr4").map(function(e){return e.allInnerTags("td4").map(function(e){return e.tagContents()})}).filter(function(e){return 3==e.length}).slice(1),n.length)for(var M,H=0,Y=n.length;Y>H;H++)if(r=n[H][0].innerCapture(/($<name>.*)\s?(?:($<programName>.*)\s?-\s?($<membershipNumber>\d+))?/)){l={},M=n[H][1].split(/\n/);for(var Z,G=0;M.length>G;G++)Z=M[G].innerCapture(/\bFlight ($<flightNumber>\d+): ($<seat>.*)/),Z&&(l[""+Z.$flightNumber]=Z.$seat);U[""+r.$name]={name:""+r.$name,programName:r.$programName,membershipNumber:r.$membershipNumber,totalPrice:o,currency:w,seats:l,seatingType:{}}}c=t.getSpan().nextText("Flight Details").parentTag("table4").allInnerTagsFiltered("td4");var B=/^Leaving\s+.*\s+at\s+.*\s+on\s+(.*)/,_=/($<name>.*)\s+Flight\s+($<flightNumber>\d+)/,q=/($<airport>.*)\s+\(($<code>[A-Z]{3})\)\s+.*\s+($<time>.*)(?:\s+($<nextDay>.*)\s+\(Overnight Flight\))?/;if(c.length)for(var J,H=0;J=c[H];H++)if(J.innerCapture(B))g=J.innerCapture(B,1);else if(J.innerCapture(_)&&c[H+3]){d=J.innerCapture(_),u=d.$name,h=d.$flightNumber,T=c[H+1].innerCapture(q),T&&(C=T.$airport,v=T.$code,f=t.getDetachedSpan(""+g+" "+T.$time).innerDate()),x=c[H+2].innerCapture(q),x&&(b=x.$airport,N=x.$code,x.$nextDay.exists()&&(g=x.$nextDay),y=t.getDetachedSpan(""+g+" "+x.$time).innerDate());var K=c[H+3].innerCapture(/\d{1,2}h\s+\d{1,2}m\s+(.*)/,1);if(K&&h.exists()){n=Object.keys(U);for(var G=0;n.length>G;G++)U[n[G]].seatingType[""+h]=K}ASSERT(f,v,y,N,h,u)&&(F.push({airlineName:u,flightNumber:h,departureAirport:C,departureTime:f,departureCode:v,arrivalAirport:b,arrivalTime:y,arrivalCode:N,passengers:U}),d=u=h=T=C=f=v=x=b=y=N=null)}}if(t.getSpan().nextRegExp(/Your (.*?) Hotel Confirmation/).exists()){S=t.getSpan().nextText("Check-In").nextDate(),$=t.getSpan().nextText("Check-Out").nextDate();var Q=$.parentTag("table4"),a=Q.allInnerTagsFiltered("td4");a.length>=3&&(A=a[0],k=a[2].innerCapture(/^.*\s($<address>[\s\S]+)\s($<phoneNumber>.*)$/),P=k?k.$address.trim():null,I=k?k.$phoneNumber.trim():null,(not(P)||Q.innerAddress().getLength()>=P.getLength())&&(P=Q.innerAddress()),not(I)&&(I=k.innerPhoneNumber())),R=t.getSpan().nextText("view my itinerary").parentTag("td3").innerLink(),a=t.getSpan().nextText("Reservation Name").nextTag("td5").tagContents().innerCapture(/($<name>.*),\s+Confirmation #: ($<reservationId>[\S]+)/),r=a?a.$name:null,p=a?a.$reservationId:null,i=t.getSpan().nextRegExp(/Total (?:Charged to Card|Room Cost):/).nextTag("td3").tagContents().innerCapture(/($<totalPrice>[\d,.]+)\s?\(($<priceCurrency>[A-Z]{3})?\)/),i&&(o=i.$totalPrice,s=i.$priceCurrency),ASSERT(S,$,P)&&L.push({name:r,reservationId:p,totalPrice:o,priceCurrency:s,checkInDateTime:S,checkOutDateTime:$,hotelName:A,hotelUrl:R,hotelPhone:I,hotelAddress:P})}for(var H=0;F.length>H;H++)for(var V=F[H],W=Object.keys(V.passengers),G=0;W.length>G;G++){var X=V.passengers[W[G]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:V.airlineName,flightNumber:V.flightNumber,departureAirportFuzzy:V.departureAirport,departureAirportCode:V.departureCode,departureTime:V.departureTime,arrivalAirportFuzzy:V.arrivalAirport,arrivalAirportCode:V.arrivalCode,arrivalTime:V.arrivalTime},underName:{"@type":"http://schema.org/Person",name:X.name},checkinUrl:m,reservationId:z[V.airlineName],reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:X.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:X.seats[V.flightNumber],seatingType:X.seatingType[V.flightNumber]}},totalPrice:X.totalPrice,priceCurrency:X.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(X.membershipNumber)||(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:X.membershipNumber,programName:X.programName}),D.push(schema)}for(var et,H=0;O.length>H;H++)et=O[H],schema={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:et.totalPrice,priceCurrency:et.priceCurrency,reservationId:et.reservationId,reservationStatus:"http://schema.org/Reservation"+(et.reservationStatus||"Confirmed"),checkinUrl:et.checkinUrl,modifyReservationUrl:et.modifyReservationUrl,cancelReservationUrl:et.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:et.name,email:et.email},provider:{"@type":"http://schema.org/Organization",name:et.provider},pickupTime:et.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:et.pickupName,telephone:et.pickupTelephone,address:et.pickupAddress},dropoffTime:et.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:et.dropoffName,telephone:et.dropoffTelephone,address:et.dropoffAddress}},et.brand&&(schema.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:et.brand},license:et.license,color:et.color}),D.push(schema);for(var k,H=0;L.length>H;H++)k=L[H],schema={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:k.name,email:k.email},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency,checkinTime:k.checkInDateTime,checkoutTime:k.checkOutDateTime,modifyReservationUrl:k.modifyReservationUrl,cancelReservationUrl:k.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(k.reservationStatus||"Confirmed"),reservationId:k.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:k.hotelName,url:k.hotelUrl,telephone:k.hotelPhone,address:k.hotelAddress}},D.push(schema);if(D.length)return D}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/611/613","SG774e0d4a"),new ReverseTemplate("priceline.com-itinerary-2013-2014-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){if(/^Your priceline itinerary for/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,m,l,g,c,h,d,u,T,f,C,v,x,y,b,N,S,$,k,R,A,I,P,D,F,U,L,O,E,z,j,w,M,H,Y,Z,G=[],B=[],_={},q=[],J=[];if(t.getSpan().nextText("Flight Confirmation").exists()){o=t.getSpan().nextText("Total Charges").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1);var K=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1);if(a=t.getSpan().nextText("Passenger Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),a.length)for(var Q=0,V=a.length;V>Q;Q+=3)n=a[Q][1],not(n)||(_[""+n]={name:""+n,totalPrice:s,currency:K,seats:{},seatingType:{}});if(h=t.getSpan().nextText("Flight Details").parentTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3}),h.length)for(var W,Q=0;W=h[Q];Q++)if(""+W[0]=="Departing")i=W[0].withStart(W[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,b=i?i.$arrivalCode:null,C=W[1],f=W[2].innerDate();else if(""+W[0]=="Arriving")y=W[1],x=W[2].innerDate();else if(""+W[0]=="Flight / Class"){if(u=W[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),T=u?u.$name:null,d=u?u.$flightNumber:null,c=W[2],m=W[3]&&W[3].innerCapture(/Conf Number: (.*)/,1),valid(d,c)){a=Object.keys(_);for(var n,X=0;n=a[X];X++)_[n].seatingType[""+d]=c}ASSERT(T,d,C,f,v,y,x,b)&&(B.push({airlineName:T,flightNumber:d,departureAirport:C,departureCode:v,departureTime:f,arrivalAirport:y,arrivalTime:x,arrivalCode:b,reservationId:m,passengers:_}),u=T=d=C=f=v=y=x=b=m=null)}}if((t.getSpan().nextText("Hotel Reservation Confirmation").exists()||t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists())&&(t.getSpan().nextText("Hotel Reservation Confirmation").exists()?(n=t.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),m=t.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=t.getSpan().nextText("Hotel Reservation Confirmation"),R=i.nextTag("td9").tagContents(),$=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),A=$.innerPhoneNumber(),I=$.tagContents(),A.exists()&&(I=I.withEnd(A.getStart()).trim()),$.innerAddress().getLength()>=I.getLength()&&(I=$.innerAddress()),N=i.nextText("Check-In").nextTag("td11").innerDate(),S=i.nextText("Check-Out").nextTag("td11").innerDate(),s=t.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&(n=t.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),m=t.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),R=t.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),$=R.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),I=$?$.$address:null,A=$?$.$phone:null,N=t.getSpan().nextText("Check-In").nextDate(),S=t.getSpan().nextText("Check-Out").nextDate()),ASSERT(N,S,I)&&q.push({name:n,reservationId:m,totalPrice:s,priceCurrency:p,checkInDateTime:N,checkOutDateTime:S,hotelName:R,hotelUrl:k,hotelPhone:A,hotelAddress:I})),t.getSpan().nextText("Rental Car Confirmation").exists()){if(w=t.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),w.length>=3&&(Z=w[0].innerDate(),M=w[1].tagContents(),H=t.getDetachedSpan(w.slice(2).join(" ")),H.innerAddress().getLength()>=H.getLength()&&(H=H.innerAddress())),L=t.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(j=L[0].innerDate(),O=L[1].tagContents(),E=t.getDetachedSpan(L.slice(2).join(" ")),E.innerAddress().getLength()>=E.getLength()&&(E=E.innerAddress())),n=t.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),m=t.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),P=t.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),D=t.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),m.exists()&&(U=t.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+m),1),U.exists())){var et=t.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();F=et.innerCapture(regExpFormatted(/\1 (.*)$/,""+U),1),F.exists()||(F=et.withStart(et.next("\n").getEnd()))}s=t.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(Z,U,m,OR(H,M))&&J.push({name:n,brand:F,pickupTime:Z,pickupName:M,pickupAddress:H,pickupTelephone:Y,dropoffTime:j,dropoffName:O,dropoffAddress:E,dropoffTelephone:z,provider:U,reservationId:m,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:P,cancelReservationUrl:D})}for(var Q=0;B.length>Q;Q++)for(var tt=B[Q],rt=Object.keys(tt.passengers),nt=0;rt.length>nt;nt++){var at=tt.passengers[rt[nt]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:tt.airlineName,flightNumber:tt.flightNumber,departureAirportFuzzy:tt.departureAirport,departureAirportCode:tt.departureCode,departureTime:tt.departureTime,arrivalAirportFuzzy:tt.arrivalAirport,arrivalAirportCode:tt.arrivalCode,arrivalTime:tt.arrivalTime},underName:{"@type":"http://schema.org/Person",name:at.name},checkinUrl:g,reservationId:tt.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:at.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:at.seats[tt.flightNumber],seatingType:at.seatingType[tt.flightNumber]}},totalPrice:at.totalPrice,priceCurrency:at.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(at.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:at.membershipNumber,programName:at.programName}),G.push(r)}for(var it,Q=0;J.length>Q;Q++)it=J[Q],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:it.totalPrice,priceCurrency:it.priceCurrency,reservationId:it.reservationId,reservationStatus:"http://schema.org/Reservation"+(it.reservationStatus||"Confirmed"),checkinUrl:it.checkinUrl,modifyReservationUrl:it.modifyReservationUrl,cancelReservationUrl:it.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:it.name,email:it.email},provider:{"@type":"http://schema.org/Organization",name:it.provider},pickupTime:it.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:it.pickupName,telephone:it.pickupTelephone,address:it.pickupAddress},dropoffTime:it.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:it.dropoffName,telephone:it.dropoffTelephone,address:it.dropoffAddress}},it.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:it.brand},license:it.license,color:it.color}),G.push(r);for(var $,Q=0;q.length>Q;Q++)$=q[Q],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:$.name,email:$.email},totalPrice:$.totalPrice,priceCurrency:$.priceCurrency,checkinTime:$.checkInDateTime,checkoutTime:$.checkOutDateTime,modifyReservationUrl:$.modifyReservationUrl,cancelReservationUrl:$.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+($.reservationStatus||"Confirmed"),reservationId:$.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:$.hotelName,url:$.hotelUrl,telephone:$.hotelPhone,address:$.hotelAddress}},G.push(r);if(G.length)return G}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/611/614","SGe9f7c8a6")]);