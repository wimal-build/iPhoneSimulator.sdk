// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline.com-itinerary-2013-2014-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var n=e.innerAddress();if(n.getLength()>0)for(var r=n.split(" ")[0],a=1;t.length>a;a++)if((""+t[a]).split(" ")[0]===""+r){e=n;break}return""+e}var n=Scanner.fromMessage(e);if(n.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var r,a,i,o,s,p,g,l,m,c,u,d,h,x,T,f,C,v,b,S,y,N,k,A,R,I,P,D,U,F,$,E,O,L,Z,z,j,w,G,H,M,Y,B,_=[],q=[],J=[],K={},Q=[],V=[];if(n.getSpan().nextText("time to pack your bags").exists())N=!0,a=n.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1),K[""+a]={name:""+a,totalPrice:null,currency:null,seats:{},seatingType:{}},d=n.getSpan().nextText("Departing").parentTag("table7").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{o=n.getSpan().nextText("Total Charges").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1);var c=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1);if(q=n.getSpan().nextText("Passenger Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),q.length)for(var W=0,X=q.length;X>W;W+=3)a=q[W][1],not(a)||(K[""+a]={name:""+a,totalPrice:s,currency:c,seats:{},seatingType:{}});d=n.getSpan().nextText("Flight Details").parentTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(d.length)for(var et,W=0;et=d[W];W++)if(""+et[0]=="Departing")i=et[0].withStart(et[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,y=i?i.$arrivalCode:null,C=et[1],f=et[2].innerDate();else if(""+et[0]=="Arriving")S=et[1],b=et[2].innerDate();else if(""+et[0]=="Flight / Class"||""+et[0]=="Airline / Flight"){if(x=et[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),T=x?x.$name:null,h=x?x.$flightNumber:null,N?(u=null,g=et[2]&&et[2].innerCapture(/Conf Number: (.*)/,1)):(u=et[2],g=et[3]&&et[3].innerCapture(/Conf Number: (.*)/,1)),valid(h)){q=Object.keys(K);for(var a,tt=0;a=q[tt];tt++)K[a].seatingType[""+h]=u}ASSERT(T,h,C,f,v,S,b,y)&&(J.push({airlineName:T,flightNumber:h,departureAirport:C,departureCode:v,departureTime:f,arrivalAirport:S,arrivalTime:b,arrivalCode:y,reservationId:g,passengers:K}),x=T=h=C=f=v=S=b=y=g=null)}if(!n.getSpan().nextText("Hotel Reservation Confirmation").exists()&&!n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(n.getSpan().nextText("Hotel Reservation Confirmation").exists()?(a=n.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),g=n.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=n.getSpan().nextText("Hotel Reservation Confirmation"),P=i.nextTag("td9").tagContents(),R=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),D=R.innerPhoneNumber(),U=R.tagContents(),D.exists()&&(U=U.withEnd(D.getStart()).trim()),R.innerAddress().getLength()>=U.getLength()&&(U=R.innerAddress()),k=i.nextText("Check-In").nextTag("td11").innerDate(),A=i.nextText("Check-Out").nextTag("td11").innerDate(),s=n.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):n.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!n.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(a=n.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),g=n.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),P=n.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),R=P.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),U=R?R.$address:null,D=R?R.$phone:null,k=n.getSpan().nextText("Check-In").nextDate(),A=n.getSpan().nextText("Check-Out").nextDate()),ASSERT(k,A,U)&&Q.push({name:a,reservationId:g,totalPrice:s,priceCurrency:p,checkInDateTime:k,checkOutDateTime:A,hotelName:P,hotelUrl:I,hotelPhone:D,hotelAddress:U})),n.getSpan().nextText("Rental Car Confirmation").exists()){if(G=n.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),G.length>=3&&(B=G[0].innerDate(),H=G[1].tagContents(),M=n.getDetachedSpan(G.slice(2).join(" ")),M=t(M,G)),L=n.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(w=L[0].innerDate(),Z=L[1].tagContents(),z=n.getDetachedSpan(L.slice(2).join(" ")),z=t(z,L)),a=n.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),g=n.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),F=n.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),$=n.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),g.exists()&&(O=n.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+g),1),O.exists())){var nt=n.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();E=nt.innerCapture(regExpFormatted(/\1 (.*)$/,""+O),1),E.exists()||(""+nt).match(/\n/)&&(E=nt.withStart(nt.next("\n").getEnd()))}s=n.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(B,O,g,OR(M,H))&&V.push({name:a,brand:E,pickupTime:B,pickupName:H,pickupAddress:M,pickupTelephone:Y,dropoffTime:w,dropoffName:Z,dropoffAddress:z,dropoffTelephone:j,provider:O,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:F,cancelReservationUrl:$})}for(var W=0;J.length>W;W++)for(var rt=J[W],at=Object.keys(rt.passengers),it=0;at.length>it;it++){var ot=rt.passengers[at[it]];r={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:rt.airlineName,flightNumber:rt.flightNumber,departureAirportFuzzy:rt.departureAirport,departureAirportCode:rt.departureCode,departureTime:rt.departureTime,arrivalAirportFuzzy:rt.arrivalAirport,arrivalAirportCode:rt.arrivalCode,arrivalTime:rt.arrivalTime},underName:{"@type":"http://schema.org/Person",name:ot.name},checkinUrl:m,reservationId:rt.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:ot.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:ot.seats[rt.flightNumber],seatingType:ot.seatingType[rt.flightNumber]}},totalPrice:ot.totalPrice,priceCurrency:ot.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(ot.membershipNumber)||(r.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:ot.membershipNumber,programName:ot.programName}),_.push(r)}for(var st,W=0;V.length>W;W++)st=V[W],r={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:st.totalPrice,priceCurrency:st.priceCurrency,reservationId:st.reservationId,reservationStatus:"http://schema.org/Reservation"+(st.reservationStatus||"Confirmed"),checkinUrl:st.checkinUrl,modifyReservationUrl:st.modifyReservationUrl,cancelReservationUrl:st.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:st.name,email:st.email},provider:{"@type":"http://schema.org/Organization",name:st.provider},pickupTime:st.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:st.pickupName,telephone:st.pickupTelephone,address:st.pickupAddress},dropoffTime:st.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:st.dropoffName,telephone:st.dropoffTelephone,address:st.dropoffAddress}},st.brand.exists()&&(r.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:st.brand},license:st.license,color:st.color}),_.push(r);for(var R,W=0;Q.length>W;W++)R=Q[W],r={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:R.name,email:R.email},totalPrice:R.totalPrice,priceCurrency:R.priceCurrency,checkinTime:R.checkInDateTime,checkoutTime:R.checkOutDateTime,modifyReservationUrl:R.modifyReservationUrl,cancelReservationUrl:R.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(R.reservationStatus||"Confirmed"),reservationId:R.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:R.hotelName,url:R.hotelUrl,telephone:R.hotelPhone,address:R.hotelAddress}},_.push(r);if(_.length)return _}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/658/661","SGe9f7c8a6")]);