// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline.com-itinerary-2012-2013-en",function(e){return/^Your( priceline(?:\.com)?)? [Ii]tinerary for/.test(e.subject)||/^priceline\.com Hotel Confirmation for/.test(e.subject)},function(e){if(/^Your( priceline(?:\.com)?)? [Ii]tinerary for/.test(e.subject)||/^priceline\.com Hotel Confirmation for/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,l,m,g,c,h,u,d,T,f,x,C,v,y,b,S,N,$,k,R,A,I,P,D=[],F=[],U={},O=[],E=[];if(t.getSpan().nextText("Flight Confirmation").exists()){a=t.getSpan().nextText("AIRLINE CONFIRMATION").parentTag("td3").tagContents();for(var L,z={},j=/\s\b($<name>.*): ($<code>.*)/;a.innerCapture(j);)L=a.innerCapture(j),z[""+L.$name]=L.$code,a=a.withStart(L.$code.getEnd());u=t.getSpan().innerCapture(/\bAIRLINE CONFIRMATION #\s+($<name>.*): ($<confirmation>.*)\s/),p=u?u.$confirmation:null,d=u?u.$name:null,i=t.getSpan().nextText("Total Trip Cost:").nextTag("td3").tagContents(),o=i.innerCapture(/([\d,.]+)/,1);var Z=i.nextTag("td3").tagContents().innerCapture(/\(All prices are in (.*)\)/,1);if(n=t.getSpan().nextText("Passenger and Ticket Information").parentTag("table4").allInnerTags("tr4").map(function(e){return e.allInnerTags("td4").map(function(e){return e.tagContents()})}).filter(function(e){return 3==e.length}).slice(1),n.length)for(var w,M=0,H=n.length;H>M;M++)if(r=n[M][0].innerCapture(/($<name>.*)\s?(?:($<programName>.*)\s?-\s?($<membershipNumber>\d+))?/)){m={},w=n[M][1].split(/\n/);for(var Y,G=0;w.length>G;G++)Y=w[G].innerCapture(/\bFlight ($<flightNumber>\d+): ($<seat>.*)/),Y&&(m[""+Y.$flightNumber]=Y.$seat);U[""+r.$name]={name:""+r.$name,programName:r.$programName,membershipNumber:r.$membershipNumber,totalPrice:o,currency:Z,seats:m,seatingType:{}}}c=t.getSpan().nextText("Flight Details").parentTag("table4").allInnerTagsFiltered("td4");var B=/^Leaving\s+.*\s+at\s+.*\s+on\s+(.*)/,_=/($<name>.*)\s+Flight\s+($<flightNumber>\d+)/,q=/($<airport>.*)\s+\(($<code>[A-Z]{3})\)\s+.*\s+($<time>.*)(?:\s+($<nextDay>.*)\s+\(Overnight Flight\))?/;if(c.length)for(var J,M=0;J=c[M];M++)if(J.innerCapture(B))g=J.innerCapture(B,1);else if(J.innerCapture(_)&&c[M+3]){u=J.innerCapture(_),d=u.$name,h=u.$flightNumber,T=c[M+1].innerCapture(q),T&&(x=T.$airport,C=T.$code,f=t.getDetachedSpan(""+g+" "+T.$time).innerDate()),v=c[M+2].innerCapture(q),v&&(b=v.$airport,S=v.$code,v.$nextDay.exists()&&(g=v.$nextDay),y=t.getDetachedSpan(""+g+" "+v.$time).innerDate());var K=c[M+3].innerCapture(/\d{1,2}h\s+\d{1,2}m\s+(.*)/,1);if(K&&h.exists()){n=Object.keys(U);for(var G=0;n.length>G;G++)U[n[G]].seatingType[""+h]=K}ASSERT(f,C,y,S,h,d)&&(F.push({airlineName:d,flightNumber:h,departureAirport:x,departureTime:f,departureCode:C,arrivalAirport:b,arrivalTime:y,arrivalCode:S,passengers:U}),u=d=h=T=x=f=C=v=b=y=S=null)}}if(t.getSpan().nextRegExp(/Your (.*?) Hotel Confirmation/).exists()){N=t.getSpan().nextText("Check-In").nextDate(),$=t.getSpan().nextText("Check-Out").nextDate();var Q=$.parentTag("table4"),a=Q.allInnerTagsFiltered("td4");a.length>=3&&(A=a[0],k=a[2].innerCapture(/^.*\s($<address>[\s\S]+)\s($<phoneNumber>.*)$/),P=k?k.$address.trim():null,I=k?k.$phoneNumber.trim():null,(not(P)||Q.innerAddress().getLength()>=P.getLength())&&(P=Q.innerAddress()),not(I)&&(I=k.innerPhoneNumber())),R=t.getSpan().nextText("view my itinerary").parentTag("td3").innerLink(),a=t.getSpan().nextText("Reservation Name").nextTag("td5").tagContents().innerCapture(/($<name>.*),\s+Confirmation #: ($<reservationId>[\S]+)/),r=a?a.$name:null,p=a?a.$reservationId:null,i=t.getSpan().nextRegExp(/Total (?:Charged to Card|Room Cost):/).nextTag("td3").tagContents().innerCapture(/($<totalPrice>[\d,.]+)\s?\(($<priceCurrency>[A-Z]{3})?\)/),i&&(o=i.$totalPrice,s=i.$priceCurrency),ASSERT(N,$,P)&&O.push({name:r,reservationId:p,totalPrice:o,priceCurrency:s,checkInDateTime:N,checkOutDateTime:$,hotelName:A,hotelUrl:R,hotelPhone:I,hotelAddress:P})}for(var M=0;F.length>M;M++)for(var V=F[M],W=Object.keys(V.passengers),G=0;W.length>G;G++){var X=V.passengers[W[G]];schema={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:V.airlineName,flightNumber:V.flightNumber,departureAirportFuzzy:V.departureAirport,departureAirportCode:V.departureCode,departureTime:V.departureTime,arrivalAirportFuzzy:V.arrivalAirport,arrivalAirportCode:V.arrivalCode,arrivalTime:V.arrivalTime},underName:{"@type":"http://schema.org/Person",name:X.name},checkinUrl:l,reservationId:z[V.airlineName],reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:X.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:X.seats[V.flightNumber],seatingType:X.seatingType[V.flightNumber]}},totalPrice:X.totalPrice,priceCurrency:X.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(X.membershipNumber)||(schema.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:X.membershipNumber,programName:X.programName}),D.push(schema)}for(var et,M=0;E.length>M;M++)et=E[M],schema={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:et.totalPrice,priceCurrency:et.priceCurrency,reservationId:et.reservationId,reservationStatus:"http://schema.org/Reservation"+(et.reservationStatus||"Confirmed"),checkinUrl:et.checkinUrl,modifyReservationUrl:et.modifyReservationUrl,cancelReservationUrl:et.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:et.name,email:et.email},provider:{"@type":"http://schema.org/Organization",name:et.provider},pickupTime:et.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:et.pickupName,telephone:et.pickupTelephone,address:et.pickupAddress},dropoffTime:et.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:et.dropoffName,telephone:et.dropoffTelephone,address:et.dropoffAddress}},et.brand&&(schema.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:et.brand},license:et.license,color:et.color}),D.push(schema);for(var k,M=0;O.length>M;M++)k=O[M],schema={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:k.name,email:k.email},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency,checkinTime:k.checkInDateTime,checkoutTime:k.checkOutDateTime,modifyReservationUrl:k.modifyReservationUrl,cancelReservationUrl:k.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(k.reservationStatus||"Confirmed"),reservationId:k.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:k.hotelName,url:k.hotelUrl,telephone:k.hotelPhone,address:k.hotelAddress}},D.push(schema);if(D.length)return D}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/658/660","SG774e0d4a"),new ReverseTemplate("priceline.com-itinerary-2013-2014-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){function t(e,t){var r=e.innerAddress();if(r.getLength()>0)for(var n=r.split(" ")[0],a=1;t.length>a;a++)if((""+t[a]).split(" ")[0]===""+n){e=r;break}return""+e}var r=Scanner.fromMessage(e);if(r.setLocale("en_US"),/^Your priceline itinerary for/.test(e.subject)||r.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()){var n,a,i,o,s,p,l,m,g,c,h,u,d,T,f,x,C,v,y,b,S,N,$,k,R,A,I,P,D,F,U,O,E,L,z,j,Z,w,M,H,Y,G,B,_=[],q=[],J=[],K={},Q=[],V=[];if(r.getSpan().nextText("time to pack your bags").exists())N=!0,a=r.getSpan().nextText("time to pack your bags!").parentAnyTag("td").tagContents().innerCapture(/(.*), it's time to pack your bags!/,1),K[""+a]={name:""+a,totalPrice:null,currency:null,seats:{},seatingType:{}},u=r.getSpan().nextText("Departing").parentTag("table7").allInnerTags("table8").map(function(e){return e.allInnerTagsFiltered("td8")}).filter(function(e){return e.length>=3});else{o=r.getSpan().nextText("Total Charges").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1);var c=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1);if(q=r.getSpan().nextText("Passenger Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),q.length)for(var W=0,X=q.length;X>W;W+=3)a=q[W][1],not(a)||(K[""+a]={name:""+a,totalPrice:s,currency:c,seats:{},seatingType:{}});u=r.getSpan().nextText("Flight Details").parentTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3})}if(u.length)for(var et,W=0;et=u[W];W++)if(""+et[0]=="Departing")i=et[0].withStart(et[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),v=i?i.$departureCode:null,S=i?i.$arrivalCode:null,C=et[1],x=et[2].innerDate();else if(""+et[0]=="Arriving")b=et[1],y=et[2].innerDate();else if(""+et[0]=="Flight / Class"||""+et[0]=="Airline / Flight"){if(T=et[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),f=T?T.$name:null,d=T?T.$flightNumber:null,N?(h=null,l=et[2]&&et[2].innerCapture(/Conf Number: (.*)/,1)):(h=et[2],l=et[3]&&et[3].innerCapture(/Conf Number: (.*)/,1)),valid(d)){q=Object.keys(K);for(var a,tt=0;a=q[tt];tt++)K[a].seatingType[""+d]=h}ASSERT(f,d,C,x,v,b,y,S)&&(J.push({airlineName:f,flightNumber:d,departureAirport:C,departureCode:v,departureTime:x,arrivalAirport:b,arrivalTime:y,arrivalCode:S,reservationId:l,passengers:K}),T=f=d=C=x=v=b=y=S=l=null)}if(!r.getSpan().nextText("Hotel Reservation Confirmation").exists()&&!r.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()||r.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()||(r.getSpan().nextText("Hotel Reservation Confirmation").exists()?(a=r.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),l=r.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=r.getSpan().nextText("Hotel Reservation Confirmation"),I=i.nextTag("td9").tagContents(),R=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),P=R.innerPhoneNumber(),D=R.tagContents(),P.exists()&&(D=D.withEnd(P.getStart()).trim()),R.innerAddress().getLength()>=D.getLength()&&(D=R.innerAddress()),$=i.nextText("Check-In").nextTag("td11").innerDate(),k=i.nextText("Check-Out").nextTag("td11").innerDate(),s=r.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):r.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&!r.getSpan().nextRegExp(/(.*\([A-Z]{3}\) to .*\([A-Z]{3}\))/).exists()&&(a=r.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),l=r.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),I=r.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),R=I.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),D=R?R.$address:null,P=R?R.$phone:null,$=r.getSpan().nextText("Check-In").nextDate(),k=r.getSpan().nextText("Check-Out").nextDate()),ASSERT($,k,D)&&Q.push({name:a,reservationId:l,totalPrice:s,priceCurrency:p,checkInDateTime:$,checkOutDateTime:k,hotelName:I,hotelUrl:A,hotelPhone:P,hotelAddress:D})),r.getSpan().nextText("Rental Car Confirmation").exists()){if(M=r.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),M.length>=3&&(B=M[0].innerDate(),H=M[1].tagContents(),Y=r.getDetachedSpan(M.slice(2).join(" ")),Y=t(Y,M)),L=r.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(w=L[0].innerDate(),z=L[1].tagContents(),j=r.getDetachedSpan(L.slice(2).join(" ")),j=t(j,L)),a=r.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),l=r.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),F=r.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),U=r.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),l.exists()&&(E=r.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+l),1),E.exists())){var rt=r.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();O=rt.innerCapture(regExpFormatted(/\1 (.*)$/,""+E),1),O.exists()||(""+rt).match(/\n/)&&(O=rt.withStart(rt.next("\n").getEnd()))}s=r.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(B,E,l,OR(Y,H))&&V.push({name:a,brand:O,pickupTime:B,pickupName:H,pickupAddress:Y,pickupTelephone:G,dropoffTime:w,dropoffName:z,dropoffAddress:j,dropoffTelephone:Z,provider:E,reservationId:l,reservationStatus:m,totalPrice:s,priceCurrency:p,modifyReservationUrl:F,cancelReservationUrl:U})}for(var W=0;J.length>W;W++)for(var nt=J[W],at=Object.keys(nt.passengers),it=0;at.length>it;it++){var ot=nt.passengers[at[it]];n={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:nt.airlineName,flightNumber:nt.flightNumber,departureAirportFuzzy:nt.departureAirport,departureAirportCode:nt.departureCode,departureTime:nt.departureTime,arrivalAirportFuzzy:nt.arrivalAirport,arrivalAirportCode:nt.arrivalCode,arrivalTime:nt.arrivalTime},underName:{"@type":"http://schema.org/Person",name:ot.name},checkinUrl:g,reservationId:nt.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:ot.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:ot.seats[nt.flightNumber],seatingType:ot.seatingType[nt.flightNumber]}},totalPrice:ot.totalPrice,priceCurrency:ot.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(ot.membershipNumber)||(n.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:ot.membershipNumber,programName:ot.programName}),_.push(n)}for(var st,W=0;V.length>W;W++)st=V[W],n={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:st.totalPrice,priceCurrency:st.priceCurrency,reservationId:st.reservationId,reservationStatus:"http://schema.org/Reservation"+(st.reservationStatus||"Confirmed"),checkinUrl:st.checkinUrl,modifyReservationUrl:st.modifyReservationUrl,cancelReservationUrl:st.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:st.name,email:st.email},provider:{"@type":"http://schema.org/Organization",name:st.provider},pickupTime:st.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:st.pickupName,telephone:st.pickupTelephone,address:st.pickupAddress},dropoffTime:st.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:st.dropoffName,telephone:st.dropoffTelephone,address:st.dropoffAddress}},st.brand.exists()&&(n.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:st.brand},license:st.license,color:st.color}),_.push(n);for(var R,W=0;Q.length>W;W++)R=Q[W],n={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:R.name,email:R.email},totalPrice:R.totalPrice,priceCurrency:R.priceCurrency,checkinTime:R.checkInDateTime,checkoutTime:R.checkOutDateTime,modifyReservationUrl:R.modifyReservationUrl,cancelReservationUrl:R.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(R.reservationStatus||"Confirmed"),reservationId:R.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:R.hotelName,url:R.hotelUrl,telephone:R.hotelPhone,address:R.hotelAddress}},_.push(n);if(_.length)return _}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/658/661","SGe9f7c8a6")]);