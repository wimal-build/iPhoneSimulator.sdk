// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("emirates.com-confirmation-en",function(e){return/^Booking Confirmation -/.test(e.subject)},function(e){if(/^Booking Confirmation -/.test(e.subject)){var r=Scanner.fromMessage(e);r.setLocale("en_US");var t,a,n,i,l,o,p,s,m,g,u,d,c,h,T,v,C,b,N,f,y,A,x,$,S=[],F={};a=r.getSpan().nextText("BOOKING REFERENCE").nextTag("td5").nextTag("td5").nextTag("td5").tagContents(),l=r.getSpan().nextText("Passengers").nextTag("table3").allInnerTags("tr3"),g=r.getSpan().nextText("Total price in").nextTag("td3").innerCapture(/($<priceCurrency>[A-Z]{3})\s+($<totalPrice>[\d,.]+)/),u=g?g.$totalPrice:null,d=g?g.$priceCurrency:null,l.length>=4&&(i=l[0].innerCapture(/Passenger\s+\d\s+-\s+(.*)\n/,1).trim(),c=l[3].allInnerTagsFiltered("td3"),c=c.length>=2&&""+c[1]!="Not Applicable"?c[1]:null,F[""+i]={name:i,programName:"Frequent Flyer",membershipNumber:c,totalPrice:u,priceCurrency:d,seats:{},seatingType:{}}),s=r.getSpan().nextText("Flights").withEnd(r.getSpan().nextText("Manage Your Booking").getStart()).allInnerTags("table3");for(var k=0,P=s.length;P>k;k++)if(p=s[k].allInnerTags("tr3"),3==p.length&&p[1].innerDate().exists()&&p[2].innerDate().exists()&&(C=p[1].allInnerTagsFiltered("td3"),y=p[2].allInnerTagsFiltered("td3"),C.length>=6&&y.length>=3)){if(T=C[0].innerCapture(/($<code>\w+?)($<flightNumber>\d+)/),v=T?T.$code:null,m=T?T.$flightNumber:null,b=combineDateAndTime(C[1].innerDate(),C[2].innerDate()),h=C[3].innerCapture(/($<departureAirport>.*) \(($<departureCode>[A-Z]{3})\)/),N=h?h.$departureAirport:null,f=h?h.$departureCode:null,A=combineDateAndTime(y[0].innerDate(),y[1].innerDate()),h=y[2].innerCapture(/($<arrivalAirport>.*) \(($<arrivalCode>[A-Z]{3})\)/),x=h?h.$arrivalAirport:null,$=h?h.$arrivalCode:null,o=C[5].innerCapture(/(.*)\n/,1),valid(m,o)){l=Object.keys(F);for(var D=0;l.length>D;D++)F[l[D]].seatingType[""+m]=o}ASSERT(v,m,b,f,A,$)&&S.push({airlineCode:v,flightNumber:m,departureTime:b,departureCode:f,departureAirport:N,arrivalTime:A,arrivalCode:$,arrivalAirport:x,passengers:F})}for(var I=[],k=0;S.length>k;k++)for(var R=S[k],z=Object.keys(R.passengers),E=0;z.length>E;E++){var j=R.passengers[z[E]],w={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:R.airlineName,airlineCode:R.airlineCode,flightNumber:R.flightNumber,departureAirportFuzzy:R.departureAirport,departureAirportCode:R.departureCode,departureTime:R.departureTime,arrivalAirportFuzzy:R.arrivalAirport,arrivalAirportCode:R.arrivalCode,arrivalTime:R.arrivalTime},underName:{"@type":"http://schema.org/Person",name:j.name},checkinUrl:n,reservationId:a,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:j.totalPrice,priceCurrency:j.priceCurrency,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:t,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:j.seats[""+R.airlineCode+(""+R.flightNumber)],seatingType:j.seatingType[R.flightNumber]}}};valid(j.membershipNumber,j.programName)&&(w.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:j.membershipNumber,programName:j.programName}),I.push(w)}if(I.length)return I}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/127/236/237","SG14380c82")]);