// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);var n,i,o,p,l,m,s,d,g,u,c,h,b,v,f,T,C=[],N={},x=loadHelper("united.com-common.js"),$=t.scheduleChangeNotification&&a.getSpan().innerRegExp(regExpFormatted(/\b\1/,t.scheduleChangeNotification)).exists();p=a.getSpan().nextText(t.travelerInformation).parentTag("table4").allInnerTags("table5");for(var y,S=0;y=p[S++];)d=y.allInnerTagsFiltered("td5"),3===d.length&&(o=""+d[0],N[o]={name:o,seatMap:x.getSeatMap(d[2]),seats:{},seatingType:{}});i=a.getSpan().nextText(t.flightCheckInReminder).nextLink(),n=a.getSpan().nextText(t.confirmationNumber).parentTag("td4").innerCapture(regExpFormatted(/\1\s+(\w+)/,t.confirmationNumber),1),not(n)&&$&&(n=a.getSpan().innerCapture(regExpFormatted(/\1\s+(\w+)/,t.scheduleChangeNotification),1));var F=$?t.scheduleChange:t.confirmationNumber;if(m=a.getSpan().nextText(F).nextTag("table4").withEnd(a.getSpan().nextText(t.travelerInformation).parentTag("table4").getStart()).allInnerTagsFiltered("td4"),airlinePattern=/^($<code>[A-Z]+)($<flightNumber>\d+)$/,m.length)for(var S=0,A=m.length;A>S;S++)if(m[S].innerCapture(airlinePattern)&&A>S+3){if(g=m[S].innerCapture(airlinePattern),u=g?g.$code:null,s=g?g.$flightNumber:null,c=m[S+1].innerCapture(/^($<time>\d{1,2}:\d{2} [a.pm]+)\s+($<date>.*)\s+.*\(($<code>[A-Z]{3}).*\)$/),b=c?c.$code:null,h=c?combineDateAndTime(c.$date,c.$time):null,v=m[S+2].innerCapture(/^($<time>\d{1,2}:\d{2} [a.pm]+)\s+($<date>.*)\s+.*\(($<code>[A-Z]{3}).*\)$/),T=v?v.$code:null,f=v?combineDateAndTime(v.$date,v.$time):null,l=m[S+3].innerCapture(regExpFormatted(/\b\1\s+(.*)\s/,t.fareClass),1),p=Object.keys(N),valid(s))for(var k,E=0;p.length>E;E++)valid(l)&&(N[p[E]].seatingType[s]=l),valid(T,b)&&(k=""+b+" - "+T,N[p[E]].seats[s]=N[p[E]].seatMap[k]);ASSERT(u,s,b,h,T,f)&&C.push({airlineCode:u,flightNumber:s,departureCode:b,departureTime:h,arrivalCode:T,arrivalTime:f,passengers:N})}for(var I,z=[],S=0;C.length>S;S++)for(var M=C[S],P=Object.keys(M.passengers),E=0;P.length>E;E++){var R=M.passengers[P[E]];I={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineCode:M.airlineCode,flightNumber:M.flightNumber,departureAirportFuzzy:M.departureAirport,departureAirportCode:M.departureCode,departureTime:M.departureTime,arrivalAirportFuzzy:M.arrivalAirport,arrivalAirportCode:M.arrivalCode,arrivalTime:M.arrivalTime},underName:{"@type":"http://schema.org/Person",name:R.name},checkinUrl:i,reservationId:n,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:R.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:R.seats[M.flightNumber],seatingType:R.seatingType[M.flightNumber]}},totalPrice:R.price,priceCurrency:R.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},valid(R.membershipNumber)&&(I.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:R.membershipNumber,programName:"Frequent Flyer"}),z.push(I)}return z.length?z:void 0}}).call();