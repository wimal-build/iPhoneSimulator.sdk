// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){function a(e){switch(e){case"Scandinavian Airlines":return"SK";case"Blue1":return"KF";default:return""}}var i=Scanner.fromMessage(e);i.setLocale(r);var n,p,o,u,g,m,l,s=[],d=[],c=[];o=i.getSpan().innerCapture(regExpFormatted(/\1 : (.*)/,t.reference),1).trim(),l=i.getSpan().nextText(t.number).parentTag("td1").tagContents().innerCapture(regExpFormatted(/\1(.*)/,t.number),1).trim(),u=i.getSpan().nextText(t.total).nextAnyTag("td").tagContents().innerCapture(regExpFormatted(/($<totalPrice>[\d\.,]+)\s+($<priceCurrency>\w{3})/)),u&&(g=u.$totalPrice,m=u.$priceCurrency),n=i.getSpan().nextText(t.passenger).nextTag("tr1").nextTag("tr1").innerTag("td1").nextTag("td1").tagContents().innerCapture(regExpFormatted(/(.*)\s.*$/,t.passenger),1).trim(),d.push({name:n}),p=i.getSpan().firstTag("table1").allInnerTagsFiltered("tr1");for(var h=4;p.length>h;h+=4){var v,T,x={},F=p[h];T=F.innerDate(),T.exists()&&(T=T.split("-"),v=F.previousText(t.return),v.exists()||(v=F.previousText(t.airfare)),v=v.nextDate(),x.flightNumber=p[h+1].withEnd(p[h+1].nextClosingTag("td1").getStart()).trim(),x.departureTime=getFuzzyDate(i.getDetachedSpan(v+" "+T[0])),x.arrivalTime=getFuzzyDate(i.getDetachedSpan(v+" "+T[1])),x.departureAirportFuzzy=F.innerCapture(regExpFormatted(/\[td1\](.*)\-/),1).trim(),x.arrivalAirportFuzzy=F.innerCapture(regExpFormatted(/\[td1\].*\-(.*)/),1).trim(),x.airlineName=p[h+1].innerCapture(regExpFormatted(/\1 :(.*)\|/,t.operate),1).trim(),x.airlineCode=a(""+x.airlineName),ASSERT(x.flightNumber,x.departureTime,x.arrivalTime,x.departureAirportFuzzy,x.arrivalAirportFuzzy)&&s.push(x))}for(var z=0;s.length>z;z++)for(var x=s[z],C=0;d.length>C;C++){var y=d[C],f={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:x.airlineName,airlineCode:x.airlineCode,flightNumber:x.flightNumber,departureAirportFuzzy:x.departureAirportFuzzy,departureAirportCode:x.departureAirportCode,departureTime:x.departureTime,arrivalAirportFuzzy:x.arrivalAirportFuzzy,arrivalAirportCode:x.arrivalAirportCode,arrivalTime:x.arrivalTime},underName:{"@type":"http://schema.org/Person",name:y.name},checkinUrl:"",reservationId:o,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:g,priceCurrency:m,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:l,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:"",seatingType:""}}};c.push(f)}return c.length?c:void 0}}).call();