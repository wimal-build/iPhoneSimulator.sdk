// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("travelocity.com-car-confirmation-en",function(e){return/^Travelocity\s+travel confirmation/.test(e.subject)},function(e){if(/^Travelocity\s+travel confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);if(t.setLocale("en_US"),t.getSpan().nextText("Car rental summary").exists()){var r,n,a,i,o,s,p,c,l,g,m,u,d,h,T,v,f,x,C,y,S;if(d=t.getSpan().innerCapture(/\bReservation has been sent to (.*?)\./,1),s=t.getSpan().innerCapture(RegExp(regExpEscape(d)+"\\s+confirmation\\s+number:\\s+(\\w+)"),1),a=t.getSpan().nextText("Traveler and cost summary").parentTag("table5"),r=a.innerText("Driver:").parentTag("td5").tagContents().innerCapture(/Driver: (.*)/,1),g=r.nextTag("td5").tagContents().innerCapture(/(.*?):/,1),i=a.innerText("Car rental total").nextTag("td5").tagContents().innerCapture(/([\d,.]+)/,1),a=t.getSpan().nextText("Car rental summary").nextTag("table6"),S=a.innerText("Pick up:").parentTag("td6").innerDate(),f=a.innerText("Drop off:").parentTag("td6").innerDate(),C=a.innerText("Location:").parentTag("td6").tagContents().innerCapture(/Location: (.*)/,1),y=a.parentTag("table5").innerPhoneNumber(),T=C,v=y,l=t.getSpan().innerCapture(/Remember to cancel this car reservation <(.*?)>/,1),ASSERT(d,g,S,d,s,OR(x,C)))return[{"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:i,priceCurrency:o,reservationId:s,reservationStatus:"http://schema.org/ReservationConfirmed",checkinUrl:p,modifyReservationUrl:c,cancelReservationUrl:l,underName:{"@type":"http://schema.org/Person",name:r,email:n},provider:{"@type":"http://schema.org/Organization",name:d},reservationFor:{"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:g},license:m,color:u},pickupTime:S,pickupLocation:{"@type":"http://schema.org/Place",name:x,telephone:y,address:C},dropoffTime:f,dropoffLocation:{"@type":"http://schema.org/Place",name:h,telephone:v,address:T}}]}}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/664/667","SGdd143b67"),new ReverseTemplate("travelocity.com-flight-cancellation-en",function(){return!1},function(e){return/^Your flight itinerary is canceled$/.test(e.subject)?STOP:void 0},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/664/668","SGdb24e27a"),new ReverseTemplate("travelocity.com-flight-confirmation-en",function(e){return/^Travelocity travel confirmation/.test(e.subject)},function(e){if(/Travelocity travel confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);if(t.setLocale("en_US"),t.getSpan().nextText("Airline Rules & Regulations").exists()){var r,n,a,i,o,s,p,c,l,g,m,u,d,h,T,v,f,x=[],C={};a=t.getSpan().nextText("Traveler Information").nextTag("table6").allInnerTags("tr6").map(function(e){return e.allInnerTagsFiltered("td6")}),i=t.getSpan().nextText("Price Summary").nextText("Total:").parentTag("td5").tagContents().innerCapture(/([\d,.]+)/,1),o=t.getSpan().nextText("All prices quoted in").parentTag("td5").tagContents().innerCapture(/All prices quoted in (.*)\./,1);for(var y=0;a.length>y;y++)a[y].length>=3&&(n=a[y][0].innerCapture(/(.*)\s/,1).trim(),m=a[y][1].innerCapture(/^(No frequent flyer details)/,1).exists()?null:a[y][1],C[""+n]={name:n,programName:"Frequent Flyer",membershipNumber:m,ticketNumber:a[y][2].innerCapture(/Ticket #\s+(\d+)/,1),totalPrice:i,priceCurrency:o,seats:{},seatingType:{}});l=t.getSpan().nextText("Traveler Information").parentTag("table5").allInnerTags("table6").map(function(e){return e.allInnerTags("td6").map(function(e){return e.tagContents()})});for(var S=1;l.length>S;S++){c=l[S],p=c[0].previousTag("td5").previousTag("td5").innerDate();for(var b=0;c.length>b;b++)if(r=c[b],r.innerCapture(/^([A-Z]{3})/))not(T)?(T=r.innerCapture(/([A-Z]{3})/,1),h=combineDateAndTime(p,r.innerDate())):(f=r.innerCapture(/([A-Z]{3})/,1),v=combineDateAndTime(p,r.innerDate()));else if(r.innerCapture(/^[A-Za-z ]+\s+\d+/))u=r.innerCapture(/^($<name>[A-Za-z ]+)\s+($<flightNumber>\d+)/),d=u?u.$name:null,g=u?u.$flightNumber:null,not(d)||(s=t.getSpan().nextText("Important Information").nextText(""+d).nextTag("td5").tagContents());else if(r.innerCapture(/^.* \| .*$/)&&(seatingType=r.innerCapture(/^(.*) \| .*$/,1),valid(g))){a=Object.keys(C);for(var y=0;a.length>y;y++)C[a[y]].seatingType[""+g]=seatingType}ASSERT(d,g,T,h,f,v)&&x.push({airlineName:d,flightNumber:g,reservationId:s,departureCode:T,departureTime:h,arrivalCode:f,arrivalTime:v,passengers:C}),u=d=g=T=h=f=v=seatingType=s=null}for(var N,P=[],S=0;x.length>S;S++)for(var R=x[S],A=Object.keys(R.passengers),I=0;A.length>I;I++){var k=R.passengers[A[I]];N={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:R.airlineName,airlineCode:R.airlineCode,flightNumber:R.flightNumber,departureAirportFuzzy:R.departureAirport,departureAirportCode:R.departureCode,departureTime:R.departureTime,arrivalAirportFuzzy:R.arrivalAirport,arrivalAirportCode:R.arrivalCode,arrivalTime:R.arrivalTime},underName:{"@type":"http://schema.org/Person",name:k.name},checkinUrl:R.checkinUrl,reservationId:R.reservationId,reservationStatus:"http://schema.org/Reservation"+(R.reservationStatus||"Confirmed"),reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:k.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:k.seats[R.flightNumber],seatingType:k.seatingType[R.flightNumber]}},totalPrice:k.totalPrice,priceCurrency:k.priceCurrency},not(k.membershipNumber)||(N.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:k.membershipNumber,programName:k.programName}),P.push(N)}if(P.length)return P}}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/664/669","SG6a22fa57"),new ReverseTemplate("travelocity.com-hotel-cancellation-en",function(e){return/^Travelocity Hotel Cancellation Confirmation/.test(e.subject)},function(e){if(/^Travelocity Hotel Cancellation Confirmation/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var r,n,a,i,o,s,p,c,l,g,m,u,d,h,T;if(r=t.getSpan().nextText("Reserved for").nextTag("td9").nextTag("td9").tagContents().innerCapture(/(.*)\s/,1).trim(),currentDate=t.getSpan().nextTag("table6").nextTag("td6").tagContents().innerCapture(/($<checkIn>\w+\/\d{1,2}\/\d{4}) - \w{3} ($<checkOut>\w+\/\d{1,2}\/\d{4})/),currentDate&&(l=t.getDetachedSpan((""+currentDate.$checkIn).split("/").join(" ")),g=t.getDetachedSpan((""+currentDate.$checkOut).split("/").join(" "))),a=t.getSpan().nextTag("table9").lastInnerTag("td9").tagContents(),m=a.innerCapture(/($<name>.*)\s+($<address>.*)/),d=m?m.$name:null,T=m?m.$address:null,a.innerAddress().getLength()>=T.getLength()&&(T=a.innerAddress()),s=t.getSpan().innerCapture(/Travelocity Itinerary number: (\d+)/,1),ASSERT(r,d,T,l,g))return[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:r,email:n},totalPrice:i,priceCurrency:o,checkinTime:l,checkoutTime:g,modifyReservationUrl:p,cancelReservationUrl:c,reservationStatus:"http://schema.org/ReservationCancelled",reservationId:s,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:d,url:u,telephone:h,address:T}}]}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/664/670","SGbfb3515a"),new ReverseTemplate("travelocity.com-hotel-confirmation-en",function(e){return/(^Travelocity travel confirmation|Itinerary#)/.test(e.subject)},function(e){if(!/(^Travelocity travel confirmation|Itinerary#)/.test(e.subject))return CONTINUE;var t={reservationIdPrefix:"Itinerary #",totalPricePrefix:"Total",underPersonNamePrefix:"Reserved for",hotelAddressPrefix:"View hotel details"},r=Scanner.fromMessage(e);r.setLocale("en_US");var n,a,i,o,s,p,c,l,g,m,u;n=r.getSpan().nextText(t.underPersonNamePrefix).nextTag("td8").nextTag("td8").tagContents().innerCapture(/(.*)\n/,1),c=r.getSpan().innerCapture(regExpFormatted(/\1\s+?(\d+)\s+?/,t.reservationIdPrefix),1);var d=r.getSpan().nextText(t.reservationIdPrefix).nextTag("table5");i=d.nextTag("td5").tagContents(),d=d.nextTag("td5").nextTag("td5").tagContents();var h=d.innerCapture(/[a-zA-Z]{3}(.*) - [a-zA-Z]{3}(.*),/);l=r.getDetachedSpan((""+h[1]).replace(/\//g," ")).innerDate(),g=r.getDetachedSpan((""+h[2]).replace(/\//g," ")).innerDate(),p=r.getSpan().nextText(t.hotelAddressPrefix).nextLink(),s=r.getSpan().nextText(t.hotelAddressPrefix).nextAddress(),o=r.getSpan().nextText(t.hotelAddressPrefix).nextPhoneNumber();var T=r.getSpan().nextText(t.totalPricePrefix).nextTag("td7").tagContents();return u=""+T.innerCapture(/(.)\d+/,1),m=(""+T.tagContents()).replace(""+u,""),ASSERT(s,l)?[{"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:n,email:a},totalPrice:m,priceCurrency:u,checkinTime:l,checkoutTime:g,reservationStatus:"http://schema.org/ReservationConfirmed",reservationId:c,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:i,telephone:o,url:p,address:s}}]:CONTINUE},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/577/664/671","SGe3435f47")]);