// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){var a=Scanner.fromMessage(e);a.setLocale(t);var n,i,p,g,x,o,u,l=[],m=[],d=[],h=1,s="Confirmed";g=a.getSpan().nextText(r.price).nextText("\n"),g=a.getSpan().withInterval(g.getEnd(),g.nextText("\n").getStart()),x=g.innerCapture(regExpFormatted(/([\d\., ]+)/),1).trim(),o=g.innerCapture(regExpFormatted(/([^\d\., ]+)/),1),n=a.getSpan().nextText(r.passenger).nextText("\n"),n=a.getSpan().withInterval(n.getEnd(),n.nextText(r.passengerSuffix).getStart());do ASSERT(n)&&m.push({name:n}),n=n.nextText("\n"),n=a.getSpan().withInterval(n.getEnd(),n.nextText("\n").getStart());while(n.getLength());for(i=a.getSpan().nextText(r.flight).nextText("[1]"),a.getSpan().nextText(r.limit).exists()?s="Pending":a.getSpan().nextText(r.cancel).exists()?s="Cancelled":a.getSpan().nextText(r.refund).exists()&&(s="Cancelled");i.exists();){var c,T,v,S={},z=i.nextDate();S.flightNumber=i.nextRegExp(regExpFormatted(/\d{3,4}/)),T=S.flightNumber.nextDate(),c=S.flightNumber.nextDate().nextDate(),S.departureAirportFuzzy=a.getSpan().withInterval(S.flightNumber.getEnd(),T.previousText("(").getStart()).trim(),S.arrivalAirportFuzzy=a.getSpan().withInterval(S.flightNumber.nextText("-").getEnd(),c.previousText("(").getStart()).trim(),S.departureTime=getFuzzyDate(a.getDetachedSpan(z+" "+T)),S.arrivalTime=getFuzzyDate(a.getDetachedSpan(z+" "+c)),v=i.nextText(r.ticket),S.ticketNumber=a.getSpan().withInterval(v.getEnd(),v.nextText("\n").getStart()).trim(),ASSERT(S.arrivalAirportFuzzy,S.departureAirportFuzzy,S.flightNumber,S.departureTime,S.arrivalTime)&&l.push(S),h++,i=i.nextText("["+h+"]")}for(var f=0;l.length>f;f++)for(var y=l[f],F=0;m.length>F;F++){var A=m[F],N={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"All Nippon Airways",airlineCode:y.airlineCode,flightNumber:y.flightNumber,departureAirportFuzzy:y.departureAirportFuzzy,departureAirportCode:y.departureAirportCode,departureTime:y.departureTime,arrivalAirportFuzzy:y.arrivalAirportFuzzy,arrivalAirportCode:y.arrivalAirportCode,arrivalTime:y.arrivalTime},underName:{"@type":"http://schema.org/Person",name:A.name},checkinUrl:u,reservationId:p,reservationStatus:"http://schema.org/Reservation"+s,totalPrice:x,priceCurrency:o,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:y.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:y.seatNumber,seatingType:""}}};d.push(N)}return d.length?d:void 0}}).call();