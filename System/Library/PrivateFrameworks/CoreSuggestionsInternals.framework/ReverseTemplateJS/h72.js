// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,t,r){if(!e||!t||!r)return CONTINUE;var a=Scanner.fromMessage(e);a.setLocale(t);var i,n,p,o,g,m,d,u,s=[];i=a.getSpan().nextText(r.passenger).nextTag("td3").tagContents().innerCapture(regExpFormatted(/:(.*)/),1).trim(),m=a.getDetachedSpan(e.subject).innerCapture(regExpFormatted(/(\w+)$/),1),d=a.getSpan().nextText(r.total).nextTag("td3").tagContents(),n=d.innerCapture(regExpFormatted(/([\d\.,\s]+)/),1).trim(),p=d.innerCapture(regExpFormatted(/([^\d\.,\s]+)/),1).trim(),o=m,u=a.getSpan().nextText(r.flightData).nextTag("table3").allInnerTagsFiltered("tr3");for(var l=0;u.length>l;l+=2){var h={},c=u[l],T=u[l+1];h.flightNumber=c.innerCapture(regExpFormatted(/\1 : (.*)/,r.number),1),h.departureAirport=T.withEnd(T.nextClosingTag("td3").getStart()).innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),h.departureTime=getFuzzyDate(a.getDetachedSpan(c.innerDate()+" "+T.firstDate())),h.arrivalAirport=T.withStart(T.nextText("[td3]").nextText("[td3]").getEnd()).innerCapture(regExpFormatted(/[\d:]+(.*)/),1).trim(),h.arrivalTime=a.getDetachedSpan(c.innerDate()+" "+T.firstDate().nextDate()),ASSERT(h.departureTime,h.arrivalTime,h.departureAirport,h.arrivalAirport,h.flightNumber)&&s.push(h)}for(var x=[],l=0;s.length>l;l++){var h=s[l],v={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:"Germanwings",airlineCode:"4U",flightNumber:h.flightNumber,departureAirportFuzzy:h.departureAirport,departureAirportCode:h.departureIata,departureTime:h.departureTime,arrivalAirportFuzzy:h.arrivalAirport,arrivalAirportCode:h.arrivalIata,arrivalTime:h.arrivalTime},underName:{"@type":"http://schema.org/Person",name:i},checkinUrl:g,reservationId:m,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:n,priceCurrency:p,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:o,ticketedSeat:{"@type":"http://schema.org/Seat",seatingType:h.seatingType,seatNumber:h.seatingNumber}}};x.push(v)}return x.length?x:CONTINUE}}).call();