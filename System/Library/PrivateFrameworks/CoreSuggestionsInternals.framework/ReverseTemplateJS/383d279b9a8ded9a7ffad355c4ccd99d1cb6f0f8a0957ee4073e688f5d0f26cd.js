// Copyright 2014 Apple Inc.  All Rights Reserved.
new ReverseTemplateList([new ReverseTemplate("priceline.com-car-rental-en",function(e){return/^Rental Car Information$/.test(e.subject)},function(e){if(/^Rental Car Information$/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var n,r,a,i,o,s,p,g,l,m,c,d,h,u,x,T,f,C,v,S;if(S=t.getSpan().nextText("Pick-Up Date:").nextTag("td5").innerDate(),C=t.getSpan().nextText("Pick-Up Location:").nextTag("td5").tagContents(),C.innerAddress().exists()&&(C=C.innerAddress()),T=t.getSpan().nextText("Drop-Off Date:").nextTag("td5").innerDate(),u=t.getSpan().nextText("Drop-Off Location:").nextTag("td5").tagContents(),u.innerAddress().exists()&&(u=u.innerAddress()),d=t.getSpan().nextText("Rental Partner:").nextTag("td5").tagContents(),l=d.nextText("Car Type:").nextTag("td5").tagContents(),n=t.getSpan().nextText("Driver:").nextTag("td5").tagContents(),o=n.nextText("Confirmation Number:").nextTag("td5").tagContents(),ASSERT(S,d,o,OR(C,f)))return[{"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:a,priceCurrency:i,reservationId:o,reservationStatus:"http://schema.org/ReservationConfirmed",checkinUrl:s,modifyReservationUrl:p,cancelReservationUrl:g,underName:{"@type":"http://schema.org/Person",name:n,email:r},provider:{"@type":"http://schema.org/Organization",name:d},reservationFor:{"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:l},license:m,color:c},pickupTime:S,pickupLocation:{"@type":"http://schema.org/Place",name:f,telephone:v,address:C},dropoffTime:T,dropoffLocation:{"@type":"http://schema.org/Place",name:h,telephone:x,address:u}}]}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/611/612","SG3a723d33"),new ReverseTemplate("priceline.com-itinerary-2013-2014-en",function(e){return/^Your priceline itinerary for/.test(e.subject)},function(e){if(/^Your priceline itinerary for/.test(e.subject)){var t=Scanner.fromMessage(e);t.setLocale("en_US");var n,r,a,i,o,s,p,g,l,m,c,d,h,u,x,T,f,C,v,S,y,b,R,N,k,A,P,D,I,U,$,F,L,O,E,z,j,w,G,M,H,Z,Y=[],_=[],B={},q=[],J=[];if(t.getSpan().nextText("Flight Confirmation").exists()){o=t.getSpan().nextText("Total Charges").nextTag("td9").tagContents(),s=o.innerCapture(/([\d,.]+)/,1);var K=o.nextText("All prices are in").parentAnyTag("td").tagContents().innerCapture(/All prices are in (.*)/,1);if(a=t.getSpan().nextText("Passenger Information").parentTag("table6").allInnerTags("table9").map(function(e){return e.allInnerTags("td9").map(function(e){return e.tagContents()})}).filter(function(e){return 2===e.length}),a.length)for(var Q=0,V=a.length;V>Q;Q+=3)r=a[Q][1],not(r)||(B[""+r]={name:""+r,totalPrice:s,currency:K,seats:{},seatingType:{}});if(d=t.getSpan().nextText("Flight Details").parentTag("table7").allInnerTags("table10").map(function(e){return e.allInnerTagsFiltered("td10")}).filter(function(e){return e.length>=3}),d.length)for(var W,Q=0;W=d[Q];Q++)if(""+W[0]=="Departing")i=W[0].withStart(W[0].getStart()-200).innerCapture(/\(($<departureCode>[A-Z]{3})\).+?\(($<arrivalCode>[A-Z]{3})\)/),C=i?i.$departureCode:null,y=i?i.$arrivalCode:null,f=W[1],T=W[2].innerDate();else if(""+W[0]=="Arriving")S=W[1],v=W[2].innerDate();else if(""+W[0]=="Flight / Class"){if(u=W[1].innerCapture(/($<name>.*) ($<flightNumber>\d+)$/),x=u?u.$name:null,h=u?u.$flightNumber:null,c=W[2],g=W[3]&&W[3].innerCapture(/Conf Number: (.*)/,1),valid(h,c)){a=Object.keys(B);for(var r,X=0;r=a[X];X++)B[r].seatingType[""+h]=c}ASSERT(x,h,f,T,C,S,v,y)&&(_.push({airlineName:x,flightNumber:h,departureAirport:f,departureCode:C,departureTime:T,arrivalAirport:S,arrivalTime:v,arrivalCode:y,reservationId:g,passengers:B}),u=x=h=f=T=C=S=v=y=g=null)}}if((t.getSpan().nextText("Hotel Reservation Confirmation").exists()||t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists())&&(t.getSpan().nextText("Hotel Reservation Confirmation").exists()?(r=t.getSpan().nextText("Guest Information").nextTag("td9").nextTag("td9").tagContents(),g=t.getSpan().nextText("Guest Information").nextText("Confirmation Number").nextTag("td9").tagContents(),i=t.getSpan().nextText("Hotel Reservation Confirmation"),A=i.nextTag("td9").tagContents(),N=i.nextTag("table10").nextTag("td10").nextTag("td10").tagContents(),P=N.innerPhoneNumber(),D=N.tagContents(),P.exists()&&(D=D.withEnd(P.getStart()).trim()),N.innerAddress().getLength()>=D.getLength()&&(D=N.innerAddress()),b=i.nextText("Check-In").nextTag("td11").innerDate(),R=i.nextText("Check-Out").nextTag("td11").innerDate(),s=t.getSpan().nextText("Summary of Charges").nextText("Total Charges").nextTag("td9").tagContents().innerCapture(/([\d,.]+)/,1)):t.getSpan().nextRegExp(/, it's time to pack your bags!/).exists()&&(r=t.getSpan().nextText("Reservation Name").parentAnyTag("td").tagContents().innerCapture(/Reservation Name\s+(.*)$/,1),g=t.getSpan().nextText("Confirmation Number").parentAnyTag("td").tagContents().innerCapture(/Confirmation Number\s+(\d+)$/,1),A=t.getSpan().nextText("it's time to pack your bags!").nextTag("td8").tagContents(),N=A.nextTag("td9").tagContents().innerCapture(/($<address>.*)\n($<phone>.*)/),D=N?N.$address:null,P=N?N.$phone:null,b=t.getSpan().nextText("Check-In").nextDate(),R=t.getSpan().nextText("Check-Out").nextDate()),ASSERT(b,R,D)&&q.push({name:r,reservationId:g,totalPrice:s,priceCurrency:p,checkInDateTime:b,checkOutDateTime:R,hotelName:A,hotelUrl:k,hotelPhone:P,hotelAddress:D})),t.getSpan().nextText("Rental Car Confirmation").exists()){if(w=t.getSpan().nextText("Pick-Up").nextTag("table11").allInnerTagsFiltered("td11"),w.length>=3&&(Z=w[0].innerDate(),G=w[1].tagContents(),M=t.getDetachedSpan(w.slice(2).join(" ")),M.innerAddress().getLength()>=M.getLength()&&(M=M.innerAddress())),L=t.getSpan().nextText("Drop-Off").nextTag("table11").allInnerTagsFiltered("td11"),L.length>=3&&(j=L[0].innerDate(),O=L[1].tagContents(),E=t.getDetachedSpan(L.slice(2).join(" ")),E.innerAddress().getLength()>=E.getLength()&&(E=E.innerAddress())),r=t.getSpan().nextText("Driver Name").parentTag("td11").tagContents().innerCapture(/\bDriver Name\s+(.*)/,1),g=t.getSpan().nextText("Confirmation Number").parentTag("td11").tagContents().innerCapture(/\bConfirmation Number\s+(\w+)/,1),I=t.getSpan().innerCapture(/\bChange\s+Reservation\s+<(.*?)>/,1),U=t.getSpan().innerCapture(/\bCancel\s+Reservation\s+<(.*?)>/,1),g.exists()&&(F=t.getSpan().nextText("Confirmation:").parentTag("td7").tagContents().innerCapture(regExpFormatted(/\b(.*) Confirmation: \1/,""+g),1),F.exists())){var et=t.getSpan().nextText("Rental Car Details").nextTag("table9").innerTag("td9").tagContents();$=et.innerCapture(regExpFormatted(/\1 (.*)$/,""+F),1),$.exists()||($=et.withStart(et.next("\n").getEnd()))}s=t.getSpan().nextText("Estimated Total Charges").nextTag("td9").tagContents().innerCapture(/.*?([\d,.]+)/,1),p=s.nextTag("td8").tagContents().innerCapture(/\bPrices are in ([A-Z]+)/,1),ASSERT(Z,F,g,OR(M,G))&&J.push({name:r,brand:$,pickupTime:Z,pickupName:G,pickupAddress:M,pickupTelephone:H,dropoffTime:j,dropoffName:O,dropoffAddress:E,dropoffTelephone:z,provider:F,reservationId:g,reservationStatus:l,totalPrice:s,priceCurrency:p,modifyReservationUrl:I,cancelReservationUrl:U})}for(var Q=0;_.length>Q;Q++)for(var tt=_[Q],nt=Object.keys(tt.passengers),rt=0;nt.length>rt;rt++){var at=tt.passengers[nt[rt]];n={"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:tt.airlineName,flightNumber:tt.flightNumber,departureAirportFuzzy:tt.departureAirport,departureAirportCode:tt.departureCode,departureTime:tt.departureTime,arrivalAirportFuzzy:tt.arrivalAirport,arrivalAirportCode:tt.arrivalCode,arrivalTime:tt.arrivalTime},underName:{"@type":"http://schema.org/Person",name:at.name},checkinUrl:m,reservationId:tt.reservationId,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:at.ticketNumber,ticketedSeat:{"@type":"http://schema.org/Seat",seatNumber:at.seats[tt.flightNumber],seatingType:at.seatingType[tt.flightNumber]}},totalPrice:at.totalPrice,priceCurrency:at.currency,reservationStatus:"http://schema.org/ReservationConfirmed"},not(at.membershipNumber)||(n.programMembershipUsed={"@type":"http://schema.org/ProgramMembership",membershipNumber:at.membershipNumber,programName:at.programName}),Y.push(n)}for(var it,Q=0;J.length>Q;Q++)it=J[Q],n={"@context":"http://schema.org","@type":"http://schema.org/RentalCarReservation",totalPrice:it.totalPrice,priceCurrency:it.priceCurrency,reservationId:it.reservationId,reservationStatus:"http://schema.org/Reservation"+(it.reservationStatus||"Confirmed"),checkinUrl:it.checkinUrl,modifyReservationUrl:it.modifyReservationUrl,cancelReservationUrl:it.cancelReservationUrl,underName:{"@type":"http://schema.org/Person",name:it.name,email:it.email},provider:{"@type":"http://schema.org/Organization",name:it.provider},pickupTime:it.pickupTime,pickupLocation:{"@type":"http://schema.org/Place",name:it.pickupName,telephone:it.pickupTelephone,address:it.pickupAddress},dropoffTime:it.dropoffTime,dropoffLocation:{"@type":"http://schema.org/Place",name:it.dropoffName,telephone:it.dropoffTelephone,address:it.dropoffAddress}},it.brand.exists()&&(n.reservationFor={"@type":"http://schema.org/Car",brand:{"@type":"http://schema.org/Organization",name:it.brand},license:it.license,color:it.color}),Y.push(n);for(var N,Q=0;q.length>Q;Q++)N=q[Q],n={"@context":"http://schema.org","@type":"http://schema.org/LodgingReservation",underName:{"@type":"http://schema.org/Person",name:N.name,email:N.email},totalPrice:N.totalPrice,priceCurrency:N.priceCurrency,checkinTime:N.checkInDateTime,checkoutTime:N.checkOutDateTime,modifyReservationUrl:N.modifyReservationUrl,cancelReservationUrl:N.cancelReservationUrl,reservationStatus:"http://schema.org/Reservation"+(N.reservationStatus||"Confirmed"),reservationId:N.reservationId,reservationFor:{"@type":"http://schema.org/LodgingBusiness",name:N.hotelName,url:N.hotelUrl,telephone:N.hotelPhone,address:N.hotelAddress}},Y.push(n);if(Y.length)return Y}},"0/1/2/3/4/5/3/5/6/6/6/6/4/7/535/611/614","SGe9f7c8a6")]);