// Copyright 2014 Apple Inc.  All Rights Reserved.
(function(){return function(e,r,t){var a=Scanner.fromMessage(e);a.setLocale(r);for(var i,n,o,m,p,d,g=a.getSpan().nextText(t.customerInformationHeader).parentTag("table6"),l=g.nextText(t.passengerNamePrefix).nextTag("td7").tagContents().trim(),s=g.nextText(t.tripSummaryHeader).nextText(t.flightSummaryHeader).nextText(t.ticketNumberSuffix).parentTag("td8").tagContents().innerCapture(regExpFormatted(/(\d+) \1/,t.ticketNumberSuffix),1),u=g.nextText(t.flightDetails).nextTag("table6").nextTag("table6").nextTag("table6"),x=u.nextTag("table7").allInnerTags("tr7").filter(function(e){return(""+e.tagContents()).length}),f=[],T={},N=!0,h=0;x.length>h;h++)i=x[h],i.innerText(t.operatedByPrefix).exists()?T.airlineName=i.innerText(t.operatedByPrefix).parentTag("td7").tagContents().innerCapture(regExpFormatted(/\1 (.+)/,t.operatedByPrefix),1):N?N=!1:i.innerText(t.flightNumberPrefix).exists()&&i.innerText(t.fromPrefix).exists()&&i.innerText(t.toPrefix).exists()?(i.innerText(t.reservationIdPrefix).exists()?(o=i.firstTag("td7").tagContents().innerCapture(regExpFormatted(/^($<airlineName>.+)\n\1\s($<flightNumber>\d+)[^]+\2:\s($<reservationId>\w{6})/,t.flightNumberPrefix,t.reservationIdPrefix)),T.airlineName=o.$airlineName.trim(),T.flightNumber=o.$flightNumber.trim(),T.reservationId=o.$reservationId.trim()):(n=i.firstTag("td7").tagContents().innerCapture(regExpFormatted(/^($<airlineName>.+)\n\1\s($<flightNumber>\d+)/,t.flightNumberPrefix)),T.airlineName=n.$airlineName.trim(),T.flightNumber=n.$flightNumber.trim()),p=i.nextTag("td7").nextTag("td7").tagContents(),m=p.innerCapture(/($<airportName>.+)\(($<airportCode>\w{3})\)/),T.departureAirportName=m.$airportName.trim(),T.departureAirportCode=m.$airportCode.trim(),T.departureDateTime=p.innerDate(),d=p.nextTag("td7"),m=d.innerCapture(/($<airportName>.+)\(($<airportCode>\w{3})\)/),T.arrivalAirportName=m.$airportName.trim(),T.arrivalAirportCode=m.$airportCode.trim(),T.arrivalDateTime=d.innerDate()):i.innerTag("table8").exists()&&ASSERT(T.airlineName,T.flightNumber,T.departureAirportCode,T.departureDateTime,T.arrivalAirportCode,T.arrivalDateTime)&&(f.push(T),T={},N=!0);for(var c=a.getSpan().nextText(t.pricePrefix).nextTag("td8").tagContents().innerCapture(/($<currency>[^\d\.,]+)($<price>[\d\.,]+)/),C=c.$currency,v=c.$price,$=[],b=0;f.length>b;b++){var y=f[b];$.push({"@context":"http://schema.org","@type":"http://schema.org/FlightReservation",reservationFor:{"@type":"http://apple.com/FuzzyFlight",airlineName:y.airlineName,airlineCode:y.airlineCode,flightNumber:y.flightNumber,departureAirportFuzzy:y.departureAirportName,departureAirportCode:y.departureAirportCode,departureTime:y.departureDateTime,arrivalAirportFuzzy:y.arrivalAirportName,arrivalAirportCode:y.arrivalAirportCode,arrivalTime:y.arrivalDateTime},underName:{"@type":"http://schema.org/Person",name:l},reservationId:y.reservationId,reservationStatus:"http://schema.org/ReservationConfirmed",totalPrice:v,priceCurrency:C,reservedTicket:{"@type":"http://schema.org/Ticket",ticketNumber:s,ticketedSeat:{"@type":"http://schema.org/Seat"}}})}return $}}).call();